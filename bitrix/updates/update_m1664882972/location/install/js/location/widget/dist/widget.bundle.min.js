this.BX=this.BX||{};this.BX.Location=this.BX.Location||{};(function(e,t,s,a,i,l,r,n){"use strict";var d=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(d,"INITIAL","INITIAL");babelHelpers.defineProperty(d,"DATA_INPUTTING","DATA_INPUTTING");babelHelpers.defineProperty(d,"DATA_SELECTED","DATA_SELECTED");babelHelpers.defineProperty(d,"DATA_LOADING","DATA_LOADING");babelHelpers.defineProperty(d,"DATA_LOADED","DATA_LOADED");var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"render",value:function e(t){throw new i.MethodNotImplemented("Method render must be implemented")}},{key:"setAddressWidget",value:function e(t){throw new i.MethodNotImplemented("Method render must be implemented")}},{key:"setAddress",value:function e(t){throw new i.MethodNotImplemented("Method set address must be implemented")}},{key:"setMode",value:function e(t){}},{key:"destroy",value:function e(){}},{key:"resetView",value:function e(){}}]);return e}();function b(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=c(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function c(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function p(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var h=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));B.add(babelHelpers.assertThisInitialized(s));_.add(babelHelpers.assertThisInitialized(s));M.add(babelHelpers.assertThisInitialized(s));z.add(babelHelpers.assertThisInitialized(s));A.add(babelHelpers.assertThisInitialized(s));W.add(babelHelpers.assertThisInitialized(s));C.add(babelHelpers.assertThisInitialized(s));E.add(babelHelpers.assertThisInitialized(s));S.add(babelHelpers.assertThisInitialized(s));v.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});f.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});H.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});F.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});P.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});m.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});g.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});w.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});y.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});T.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});I.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});k.set(babelHelpers.assertThisInitialized(s),{writable:true,value:true});G.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Address");if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),F,e.addressFormat);if(e.address&&!(e.address instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),H,e.address||null);if(!i.ControlMode.isValid(e.mode)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),v,e.mode);if(!n.Type.isString(e.languageId)){throw new TypeError("props.languageId must be type of string")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),P,e.languageId);if(e.features){if(!n.Type.isArray(e.features)){throw new TypeError("features must be an array")}e.features.forEach(function(e){p(babelHelpers.assertThisInitialized(s),S,L).call(babelHelpers.assertThisInitialized(s),e)})}if(n.Type.isBoolean(e.needWarmBackendAfterAddressChanged)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),k,e.needWarmBackendAfterAddressChanged)}if(e.locationRepository instanceof i.LocationRepository){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,e.locationRepository)}else if(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),k)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),G,new i.LocationRepository)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),f,d.INITIAL);return s}babelHelpers.createClass(t,[{key:"setAddressByFeature",value:function e(t,s){var a=babelHelpers.classPrivateFieldGet(this,H)?babelHelpers.classPrivateFieldGet(this,H).id:0;babelHelpers.classPrivateFieldSet(this,H,t);if(a>0){babelHelpers.classPrivateFieldGet(this,H).id=a}p(this,E,O).call(this,"setAddress",[t],s);if(babelHelpers.classPrivateFieldGet(this,f)!==d.DATA_INPUTTING){p(this,C,N).call(this)}babelHelpers.classPrivateFieldSet(this,T,true);p(this,M,x).call(this,t)}},{key:"onInputKeyup",value:function e(t){switch(t.code){case"Tab":case"Esc":case"Enter":case"NumpadEnter":this.resetView();break;default:babelHelpers.classPrivateFieldSet(this,I,true)}}},{key:"resetView",value:function e(){p(this,E,O).call(this,"resetView")}},{key:"render",value:function e(t){if(!n.Type.isDomNode(t.controlWrapper)){BX.debug("props.controlWrapper  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,w,t.controlWrapper);if(babelHelpers.classPrivateFieldGet(this,v)===i.ControlMode.edit){if(!n.Type.isDomNode(t.inputNode)){BX.debug("props.inputNode  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,g,t.inputNode);p(this,M,x).call(this,babelHelpers.classPrivateFieldGet(this,H));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focus",p(this,A,X).bind(this));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"focusout",p(this,_,U).bind(this));n.Event.bind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup.bind(this))}p(this,E,O).call(this,"render",[t])}},{key:"setStateByFeature",value:function e(s){babelHelpers.classPrivateFieldSet(this,f,s);this.emit(t.onStateChangedEvent,{state:s})}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(t.onStateChangedEvent,s)}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(t.onAddressChangedEvent,s)}},{key:"subscribeOnErrorEvent",value:function e(t){i.ErrorPublisher.getInstance().subscribe(t)}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,y)){return}n.Event.unbindAll(this);n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focus",p(this,A,X));n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"focusout",p(this,_,U));n.Event.unbind(babelHelpers.classPrivateFieldGet(this,g),"keyup",this.onInputKeyup);p(this,E,O).call(this,"destroy");p(this,B,Y).call(this);babelHelpers.classPrivateFieldSet(this,y,true)}},{key:"isDestroyed",value:function e(){return babelHelpers.classPrivateFieldGet(this,y)}},{key:"features",get:function e(){return babelHelpers.classPrivateFieldGet(this,m)}},{key:"controlWrapper",get:function e(){return babelHelpers.classPrivateFieldGet(this,w)}},{key:"inputNode",get:function e(){return babelHelpers.classPrivateFieldGet(this,g)}},{key:"address",get:function e(){return babelHelpers.classPrivateFieldGet(this,H)},set:function e(t){if(t&&!(t instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,H,t);p(this,E,O).call(this,"setAddress",[t]);babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,T,false);p(this,M,x).call(this,t)}},{key:"mode",get:function e(){return babelHelpers.classPrivateFieldGet(this,v)},set:function e(t){if(!i.ControlMode.isValid(t)){BX.debug("mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,v,t);p(this,E,O).call(this,"setMode",[t])}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,f)}},{key:"addressFormat",get:function e(){return babelHelpers.classPrivateFieldGet(this,F)}}]);return t}(r.EventEmitter);var v=new WeakMap;var f=new WeakMap;var H=new WeakMap;var F=new WeakMap;var P=new WeakMap;var m=new WeakMap;var g=new WeakMap;var w=new WeakMap;var y=new WeakMap;var T=new WeakMap;var I=new WeakMap;var k=new WeakMap;var G=new WeakMap;var S=new WeakSet;var E=new WeakSet;var C=new WeakSet;var W=new WeakSet;var A=new WeakSet;var z=new WeakSet;var M=new WeakSet;var _=new WeakSet;var B=new WeakSet;babelHelpers.defineProperty(h,"onAddressChangedEvent","onAddressChanged");babelHelpers.defineProperty(h,"onStateChangedEvent","onStateChanged");var L=function e(t){if(!(t instanceof o)){BX.debug("feature must be instance of BaseFeature")}t.setAddressWidget(this);babelHelpers.classPrivateFieldGet(this,m).push(t)};var O=function e(t){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i;var l=b(babelHelpers.classPrivateFieldGet(this,m)),r;try{for(l.s();!(r=l.n()).done;){var n=r.value;if(n!==a){i=n[t].apply(n,s)}}}catch(e){l.e(e)}finally{l.f()}return i};var N=function e(){this.emit(h.onAddressChangedEvent,{address:babelHelpers.classPrivateFieldGet(this,H)});if(babelHelpers.classPrivateFieldGet(this,k)){p(this,W,D).call(this,babelHelpers.classPrivateFieldGet(this,H))}};var D=function e(t){if(t.location!==null&&t.location.id<=0){babelHelpers.classPrivateFieldGet(this,G).findParents(t.location)}};var X=function e(t){var s=babelHelpers.classPrivateFieldGet(this,g);if(s.length>0){BX.setCaretPosition(babelHelpers.classPrivateFieldGet(this,g),s.length-1)}};var R=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,F),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)};var x=function e(t){if(babelHelpers.classPrivateFieldGet(this,g)){var s=p(this,z,R).call(this,t);babelHelpers.classPrivateFieldGet(this,g).value=s;babelHelpers.classPrivateFieldGet(this,g).title=s}};var U=function e(t){if(babelHelpers.classPrivateFieldGet(this,I)&&!babelHelpers.classPrivateFieldGet(this,T)){var s=babelHelpers.classPrivateFieldGet(this,g).value.trim();var a=new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,P)});a.setFieldValue(babelHelpers.classPrivateFieldGet(this,F).fieldForUnRecognized,s);this.address=a;p(this,C,N).call(this)}babelHelpers.classPrivateFieldSet(this,I,false);babelHelpers.classPrivateFieldSet(this,T,false)};var Y=function e(){babelHelpers.classPrivateFieldGet(this,m).splice(0,babelHelpers.classPrivateFieldGet(this,m).length)};var V=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"choseItemIdx",-1);return s}babelHelpers.createClass(t,[{key:"isMenuEmpty",value:function e(){return this.menuItems.length<=0}},{key:"isChoseLastItem",value:function e(){return this.choseItemIdx>=this.menuItems.length-1}},{key:"isChoseFirstItem",value:function e(){return this.choseItemIdx===0}},{key:"isItemChosen",value:function e(){return this.choseItemIdx>=0}},{key:"isDestroyed",value:function e(){return this.getPopupWindow().isDestroyed()}},{key:"isItemExist",value:function e(t){return typeof this.menuItems[this.choseItemIdx]!=="undefined"}},{key:"getChosenItem",value:function e(){var t=null;if(this.isItemChosen()&&this.isItemExist(this.choseItemIdx)){t=this.menuItems[this.choseItemIdx]}return t}},{key:"chooseNextItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseLastItem()){this.chooseItem(this.choseItemIdx+1)}return this.getChosenItem()}},{key:"choosePrevItem",value:function e(){if(!this.isMenuEmpty()&&!this.isChoseFirstItem()){this.chooseItem(this.choseItemIdx-1)}return this.getChosenItem()}},{key:"highlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.add("highlighted")}}}},{key:"unHighlightItem",value:function e(t){if(this.isItemExist(t)){var s=this.getChosenItem();if(s&&s.layout.item){s.layout.item.classList.remove("highlighted")}}}},{key:"chooseItem",value:function e(t){this.unHighlightItem(this.choseItemIdx);this.choseItemIdx=t;this.highlightItem(this.choseItemIdx)}},{key:"clearItems",value:function e(){while(this.menuItems.length>0){this.removeMenuItem(this.menuItems[0].id)}}},{key:"isShown",value:function e(){return this.getPopupWindow().isShown()}}]);return t}(s.Menu);function j(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=q(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function q(e,t){if(!e)return;if(typeof e==="string")return J(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return J(e,t)}function J(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function K(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var $=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));re.add(babelHelpers.assertThisInitialized(s));le.add(babelHelpers.assertThisInitialized(s));ie.add(babelHelpers.assertThisInitialized(s));ae.add(babelHelpers.assertThisInitialized(s));se.add(babelHelpers.assertThisInitialized(s));te.add(babelHelpers.assertThisInitialized(s));Q.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Z.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Prompt");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Q,e.inputNode);return s}babelHelpers.createClass(t,[{key:"show",value:function e(t,s){if(t.length>0){K(this,ae,oe).call(this,t,s);K(this,se,de).call(this).show()}}},{key:"close",value:function e(){K(this,se,de).call(this).close()}},{key:"choosePrevItem",value:function e(){var t=null;var s=K(this,se,de).call(this).choosePrevItem();if(s){t=K(this,re,ue).call(this,s.id)}return t}},{key:"chooseNextItem",value:function e(){var t=null;var s=K(this,se,de).call(this).chooseNextItem();if(s){t=K(this,re,ue).call(this,s.id)}return t}},{key:"isItemChosen",value:function e(){return babelHelpers.classPrivateFieldGet(this,Z).isItemChosen()}},{key:"getChosenItem",value:function e(){var t=null;var s=babelHelpers.classPrivateFieldGet(this,Z).getChosenItem();if(s&&s.id){t=K(this,re,ue).call(this,s.id)}return t}},{key:"isShown",value:function e(){return K(this,se,de).call(this).isShown()}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Z)){babelHelpers.classPrivateFieldGet(this,Z).destroy();babelHelpers.classPrivateFieldSet(this,Z,null)}babelHelpers.classPrivateFieldSet(this,ee,null)}}],[{key:"createMenuItemText",value:function e(t,s){var a=t.slice();if(!s||s.length<=0){return a}var i=s.replace(/,+/gi,"").split(new RegExp(/\s+/g));var l=j(i),r;try{for(l.s();!(r=l.n()).done;){var n=r.value;n=n.trim();if(n.length<=0){continue}a=a.replace(new RegExp(n,"gi"),"###@@@".concat(n,"@@@###"))}}catch(e){l.e(e)}finally{l.f()}a=a.replace(/###@@@/g,"<strong>");a=a.replace(/@@@###/g,"</strong>");return a}}]);return t}(r.EventEmitter);var Q=new WeakMap;var Z=new WeakMap;var ee=new WeakMap;var te=new WeakSet;var se=new WeakSet;var ae=new WeakSet;var ie=new WeakSet;var le=new WeakSet;var re=new WeakSet;babelHelpers.defineProperty($,"onItemSelectedEvent","onItemSelected");var ne=function e(){return new V({bindElement:babelHelpers.classPrivateFieldGet(this,Q),autoHide:false,closeByEsc:true})};var de=function e(){if(!babelHelpers.classPrivateFieldGet(this,Z)||babelHelpers.classPrivateFieldGet(this,Z).isDestroyed()){babelHelpers.classPrivateFieldSet(this,Z,K(this,te,ne).call(this))}return babelHelpers.classPrivateFieldGet(this,Z)};var oe=function e(t,s){var a=this;K(this,se,de).call(this).clearItems();if(Array.isArray(t)){babelHelpers.classPrivateFieldSet(this,ee,t.slice());t.forEach(function(e){K(a,se,de).call(a).addMenuItem(K(a,ie,be).call(a,e,s))})}};var be=function e(t,s){var a=this;var i=t.externalId;return{id:i,text:$.createMenuItemText(t.name,s),onclick:function e(t,s){K(a,le,ce).call(a,i);a.close()}}};var ce=function e(t){var s=K(this,re,ue).call(this,t);if(s){this.emit($.onItemSelectedEvent,{location:s})}};var ue=function e(t){var s=null;var a=j(babelHelpers.classPrivateFieldGet(this,ee)),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;if(l.externalId===t){s=l;break}}}catch(e){a.e(e)}finally{a.f()}if(!s){BX.debug("Location with externalId "+t+" was not found")}return s};function pe(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function he(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function ve(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var fe=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));je.add(babelHelpers.assertThisInitialized(s));Ve.add(babelHelpers.assertThisInitialized(s));Ye.add(babelHelpers.assertThisInitialized(s));Ue.add(babelHelpers.assertThisInitialized(s));xe.add(babelHelpers.assertThisInitialized(s));Re.add(babelHelpers.assertThisInitialized(s));Xe.add(babelHelpers.assertThisInitialized(s));De.add(babelHelpers.assertThisInitialized(s));Ne.add(babelHelpers.assertThisInitialized(s));Oe.add(babelHelpers.assertThisInitialized(s));Le.add(babelHelpers.assertThisInitialized(s));Be.add(babelHelpers.assertThisInitialized(s));_e.add(babelHelpers.assertThisInitialized(s));Me.add(babelHelpers.assertThisInitialized(s));ze.add(babelHelpers.assertThisInitialized(s));Ae.add(babelHelpers.assertThisInitialized(s));We.add(babelHelpers.assertThisInitialized(s));He.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Fe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:""});Pe.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});me.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});we.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ye.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Te.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ie.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ke.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ge.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Se.set(babelHelpers.assertThisInitialized(s),{writable:true,value:{requested:"",current:"",dropped:""}});Ee.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ce.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});s.setEventNamespace("BX.Location.Widget.Autocomplete");if(!(e.addressFormat instanceof i.Format)){throw new Error("props.addressFormat must be type of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),me,e.addressFormat);if(!(e.autocompleteService instanceof i.AutocompleteServiceBase)){throw new Error("props.autocompleteService must be type of AutocompleteServiceBase")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ye,e.autocompleteService);if(!e.languageId){throw new Error("props.languageId must be defined")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Pe,e.languageId);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),He,e.address);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ge,e.locationRepository||new i.LocationRepository);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ie,e.promptDelay||500);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Te,e.minCharsCountToAutocomplete||3);ve(babelHelpers.assertThisInitialized(s),Ne,lt).call(babelHelpers.assertThisInitialized(s),d.INITIAL);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ge,t.inputNode);babelHelpers.classPrivateFieldSet(this,Fe,babelHelpers.classPrivateFieldGet(this,Ge).value);babelHelpers.classPrivateFieldSet(this,He,t.address);babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("keyup",ve(this,Ye,ct).bind(this));babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("focus",ve(this,ze,Ze).bind(this));babelHelpers.classPrivateFieldGet(this,Ge).addEventListener("focusout",ve(this,Ae,Qe).bind(this));babelHelpers.classPrivateFieldSet(this,we,new $({inputNode:t.inputNode}));babelHelpers.classPrivateFieldGet(this,we).subscribe($.onItemSelectedEvent,ve(this,Oe,it).bind(this));document.addEventListener("click",ve(this,Be,st).bind(this))}},{key:"onAddressChangedEventSubscribe",value:function e(s){this.subscribe(he(t,t,Je),s)}},{key:"onStateChangedEventSubscribe",value:function e(s){this.subscribe(he(t,t,Ke),s)}},{key:"showPrompt",value:function e(t,s){babelHelpers.classPrivateFieldGet(this,Se).requested=t;babelHelpers.classPrivateFieldGet(this,Se).current=t;babelHelpers.classPrivateFieldGet(this,Se).dropped="";ve(this,Ve,ut).call(this,t,s,babelHelpers.classPrivateFieldGet(this,Ie))}},{key:"closePrompt",value:function e(){if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).close()}}},{key:"isPromptShown",value:function e(){if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).isShown()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}n.Event.unbindAll(this);if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).destroy();babelHelpers.classPrivateFieldSet(this,we,null)}babelHelpers.classPrivateFieldSet(this,ke,null);if(babelHelpers.classPrivateFieldGet(this,Ge)){babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("keyup",ve(this,Ye,ct));babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("focus",ve(this,ze,Ze));babelHelpers.classPrivateFieldGet(this,Ge).removeEventListener("focusout",ve(this,Ae,Qe))}document.removeEventListener("click",ve(this,Be,st));babelHelpers.classPrivateFieldSet(this,Ce,true)}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,He,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,He)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ee)}}]);return t}(r.EventEmitter);var He=new WeakMap;var Fe=new WeakMap;var Pe=new WeakMap;var me=new WeakMap;var ge=new WeakMap;var we=new WeakMap;var ye=new WeakMap;var Te=new WeakMap;var Ie=new WeakMap;var ke=new WeakMap;var Ge=new WeakMap;var Se=new WeakMap;var Ee=new WeakMap;var Ce=new WeakMap;var We=new WeakSet;var Ae=new WeakSet;var ze=new WeakSet;var Me=new WeakSet;var _e=new WeakSet;var Be=new WeakSet;var Le=new WeakSet;var Oe=new WeakSet;var Ne=new WeakSet;var De=new WeakSet;var Xe=new WeakSet;var Re=new WeakSet;var xe=new WeakSet;var Ue=new WeakSet;var Ye=new WeakSet;var Ve=new WeakSet;var je=new WeakSet;var qe=function e(t){t=t.trim();if(t.length<=0){return["",""]}var s=t.lastIndexOf(" ");if(s<=0){return["",""]}return[t.slice(0,s),t.slice(s+1)]};var Je={writable:true,value:"onAddressChanged"};var Ke={writable:true,value:"onStateChanged"};var $e=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,me),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)};var Qe=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,Ee)===d.DATA_INPUTTING){ve(this,Ne,lt).call(this,d.DATA_SELECTED);ve(this,_e,tt).call(this)}if(babelHelpers.classPrivateFieldGet(this,we)){babelHelpers.classPrivateFieldGet(this,we).close()}};var Ze=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,He)&&!babelHelpers.classPrivateFieldGet(this,He).location&&babelHelpers.classPrivateFieldGet(this,Ge).value.length>0){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ge).value,{})}};var et=function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,Ge)){t=babelHelpers.classPrivateFieldGet(this,Ge).value}return t};var tt=function e(){babelHelpers.classPrivateFieldSet(this,He,ve(this,xe,ot).call(this,ve(this,Me,et).call(this)));ve(this,Xe,nt).call(this)};var st=function e(){if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,we).isShown()){babelHelpers.classPrivateFieldGet(this,we).close()}};var at=function e(t,s){if(Array.isArray(t)&&t.length>0){babelHelpers.classPrivateFieldGet(this,we).show(t,babelHelpers.classPrivateFieldGet(this,Se).requested)}else{var a=pe(fe,fe,qe).call(fe,babelHelpers.classPrivateFieldGet(this,Se).current);babelHelpers.classPrivateFieldGet(this,Se).current=a[0];babelHelpers.classPrivateFieldGet(this,Se).dropped=a[1]+" "+babelHelpers.classPrivateFieldGet(this,Se).dropped;if(babelHelpers.classPrivateFieldGet(this,Se).current.length>0){ve(this,Ve,ut).call(this,babelHelpers.classPrivateFieldGet(this,Se).current,s,1)}}};var it=function e(t){if(t.data.location){ve(this,De,rt).call(this,t.data.location)}};var lt=function e(t){babelHelpers.classPrivateFieldSet(this,Ee,t);this.emit(he(fe,fe,Ke),{state:babelHelpers.classPrivateFieldGet(this,Ee)})};var rt=function e(t){var s=this;var a;ve(this,Ne,lt).call(this,d.DATA_SELECTED);if(t){a=ve(this,Re,dt).call(this,t).then(function(e){ve(s,Ue,bt).call(s,e);return true},function(e){return BX.debug(e)})}else{a=new Promise(function(e){ve(s,Ue,bt).call(s,null);e()})}return a};var nt=function e(){babelHelpers.classPrivateFieldSet(this,Fe,babelHelpers.classPrivateFieldGet(this,He)?ve(this,We,$e).call(this,babelHelpers.classPrivateFieldGet(this,He)):"");this.emit(he(fe,fe,Je),{address:babelHelpers.classPrivateFieldGet(this,He)})};var dt=function e(t){var s=this;ve(this,Ne,lt).call(this,d.DATA_LOADING);return babelHelpers.classPrivateFieldGet(this,ge).findByExternalId(t.externalId,t.sourceCode,t.languageId).then(function(e){ve(s,Ne,lt).call(s,d.DATA_LOADED);return e},function(e){i.ErrorPublisher.getInstance().notify(e.errors)})};var ot=function e(t){var s=new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,Pe)});s.setFieldValue(babelHelpers.classPrivateFieldGet(this,me).fieldForUnRecognized,t);return s};var bt=function e(t){babelHelpers.classPrivateFieldSet(this,He,t?t.toAddress():null);if(babelHelpers.classPrivateFieldGet(this,He)&&babelHelpers.classPrivateFieldGet(this,Se).dropped.length>0){babelHelpers.classPrivateFieldGet(this,He).setFieldValue(babelHelpers.classPrivateFieldGet(this,me).fieldForUnRecognized,babelHelpers.classPrivateFieldGet(this,Se).dropped)}ve(this,Xe,nt).call(this)};var ct=function e(t){var s=this;if(babelHelpers.classPrivateFieldGet(this,Ce)){return}if(babelHelpers.classPrivateFieldGet(this,Ee)!==d.DATA_INPUTTING){ve(this,Ne,lt).call(this,d.DATA_INPUTTING)}if(babelHelpers.classPrivateFieldGet(this,we).isShown()){switch(t.code){case"NumpadEnter":case"Enter":if(babelHelpers.classPrivateFieldGet(this,we).isItemChosen()){ve(this,De,rt).call(this,babelHelpers.classPrivateFieldGet(this,we).getChosenItem()).then(function(){babelHelpers.classPrivateFieldGet(s,we).close()},function(e){return BX.debug(e)})}return;case"Tab":case"Escape":ve(this,Ne,lt).call(this,d.DATA_SELECTED);ve(this,_e,tt).call(this);babelHelpers.classPrivateFieldGet(this,we).close();return;case"ArrowUp":babelHelpers.classPrivateFieldGet(this,we).choosePrevItem();return;case"ArrowDown":babelHelpers.classPrivateFieldGet(this,we).chooseNextItem();return}}if(babelHelpers.classPrivateFieldGet(this,Fe).trim()!==ve(this,Me,et).call(this).trim()){this.showPrompt(babelHelpers.classPrivateFieldGet(this,Ge).value,{});ve(this,_e,tt).call(this)}};var ut=function e(t,s,a){if(t.length>babelHelpers.classPrivateFieldGet(this,Te)){if(babelHelpers.classPrivateFieldGet(this,ke)!==null){clearTimeout(babelHelpers.classPrivateFieldGet(this,ke))}babelHelpers.classPrivateFieldSet(this,ke,ve(this,je,pt).call(this,t,s,a))}};var pt=function e(t,s,a){var i=this;return setTimeout(function(){babelHelpers.classPrivateFieldGet(i,ye).autocomplete(t,s).then(function(e){babelHelpers.classPrivateFieldSet(i,ke,null);ve(i,Le,at).call(i,e,s)},function(e){return BX.debug(e)})},a)};function ht(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-address-container">\n\t\t\t\t<div class="location-map-address-icon"></div>\n\t\t\t\t',"\n\t\t\t</div>"]);ht=function t(){return e};return e}function vt(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-address-text">',"</div>"]);vt=function t(){return e};return e}function ft(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Ht=function(){function e(t){babelHelpers.classCallCheck(this,e);wt.add(this);Ft.set(this,{writable:true,value:void 0});Pt.set(this,{writable:true,value:void 0});mt.set(this,{writable:true,value:void 0});gt.set(this,{writable:true,value:void 0});if(!(t.addressFormat instanceof i.Format)){throw new Error("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(this,gt,t.addressFormat);babelHelpers.classPrivateFieldSet(this,Ft,t.address)}babelHelpers.createClass(e,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ft,t.address);babelHelpers.classPrivateFieldSet(this,mt,n.Tag.render(vt(),ft(this,wt,yt).call(this,babelHelpers.classPrivateFieldGet(this,Ft))));babelHelpers.classPrivateFieldSet(this,Pt,n.Tag.render(ht(),babelHelpers.classPrivateFieldGet(this,mt)));return babelHelpers.classPrivateFieldGet(this,Pt)}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Pt)){babelHelpers.classPrivateFieldGet(this,Pt).style.display="block"}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Pt)){babelHelpers.classPrivateFieldGet(this,Pt).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,Pt)||babelHelpers.classPrivateFieldGet(this,Pt).style.display==="none"}},{key:"address",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ft,t);if(!babelHelpers.classPrivateFieldGet(this,mt)){return}babelHelpers.classPrivateFieldGet(this,mt).innerHTML=ft(this,wt,yt).call(this,t);if(!t&&!this.isHidden()){this.hide()}else if(t&&this.isHidden()){this.show()}}}]);return e}();var Ft=new WeakMap;var Pt=new WeakMap;var mt=new WeakMap;var gt=new WeakMap;var wt=new WeakSet;var yt=function e(t){if(!t){return""}return t.toString(babelHelpers.classPrivateFieldGet(this,gt),i.AddressStringConverter.STRATEGY_TYPE_FIELD_SORT)};var Tt=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));It.set(babelHelpers.assertThisInitialized(s),{writable:true,value:20});return s}babelHelpers.createClass(t,[{key:"getBindElement",value:function e(){return this.bindElement}},{key:"adjustPosition",value:function e(s){if(this.bindOptions.position&&this.bindOptions.position==="right"){var a=this.bindElement.getBoundingClientRect();var i=a.width;var l=a.height/2+babelHelpers.classPrivateFieldGet(this,It);var r=a.height/2;var n=this.getPopupContainer().offsetWidth;var d=this.getPopupContainer().offsetHeight;var o=a.top+d;var b=document.documentElement.clientWidth;var c=document.documentElement.clientHeight;var u=o-c;if(u>0){var p=Math.ceil(u/a.height)*a.height;if(p>a.top){p-=Math.ceil((p-a.top)/a.height)*a.height}if(a.bottom>o-p){p-=a.bottom-(o-p)+babelHelpers.classPrivateFieldGet(this,It)}l+=p;r+=p+babelHelpers.classPrivateFieldGet(this,It)}if(a.left+i+n<=b){this.setOffset({offsetLeft:i,offsetTop:-l});this.setAngle({position:"left",offset:r})}else{this.setAngle(true)}}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"adjustPosition",this).call(this,s)}}]);return t}(s.Popup);var It=new WeakMap;function kt(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-wrapper">\n\t\t\t\t<div class="location-map-container">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>"]);kt=function t(){return e};return e}function Gt(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-map-inner"></div>']);Gt=function t(){return e};return e}function St(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Et(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var Ct=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Vt.add(babelHelpers.assertThisInitialized(s));Yt.add(babelHelpers.assertThisInitialized(s));Ut.add(babelHelpers.assertThisInitialized(s));xt.add(babelHelpers.assertThisInitialized(s));Wt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});At.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});zt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Mt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});_t.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Bt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Lt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ot.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Nt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});Dt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Rt.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.MapPopup");if(!(e.map instanceof i.MapBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Wt,e.map);if(!(e.geocodingService instanceof i.GeocodingServiceBase)){BX.debug("map must be instance of Map")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Xt,e.geocodingService);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wt).onLocationChangedEventSubscribe(function(e){var a=e.getData(),i=a.location,l=i.toAddress();babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),zt,l);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),_t).address=l;babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Lt).location=i;s.emit(Et(t,t,jt),{address:l})});if(!(e.popup instanceof Tt)){BX.debug("popup must be instance of Popup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Mt,e.popup);if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Bt,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),_t,new Ht({addressFormat:babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Bt)}));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Lt,e.gallery);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ot,e.locationRepository);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,zt,t.address);babelHelpers.classPrivateFieldSet(this,At,t.mode);babelHelpers.classPrivateFieldSet(this,Nt,false);babelHelpers.classPrivateFieldSet(this,Dt,n.Tag.render(Gt()));St(this,xt,Qt).call(this,t.bindElement,babelHelpers.classPrivateFieldGet(this,Dt))}},{key:"show",value:function e(){var s=this;St(this,Ut,Zt).call(this,babelHelpers.classPrivateFieldGet(this,zt)).then(function(e){if(!e){return}babelHelpers.classPrivateFieldGet(s,Mt).show();if(!babelHelpers.classPrivateFieldGet(s,Nt)){St(s,Vt,ts).call(s,{location:e}).then(function(){babelHelpers.classPrivateFieldGet(s,Lt).location=e;s.emit(Et(t,t,Kt))});babelHelpers.classPrivateFieldSet(s,Nt,true)}else{babelHelpers.classPrivateFieldGet(s,Lt).location=e;s.emit(Et(t,t,Kt))}})}},{key:"isShown",value:function e(){return babelHelpers.classPrivateFieldGet(this,Mt).isShown()}},{key:"close",value:function e(){babelHelpers.classPrivateFieldGet(this,Mt).close();this.emit(Et(t,t,$t))}},{key:"onChangedEventSubscribe",value:function e(s){this.subscribe(Et(t,t,jt),s)}},{key:"onMouseOverSubscribe",value:function e(s){this.subscribe(Et(t,t,qt),s)}},{key:"onMouseOutSubscribe",value:function e(s){this.subscribe(Et(t,t,Jt),s)}},{key:"subscribeOnShowedEvent",value:function e(s){this.subscribe(Et(t,t,Kt),s)}},{key:"subscribeOnClosedEvent",value:function e(s){this.subscribe(Et(t,t,$t),s)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldSet(this,Wt,null);babelHelpers.classPrivateFieldSet(this,Lt,null);babelHelpers.classPrivateFieldSet(this,_t,null);babelHelpers.classPrivateFieldGet(this,Mt).destroy();babelHelpers.classPrivateFieldSet(this,Mt,null);n.Dom.remove(babelHelpers.classPrivateFieldGet(this,Rt));babelHelpers.classPrivateFieldSet(this,Rt,null);n.Event.unbindAll(this)}},{key:"bindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Mt).getBindElement()},set:function e(t){if(n.Type.isDomNode(t)){babelHelpers.classPrivateFieldGet(this,Mt).setBindElement(t)}else{BX.debug("bindElement must be type of dom node")}}},{key:"address",set:function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,zt,t);babelHelpers.classPrivateFieldGet(this,_t).address=t;St(this,Ut,Zt).call(this,t).then(function(e){St(s,Yt,es).call(s,e)})}},{key:"mode",set:function e(t){babelHelpers.classPrivateFieldSet(this,At,t);babelHelpers.classPrivateFieldGet(this,Wt).mode=t}}]);return t}(r.EventEmitter);var Wt=new WeakMap;var At=new WeakMap;var zt=new WeakMap;var Mt=new WeakMap;var _t=new WeakMap;var Bt=new WeakMap;var Lt=new WeakMap;var Ot=new WeakMap;var Nt=new WeakMap;var Dt=new WeakMap;var Xt=new WeakMap;var Rt=new WeakMap;var xt=new WeakSet;var Ut=new WeakSet;var Yt=new WeakSet;var Vt=new WeakSet;var jt={writable:true,value:"onChanged"};var qt={writable:true,value:"onMouseOver"};var Jt={writable:true,value:"onMouseOut"};var Kt={writable:true,value:"onShow"};var $t={writable:true,value:"onClose"};var Qt=function e(t,s){var a=this;babelHelpers.classPrivateFieldSet(this,Rt,n.Tag.render(kt(),s,babelHelpers.classPrivateFieldGet(this,Lt).render(),babelHelpers.classPrivateFieldGet(this,At)===i.ControlMode.edit?babelHelpers.classPrivateFieldGet(this,_t).render({address:babelHelpers.classPrivateFieldGet(this,zt)}):""));n.Event.bind(babelHelpers.classPrivateFieldGet(this,Rt),"click",function(e){return e.stopPropagation()});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Rt),"mouseover",function(e){return a.emit(Et(Ct,Ct,qt),e)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Rt),"mouseout",function(e){return a.emit(Et(Ct,Ct,Jt),e)});this.bindElement=t;babelHelpers.classPrivateFieldGet(this,Mt).setContent(babelHelpers.classPrivateFieldGet(this,Rt))};var Zt=function e(t){var s=this;return new Promise(function(e){var a=t?t.toLocation():null;if(a){if(!a.latitude&&!a.longitude&&t.latitude&&t.longitude){a.latitude=t.latitude;a.longitude=t.longitude}if(a.latitude&&a.longitude){e(a);return}}var l=null;if(t){l=t.toString(babelHelpers.classPrivateFieldGet(s,Bt),i.AddressStringConverter.STRATEGY_TYPE_FIELD_TYPE,i.AddressStringConverter.CONTENT_TYPE_TEXT)}babelHelpers.classPrivateFieldGet(s,Xt).geocode(l).then(function(t){var s=t.length===1?t[0]:null;e(s)})})};var es=function e(t){babelHelpers.classPrivateFieldGet(this,Wt).location=t;babelHelpers.classPrivateFieldGet(this,Lt).location=t};var ts=function e(t){var s=t.location;return babelHelpers.classPrivateFieldGet(this,Wt).render({mapContainer:babelHelpers.classPrivateFieldGet(this,Dt),location:s,mode:babelHelpers.classPrivateFieldGet(this,At)})};function ss(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-item-block">\n\t\t\t\t<span class="location-map-photo-item-block-image-block-inner">\n\t\t\t\t\t','\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type="image" \n\t\t\t\t\t\tdata-src="','" \n\t\t\t\t\t\tdata-title="','"\n\t\t\t\t\t\tclass="location-map-item-photo-image" \n\t\t\t\t\t\tdata-viewer-group-by="','"\n\t\t\t\t\t\tstyle="background-image: url(',');">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>']);ss=function t(){return e};return e}function as(){var e=babelHelpers.taggedTemplateLiteral(['<span class="location-map-item-description">',"</span>"]);as=function t(){return e};return e}var is=function(){function e(t){babelHelpers.classCallCheck(this,e);ls.set(this,{writable:true,value:void 0});rs.set(this,{writable:true,value:void 0});ns.set(this,{writable:true,value:void 0});ds.set(this,{writable:true,value:void 0});os.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,rs,t.url);babelHelpers.classPrivateFieldSet(this,ns,t.link||"");babelHelpers.classPrivateFieldSet(this,ls,t.description||"");babelHelpers.classPrivateFieldSet(this,ds,t.location);babelHelpers.classPrivateFieldSet(this,os,t.title||"")}babelHelpers.createClass(e,[{key:"render",value:function e(){var t="";if(babelHelpers.classPrivateFieldGet(this,ls)){t=n.Tag.render(as(),babelHelpers.classPrivateFieldGet(this,ls))}return n.Tag.render(ss(),t,babelHelpers.classPrivateFieldGet(this,ns),babelHelpers.classPrivateFieldGet(this,os),babelHelpers.classPrivateFieldGet(this,ds).externalId,babelHelpers.classPrivateFieldGet(this,rs))}}]);return e}();var ls=new WeakMap;var rs=new WeakMap;var ns=new WeakMap;var ds=new WeakMap;var os=new WeakMap;function bs(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=cs(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function cs(e,t){if(!e)return;if(typeof e==="string")return us(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return us(e,t)}function us(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function ps(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="location-map-photo-container">\n\t\t\t\t',"\n\t\t\t</div>"]);ps=function t(){return e};return e}function hs(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\n\t\t\t\t<div class="location-map-photo-inner">\t\t\t\t\t\n\t\t\t\t</div>']);hs=function t(){return e};return e}function vs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var fs=function(){function e(t){babelHelpers.classCallCheck(this,e);ks.add(this);Is.add(this);Hs.set(this,{writable:true,value:[]});Fs.set(this,{writable:true,value:null});Ps.set(this,{writable:true,value:null});ms.set(this,{writable:true,value:void 0});gs.set(this,{writable:true,value:void 0});ws.set(this,{writable:true,value:void 0});ys.set(this,{writable:true,value:void 0});Ts.set(this,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ms,t.thumbnailHeight);babelHelpers.classPrivateFieldSet(this,gs,t.thumbnailWidth);babelHelpers.classPrivateFieldSet(this,ys,t.maxPhotoCount);babelHelpers.classPrivateFieldSet(this,ws,t.photoService)}babelHelpers.createClass(e,[{key:"refresh",value:function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Ts)){babelHelpers.classPrivateFieldGet(this,ws).requestPhotos({location:babelHelpers.classPrivateFieldGet(this,Ts),thumbnailHeight:babelHelpers.classPrivateFieldGet(this,ms),thumbnailWidth:babelHelpers.classPrivateFieldGet(this,gs),maxPhotoCount:babelHelpers.classPrivateFieldGet(this,ys)}).then(function(e){if(Array.isArray(e)&&e.length>0){vs(t,Is,Gs).call(t,e);t.show()}else{t.hide()}})}else{this.hide()}}},{key:"hide",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Fs)){babelHelpers.classPrivateFieldGet(this,Fs).style.display="none"}}},{key:"isHidden",value:function e(){return!babelHelpers.classPrivateFieldGet(this,Fs)||babelHelpers.classPrivateFieldGet(this,Fs).clientWidth<=0}},{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Fs)){babelHelpers.classPrivateFieldGet(this,Fs).style.display="block"}}},{key:"render",value:function e(){babelHelpers.classPrivateFieldSet(this,Ps,n.Tag.render(hs()));babelHelpers.classPrivateFieldSet(this,Fs,n.Tag.render(ps(),babelHelpers.classPrivateFieldGet(this,Ps)));return babelHelpers.classPrivateFieldGet(this,Fs)}},{key:"location",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ts,t);this.refresh()}}]);return e}();var Hs=new WeakMap;var Fs=new WeakMap;var Ps=new WeakMap;var ms=new WeakMap;var gs=new WeakMap;var ws=new WeakMap;var ys=new WeakMap;var Ts=new WeakMap;var Is=new WeakSet;var ks=new WeakSet;var Gs=function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ts)){return}var s=[];var a=bs(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(new is({url:l.thumbnail.url,link:l.url,location:babelHelpers.classPrivateFieldGet(this,Ts),title:babelHelpers.classPrivateFieldGet(this,Ts).name+" ( "+BX.util.strip_tags(l.description)+" )"}))}}catch(e){a.e(e)}finally{a.f()}if(!Array.isArray(s)){BX.debug("Wrong type of photos. Must be array");return}babelHelpers.classPrivateFieldSet(this,Hs,[]);for(var r=0,n=s;r<n.length;r++){var d=n[r];babelHelpers.classPrivateFieldGet(this,Hs).push(d)}if(babelHelpers.classPrivateFieldGet(this,Hs).length>0&&babelHelpers.classPrivateFieldGet(this,Ps)){var o=babelHelpers.classPrivateFieldGet(this,Hs)?vs(this,ks,Ss).call(this,babelHelpers.classPrivateFieldGet(this,Hs)):"";babelHelpers.classPrivateFieldGet(this,Ps).innerHTML="";if(o.length>0){var b=bs(o),c;try{for(b.s();!(c=b.n()).done;){var u=c.value;babelHelpers.classPrivateFieldGet(this,Ps).appendChild(u)}}catch(e){b.e(e)}finally{b.f()}}}};var Ss=function e(t){var s=[];var a=bs(t),i;try{for(a.s();!(i=a.n()).done;){var l=i.value;s.push(l.render())}}catch(e){a.e(e)}finally{a.f()}return s};function Es(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-title-6">\n\t\t\t\t',"\n\t\t\t</div>"]);Es=function t(){return e};return e}function Cs(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-entity-editor-content-block">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);Cs=function t(){return e};return e}function Ws(){var e=babelHelpers.taggedTemplateLiteral(['<input type="text" class="ui-ctl-element" value="','">']);Ws=function t(){return e};return e}function As(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-entity-editor-content-block ui-entity-editor-field-text">\n\t\t\t\t<div class="ui-entity-editor-block-title">\n\t\t\t\t\t<label class="ui-entity-editor-block-title-text">',":</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>"]);As=function t(){return e};return e}function zs(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function Ms(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}var _s=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));qs.add(babelHelpers.assertThisInitialized(s));js.add(babelHelpers.assertThisInitialized(s));Vs.add(babelHelpers.assertThisInitialized(s));Ys.add(babelHelpers.assertThisInitialized(s));Bs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ls.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Os.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ns.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Ds.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Rs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});xs.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Us.set(babelHelpers.assertThisInitialized(s),{writable:true,value:d.INITIAL});s.setEventNamespace("BX.Location.Widget.Field");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Bs,e.title);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Os,e.type);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ns,e.sort);return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ls,typeof t.value==="string"?t.value:"");if(!i.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,Ds,t.mode);babelHelpers.classPrivateFieldSet(this,xs,n.Tag.render(As(),babelHelpers.classPrivateFieldGet(this,Bs)));if(babelHelpers.classPrivateFieldGet(this,Ds)===i.ControlMode.edit){zs(this,Vs,Qs).call(this,babelHelpers.classPrivateFieldGet(this,xs))}else{zs(this,js,Zs).call(this,babelHelpers.classPrivateFieldGet(this,xs))}return babelHelpers.classPrivateFieldGet(this,xs)}},{key:"subscribeOnValueChangedEvent",value:function e(s){this.subscribe(Ms(t,t,Js),s)}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(Ms(t,t,Ks),s)}},{key:"destroy",value:function e(){n.Dom.remove(babelHelpers.classPrivateFieldGet(this,xs));n.Event.unbindAll(this);babelHelpers.classPrivateFieldSet(this,xs,null)}},{key:"container",get:function e(){return babelHelpers.classPrivateFieldGet(this,xs)}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,Us)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,Os,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Os)}},{key:"sort",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ns,t)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ns)}},{key:"value",set:function e(t){babelHelpers.classPrivateFieldSet(this,Ls,typeof t==="string"?t:"");zs(this,qs,ea).call(this)},get:function e(){return babelHelpers.classPrivateFieldGet(this,Ls)}}]);return t}(r.EventEmitter);var Bs=new WeakMap;var Ls=new WeakMap;var Os=new WeakMap;var Ns=new WeakMap;var Ds=new WeakMap;var Xs=new WeakMap;var Rs=new WeakMap;var xs=new WeakMap;var Us=new WeakMap;var Ys=new WeakSet;var Vs=new WeakSet;var js=new WeakSet;var qs=new WeakSet;var Js={writable:true,value:"onValueChanged"};var Ks={writable:true,value:"onStateChanged"};var $s=function e(t){babelHelpers.classPrivateFieldSet(this,Us,t);this.emit(Ms(_s,_s,Ks),{state:babelHelpers.classPrivateFieldGet(this,Us)})};var Qs=function e(t){var s=this;babelHelpers.classPrivateFieldSet(this,Xs,n.Tag.render(Ws(),n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ls))));babelHelpers.classPrivateFieldSet(this,Rs,null);n.Event.bind(babelHelpers.classPrivateFieldGet(this,Xs),"focus",function(e){zs(s,Ys,$s).call(s,d.DATA_INPUTTING)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Xs),"focusout",function(e){zs(s,Ys,$s).call(s,d.DATA_SELECTED)});n.Event.bind(babelHelpers.classPrivateFieldGet(this,Xs),"change",function(e){zs(s,Ys,$s).call(s,d.DATA_SELECTED);babelHelpers.classPrivateFieldSet(s,Ls,babelHelpers.classPrivateFieldGet(s,Xs).value);s.emit(Ms(_s,_s,Js),{value:s})});t.appendChild(n.Tag.render(Cs(),babelHelpers.classPrivateFieldGet(this,Xs)))};var Zs=function e(t){babelHelpers.classPrivateFieldSet(this,Xs,null);babelHelpers.classPrivateFieldSet(this,Rs,n.Tag.render(Es(),n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ls))));t.appendChild(babelHelpers.classPrivateFieldGet(this,Rs))};var ea=function e(){if(babelHelpers.classPrivateFieldGet(this,Ds)===i.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Xs).value=babelHelpers.classPrivateFieldGet(this,Ls)}else{babelHelpers.classPrivateFieldGet(this,Rs).innerHTML=n.Text.encode(babelHelpers.classPrivateFieldGet(this,Ls))}};function ta(e){if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(e=sa(e))){var t=0;var s=function e(){};return{s:s,n:function s(){if(t>=e.length)return{done:true};return{done:false,value:e[t++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=true,l=false,r;return{s:function t(){a=e[Symbol.iterator]()},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;r=t},f:function e(){try{if(!i&&a.return!=null)a.return()}finally{if(l)throw r}}}}function sa(e,t){if(!e)return;if(typeof e==="string")return aa(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor)s=e.constructor.name;if(s==="Map"||s==="Set")return Array.from(s);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return aa(e,t)}function aa(e,t){if(t==null||t>e.length)t=e.length;for(var s=0,a=new Array(t);s<t;s++){a[s]=e[s]}return a}function ia(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function la(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ra=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));fa.add(babelHelpers.assertThisInitialized(s));va.add(babelHelpers.assertThisInitialized(s));ha.add(babelHelpers.assertThisInitialized(s));na.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});da.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});oa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ba.set(babelHelpers.assertThisInitialized(s),{writable:true,value:[]});ca.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});ua.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});pa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});s.setEventNamespace("BX.Location.Widget.Fields");if(!(e.addressFormat instanceof i.Format)){BX.debug("addressFormat must be instance of Format")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),da,e.addressFormat);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ca,e.languageId);la(babelHelpers.assertThisInitialized(s),ha,Pa).call(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(t.address&&!(t.address instanceof i.Address)){BX.debug("props.address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,na,t.address);if(!i.ControlMode.isValid(t.mode)){BX.debug("props.mode must be valid ControlMode")}babelHelpers.classPrivateFieldSet(this,oa,t.mode);if(!n.Type.isDomNode(t.container)){BX.debug("props.container must be dom node")}babelHelpers.classPrivateFieldSet(this,ua,t.container);var s=ta(babelHelpers.classPrivateFieldGet(this,ba)),a;try{for(s.s();!(a=s.n()).done;){var l=a.value;var r=babelHelpers.classPrivateFieldGet(this,na)?babelHelpers.classPrivateFieldGet(this,na).getFieldValue(l.type):"";if(babelHelpers.classPrivateFieldGet(this,oa)===i.ControlMode.view&&!r){continue}var d=l.render({value:r,mode:babelHelpers.classPrivateFieldGet(this,oa)});babelHelpers.classPrivateFieldGet(this,ua).appendChild(d)}}catch(e){s.e(e)}finally{s.f()}}},{key:"subscribeOnAddressChangedEvent",value:function e(s){this.subscribe(ia(t,t,Ha),s)}},{key:"destroy",value:function e(){n.Event.unbindAll(this);var t=ta(babelHelpers.classPrivateFieldGet(this,ba)),s;try{for(t.s();!(s=t.n()).done;){var a=s.value;a.destroy()}}catch(e){t.e(e)}finally{t.f()}n.Dom.clean(babelHelpers.classPrivateFieldGet(this,ua))}},{key:"subscribeOnStateChangedEvent",value:function e(s){this.subscribe(ia(t,t,Fa),s)}},{key:"address",set:function e(t){if(t&&!(t instanceof i.Address)){BX.debug("address must be instance of Address")}babelHelpers.classPrivateFieldSet(this,na,t);var s=ta(babelHelpers.classPrivateFieldGet(this,ba)),a;try{for(s.s();!(a=s.n()).done;){var l=a.value;l.value=babelHelpers.classPrivateFieldGet(this,na)?babelHelpers.classPrivateFieldGet(this,na).getFieldValue(l.type):""}}catch(e){s.e(e)}finally{s.f()}}},{key:"state",get:function e(){return babelHelpers.classPrivateFieldGet(this,pa)}}]);return t}(r.EventEmitter);var na=new WeakMap;var da=new WeakMap;var oa=new WeakMap;var ba=new WeakMap;var ca=new WeakMap;var ua=new WeakMap;var pa=new WeakMap;var ha=new WeakSet;var va=new WeakSet;var fa=new WeakSet;var Ha={writable:true,value:"onAddressChanged"};var Fa={writable:true,value:"onStateChanged"};var Pa=function e(){var t=this;var s=function e(s){if(!babelHelpers.classPrivateFieldGet(t,da).fieldCollection.fields.hasOwnProperty(s)){return"continue"}var a=babelHelpers.classPrivateFieldGet(t,da).fieldCollection.fields[s];var i=new _s({title:a.name,type:a.type,sort:a.sort});i.subscribeOnValueChangedEvent(function(e){la(t,va,ma).call(t,i)});i.subscribeOnStateChangedEvent(function(e){var s=e.getData();la(t,fa,ga).call(t,s.state)});babelHelpers.classPrivateFieldGet(t,ba).push(i)};for(var a in babelHelpers.classPrivateFieldGet(this,da).fieldCollection.fields){var i=s(a);if(i==="continue")continue}babelHelpers.classPrivateFieldGet(this,ba).sort(function(e,t){return e.sort-t.sort})};var ma=function e(t){if(!babelHelpers.classPrivateFieldGet(this,na)){babelHelpers.classPrivateFieldSet(this,na,new i.Address({languageId:babelHelpers.classPrivateFieldGet(this,ca)}))}babelHelpers.classPrivateFieldGet(this,na).latitude="";babelHelpers.classPrivateFieldGet(this,na).longitude="";babelHelpers.classPrivateFieldGet(this,na).setFieldValue(t.type,t.value);if(t.type!==babelHelpers.classPrivateFieldGet(this,da).fieldForUnRecognized){babelHelpers.classPrivateFieldGet(this,na).location=null}this.emit(ia(ra,ra,Ha),{address:babelHelpers.classPrivateFieldGet(this,na),changedField:t})};var ga=function e(t){babelHelpers.classPrivateFieldSet(this,pa,t);this.emit(ia(ra,ra,Fa),{state:babelHelpers.classPrivateFieldGet(this,pa)})};var wa=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ya.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ta.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ia.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.map instanceof Ct)){BX.debug("props.map must be instance of MapPopup")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),ya,e.map);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),ya).onChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ia).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});return s}babelHelpers.createClass(t,[{key:"showMap",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,ya).isShown()){babelHelpers.classPrivateFieldGet(this,ya).show()}}},{key:"closeMap",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ya).isShown()){babelHelpers.classPrivateFieldGet(this,ya).close()}babelHelpers.classPrivateFieldGet(this,ya).bindelement=babelHelpers.classPrivateFieldGet(this,Ta)}},{key:"resetView",value:function e(){this.closeMap()}},{key:"render",value:function e(t){if(!n.Type.isDomNode(t.mapBindElement)){BX.debug("props.mapBindElement  must be instance of Element")}babelHelpers.classPrivateFieldSet(this,Ta,t.mapBindElement);babelHelpers.classPrivateFieldGet(this,ya).render({bindElement:t.mapBindElement,address:babelHelpers.classPrivateFieldGet(this,Ia).address,mode:babelHelpers.classPrivateFieldGet(this,Ia).mode})}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===d.DATA_INPUTTING){return}babelHelpers.classPrivateFieldGet(this,ya).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ia,t)}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,ya).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,ya).destroy();babelHelpers.classPrivateFieldSet(this,ya,null)}},{key:"map",get:function e(){return babelHelpers.classPrivateFieldGet(this,ya)}},{key:"addressWidget",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ia)}},{key:"mapBindElement",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ta)}}]);return t}(o);var ya=new WeakMap;var Ta=new WeakMap;var Ia=new WeakMap;var ka=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Ga.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Sa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.autocomplete instanceof fe)){BX.debug("props.autocomplete  must be instance of Autocomplete")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ga,e.autocomplete);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ga).onAddressChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Sa).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ga).onStateChangedEventSubscribe(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Sa).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"resetView",value:function e(){babelHelpers.classPrivateFieldGet(this,Ga).closePrompt()}},{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Sa).mode===i.ControlMode.edit){babelHelpers.classPrivateFieldGet(this,Ga).render({inputNode:babelHelpers.classPrivateFieldGet(this,Sa).inputNode,address:babelHelpers.classPrivateFieldGet(this,Sa).address,mode:babelHelpers.classPrivateFieldGet(this,Sa).mode})}}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ga).address=t}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Sa,t)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ga).destroy();babelHelpers.classPrivateFieldSet(this,Ga,null)}}]);return t}(o);var Ga=new WeakMap;var Sa=new WeakMap;var Ea=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Ca.set(babelHelpers.assertThisInitialized(s),{writable:true,value:void 0});Wa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});if(!(e.fields instanceof ra)){BX.debug("props.Fields must be instance of Fields")}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),Ca,e.fields);babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ca).subscribeOnAddressChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wa).setAddressByFeature(t.address,babelHelpers.assertThisInitialized(s))});babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Ca).subscribeOnStateChangedEvent(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),Wa).setStateByFeature(t.state)});return s}babelHelpers.createClass(t,[{key:"render",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,Wa).mode===i.ControlMode.edit){if(!n.Type.isDomNode(t.fieldsContainer)){BX.debug("props.fieldsContainer  must be instance of Element")}babelHelpers.classPrivateFieldGet(this,Ca).render({address:babelHelpers.classPrivateFieldGet(this,Wa).address,mode:babelHelpers.classPrivateFieldGet(this,Wa).mode,container:t.fieldsContainer})}}},{key:"setAddressWidget",value:function e(t){babelHelpers.classPrivateFieldSet(this,Wa,t)}},{key:"setAddress",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ca).address=t}},{key:"setMode",value:function e(t){babelHelpers.classPrivateFieldGet(this,Ca).mode=t}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,Ca).destroy();babelHelpers.classPrivateFieldSet(this,Ca,null)}}]);return t}(o);var Ca=new WeakMap;var Wa=new WeakMap;function Aa(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var za=function(e){babelHelpers.inherits(t,e);function t(){var e;var s;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++){i[l]=arguments[l]}s=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(i)));Ua.add(babelHelpers.assertThisInitialized(s));xa.add(babelHelpers.assertThisInitialized(s));Ra.add(babelHelpers.assertThisInitialized(s));Xa.add(babelHelpers.assertThisInitialized(s));Da.add(babelHelpers.assertThisInitialized(s));Ma.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});_a.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Ba.set(babelHelpers.assertThisInitialized(s),{writable:true,value:700});La.set(babelHelpers.assertThisInitialized(s),{writable:true,value:null});Oa.set(babelHelpers.assertThisInitialized(s),{writable:true,value:800});Na.set(babelHelpers.assertThisInitialized(s),{writable:true,value:false});return s}babelHelpers.createClass(t,[{key:"render",value:function e(s){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"render",this).call(this,s);this.addressWidget.controlWrapper.addEventListener("click",Aa(this,Xa,Ya).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseover",Aa(this,xa,ja).bind(this));this.addressWidget.controlWrapper.addEventListener("mouseout",Aa(this,Ua,qa).bind(this));document.addEventListener("click",Aa(this,Ra,Va).bind(this));this.map.onMouseOverSubscribe(Aa(this,xa,ja).bind(this));this.map.onMouseOutSubscribe(Aa(this,Ua,qa).bind(this))}},{key:"setAddress",value:function e(t){if(this.addressWidget.state===d.DATA_INPUTTING){this.closeMap();return}if(!t){this.closeMap()}this.map.address=t;if(t){this.showMap()}}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Na)){return}document.removeEventListener("click",Aa(this,Ra,Va));if(this.addressWidget.controlWrapper){this.addressWidget.controlWrapper.removeEventListener("click",Aa(this,Xa,Ya));this.addressWidget.controlWrapper.removeEventListener("mouseover",Aa(this,xa,ja));this.addressWidget.controlWrapper.removeEventListener("mouseout",Aa(this,Ua,qa))}babelHelpers.classPrivateFieldSet(this,_a,null);babelHelpers.classPrivateFieldSet(this,La,null);babelHelpers.classPrivateFieldSet(this,Ma,false);babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);babelHelpers.classPrivateFieldSet(this,Na,true)}}]);return t}(wa);var Ma=new WeakMap;var _a=new WeakMap;var Ba=new WeakMap;var La=new WeakMap;var Oa=new WeakMap;var Na=new WeakMap;var Da=new WeakSet;var Xa=new WeakSet;var Ra=new WeakSet;var xa=new WeakSet;var Ua=new WeakSet;var Ya=function e(){if(babelHelpers.classPrivateFieldGet(this,Na)){return}if(this.map.isShown()){this.closeMap()}else{clearTimeout(babelHelpers.classPrivateFieldGet(this,_a))}};var Va=function e(){if(babelHelpers.classPrivateFieldGet(this,Na)){return}this.closeMap()};var ja=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Na)){return}babelHelpers.classPrivateFieldSet(this,Ma,true);clearTimeout(babelHelpers.classPrivateFieldGet(this,_a));clearTimeout(babelHelpers.classPrivateFieldGet(this,La));if(this.addressWidget.address&&!this.map.isShown()){babelHelpers.classPrivateFieldSet(this,_a,setTimeout(function(){t.showMap()},babelHelpers.classPrivateFieldGet(this,Ba)))}};var qa=function e(){var t=this;if(babelHelpers.classPrivateFieldGet(this,Na)){return}babelHelpers.classPrivateFieldSet(this,Ma,false);clearTimeout(babelHelpers.classPrivateFieldGet(this,_a));clearTimeout(babelHelpers.classPrivateFieldGet(this,La));if(this.addressWidget.mode===i.ControlMode.view&&this.map.isShown()){babelHelpers.classPrivateFieldSet(this,La,setTimeout(function(){t.closeMap()},babelHelpers.classPrivateFieldGet(this,Oa)))}};var Ja=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"createAddressWidget",value:function e(t){var s=t.sourceCode||BX.message("LOCATION_WIDGET_SOURCE_CODE");var a=t.sourceParams||BX.message("LOCATION_WIDGET_SOURCE_PARAMS");var l=t.languageId||BX.message("LOCATION_WIDGET_LANGUAGE_ID");var r=t.addressFormat||new i.Format(JSON.parse(BX.message("LOCATION_WIDGET_DEFAULT_FORMAT")));var n=[];if(!t.useFeatures||t.useFeatures.fields!==false){n.push(this.createFieldsFeature({addressFormat:r,languageId:l}))}var d=null;if(s&&a){d=this.createSource(s,a,l)}if(d){if(!t.useFeatures||t.useFeatures.autocomplete!==false){n.push(this.createAutocompleteFeature({languageId:l,addressFormat:r,source:d}))}if(!t.useFeatures||t.useFeatures.map!==false){var o=80;var b=150;var c=5;var u="auto";n.push(this.createMapFeature({addressFormat:r,source:d,popupBindOptions:t.popupBindOptions,thumbnailHeight:t.thumbnailHeight||o,thumbnailWidth:t.thumbnailWidth||b,maxPhotoCount:t.maxPhotoCount||c,mapBehavior:t.mapBehavior||u}))}}return new h({features:n,address:t.address,mode:t.mode,addressFormat:r,languageId:l})}},{key:"createFieldsFeature",value:function e(t){var s=new ra({addressFormat:t.addressFormat,languageId:t.languageId});return new Ea({fields:s})}},{key:"createAutocompleteFeature",value:function e(t){var s=new fe({languageId:t.languageId,addressFormat:t.addressFormat,autocompleteService:t.source.autocompleteService});return new ka({autocomplete:s})}},{key:"createMapFeature",value:function e(t){var s=new Tt({cacheable:true,closeByEsc:true,className:"location-popup-window",animation:"fading",angle:true,bindOptions:t.popupBindOptions});var a=new fs({photoService:t.source.photoService,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,maxPhotoCount:t.maxPhotoCount});var l={map:new Ct({addressFormat:t.addressFormat,map:t.source.map,popup:s,gallery:a,locationRepository:new i.LocationRepository,geocodingService:t.source.geocodingService})};var r;if(t.mapBehavior==="manual"){r=new wa(l)}else{r=new za(l)}return r}},{key:"createSource",value:function e(s,a,l){var r=null;if(s==="GOOGLE"){a.languageId=l;try{r=new t.Google(a)}catch(e){if(e instanceof i.SourceCreationError){r=null}else{throw e}}}else{throw new RangeError("Wrong source code")}return r}}]);return e}();function Ka(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\n\t\t\t<span class="ui-link ui-link-secondary ui-entity-editor-block-title-link">\n\t\t\t\t',"\n\t\t\t</span>"]);Ka=function t(){return e};return e}function $a(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function Qa(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var Za=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ai.add(babelHelpers.assertThisInitialized(e));ei.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});ti.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});si.set(babelHelpers.assertThisInitialized(e),{writable:true,value:["on","off"]});e.setEventNamespace("BX.Location.Widget.Switch");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),ei,s.state);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),si,s.titles);return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,ti,n.Tag.render(Ka(),Qa(this,ai,li).call(this)));babelHelpers.classPrivateFieldGet(this,ti).addEventListener("click",function(e){a.state=babelHelpers.classPrivateFieldGet(a,ei)===t.STATE_OFF?t.STATE_ON:t.STATE_OFF;a.emit($a(t,t,ii),{state:babelHelpers.classPrivateFieldGet(a,ei)});e.stopPropagation();return false});babelHelpers.classPrivateFieldGet(this,ti).addEventListener("mouseover",function(e){e.stopPropagation()});return babelHelpers.classPrivateFieldGet(this,ti)}},{key:"subscribeOnToggleEventSubscribe",value:function e(s){this.subscribe($a(t,t,ii),s)}},{key:"state",set:function e(t){babelHelpers.classPrivateFieldSet(this,ei,t);if(babelHelpers.classPrivateFieldGet(this,ti)){babelHelpers.classPrivateFieldGet(this,ti).innerHTML=Qa(this,ai,li).call(this)}},get:function e(){return babelHelpers.classPrivateFieldGet(this,ei)}}]);return t}(r.EventEmitter);var ei=new WeakMap;var ti=new WeakMap;var si=new WeakMap;var ai=new WeakSet;babelHelpers.defineProperty(Za,"STATE_OFF",0);babelHelpers.defineProperty(Za,"STATE_ON",1);var ii={writable:true,value:"onToggleEvent"};var li=function e(){return babelHelpers.classPrivateFieldGet(this,si)[babelHelpers.classPrivateFieldGet(this,ei)]};function ri(){var e=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>']);ri=function t(){return e};return e}function ni(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}if(s.get){return s.get.call(e)}return s.value}function di(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var oi=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ui.add(babelHelpers.assertThisInitialized(e));bi.set(babelHelpers.assertThisInitialized(e),{writable:true,value:t.TYPE_SEARCH});ci.set(babelHelpers.assertThisInitialized(e),{writable:true,value:void 0});e.setEventNamespace("BX.Location.Widget.Icon");return e}babelHelpers.createClass(t,[{key:"render",value:function e(s){var a=this;babelHelpers.classPrivateFieldSet(this,bi,s.type);babelHelpers.classPrivateFieldSet(this,ci,n.Tag.render(ri(),di(this,ui,hi).call(this,babelHelpers.classPrivateFieldGet(this,bi))));babelHelpers.classPrivateFieldGet(this,ci).addEventListener("click",function(e){a.emit(ni(t,t,pi))});return babelHelpers.classPrivateFieldGet(this,ci)}},{key:"subscribeOnClickEvent",value:function e(s){this.subscribe(ni(t,t,pi),s)}},{key:"type",set:function e(t){babelHelpers.classPrivateFieldSet(this,bi,t);if(babelHelpers.classPrivateFieldGet(this,ci)){babelHelpers.classPrivateFieldGet(this,ci).className=di(this,ui,hi).call(this,babelHelpers.classPrivateFieldGet(this,bi))}}}]);return t}(r.EventEmitter);var bi=new WeakMap;var ci=new WeakMap;var ui=new WeakSet;var pi={writable:true,value:"onClick"};babelHelpers.defineProperty(oi,"TYPE_CLEAR","clear");babelHelpers.defineProperty(oi,"TYPE_SEARCH","search");babelHelpers.defineProperty(oi,"TYPE_LOADER","loader");var hi=function e(t){var s="";if(t===oi.TYPE_CLEAR){s="ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear"}else if(t===oi.TYPE_SEARCH){s="ui-ctl-after ui-ctl-icon-search"}else if(t===oi.TYPE_LOADER){s="ui-ctl-after ui-ctl-icon-loader"}else{BX.debug("Wrong icon type")}return s};function vi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-search-control-block">\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);vi=function t(){return e};return e}function fi(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="location-search-control-block">\n\t\t\t\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t\t\t\t',"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"]);fi=function t(){return e};return e}function Hi(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-link ui-link-dark ui-link-dotted">',"</span>"]);Hi=function t(){return e};return e}function Fi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="location-fields-control-block"></div>']);Fi=function t(){return e};return e}function Pi(){var e=babelHelpers.taggedTemplateLiteral(['\t\t\t\t\t\t    \n\t\t\t\t<div class="location-search-control-block">\t\t\t\t\t\n\t\t\t\t\t',"\n\t\t\t\t</div>"]);Pi=function t(){return e};return e}function mi(){var e=babelHelpers.taggedTemplateLiteral(["",""]);mi=function t(){return e};return e}function gi(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">',"","","</div>"]);gi=function t(){return e};return e}function wi(){var e=babelHelpers.taggedTemplateLiteral(["<input value='",'\' type="hidden" name="','">']);wi=function t(){return e};return e}function yi(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element ui-ctl-textbox" value="" type="text" autocomplete="off" name="','">']);yi=function t(){return e};return e}function Ti(e,t,s){if(e!==t){throw new TypeError("Private static access of wrong provenance")}return s}function Ii(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var ki=function(e){babelHelpers.inherits(t,e);function t(e){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Mi.add(babelHelpers.assertThisInitialized(s));zi.add(babelHelpers.assertThisInitialized(s));Ai.add(babelHelpers.assertThisInitialized(s));Wi.add(babelHelpers.assertThisInitialized(s));Ci.add(babelHelpers.assertThisInitialized(s));Ei.add(babelHelpers.assertThisInitialized(s));Si.add(babelHelpers.assertThisInitialized(s));Gi.add(babelHelpers.assertThisInitialized(s));s._input=null;s._inputIcon=null;s._hiddenInput=null;s._innerWrapper=null;s._addressWidget=null;s._addressFieldsContainer=null;return s}babelHelpers.createClass(t,[{key:"initialize",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"initialize",this).call(this,s,a);var l=this.getValue();var r=null;if(n.Type.isStringFilled(l)){try{r=new i.Address(JSON.parse(l))}catch(e){BX.debug("Cant parse address value");return}}var d=new Ja;this._addressWidget=d.createAddressWidget({address:r,mode:this._mode===BX.UI.EntityEditorMode.edit?i.ControlMode.edit:i.ControlMode.view,popupBindOptions:{position:"right"}});this._addressWidget.subscribeOnStateChangedEvent(Ii(this,Wi,Di).bind(this));this._addressWidget.subscribeOnAddressChangedEvent(Ii(this,Ai,Xi).bind(this));this._fieldsSwitch=new Za({state:Za.STATE_OFF,titles:[BX.message("LOCATION_WIDGET_AUI_MORE"),BX.message("LOCATION_WIDGET_AUI_BRIEFLY")]});this._fieldsSwitch.subscribeOnToggleEventSubscribe(Ii(this,Si,Li).bind(this))}},{key:"focus",value:function e(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)}},{key:"getModeSwitchType",value:function e(t){var s=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){s|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return s}},{key:"doSetMode",value:function e(t){this._addressWidget.mode=t===BX.UI.EntityEditorMode.edit?i.ControlMode.edit:i.ControlMode.view;this._fieldsSwitch.state=Za.STATE_OFF}},{key:"getContentWrapper",value:function e(){return this._innerWrapper}},{key:"save",value:function e(){if(!this.isEditable()){return}var t=Ii(this,Mi,xi).call(this);this._model.setField(this.getName(),t?t.toJson():"");this._addressWidget.resetView()}},{key:"showError",value:function e(s,a){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"showError",this).apply(this,[s,a]);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}}},{key:"clearError",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"clearError",this).apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}}},{key:"doClearLayout",value:function e(t){this._input=null;this._innerWrapper=null;this._inputContainer=null;this._addressFieldsContainer=null;this._inputIcon=null;this._hiddenInput=null;n.Dom.clean(this._innerWrapper)}},{key:"validate",value:function e(t){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw Error("BX.Location.UIAddress. Invalid validation context")}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var s=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!s){t.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return s}},{key:"getRuntimeValue",value:function e(){return this._mode===BX.UI.EntityEditorMode.edit?Ii(this,Mi,xi).call(this):null}},{key:"layout",value:function e(s){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-card-content-block-field-phone"]});this.adjustWrapper();var a=this.getTitle();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}var i={};if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(a));this._input=n.Tag.render(yi(),"".concat(this.getName(),"_STRING"));this._hiddenInput=n.Tag.render(wi(),this.getValue(),this.getName());this._inputIcon=new oi;this._inputIcon.subscribeOnClickEvent(Ii(this,Gi,Bi).bind(this));var l=this._inputIcon.render({type:Ti(t,t,_i).call(t,Ii(this,Mi,xi).call(this))});this._inputContainer=n.Tag.render(gi(),l,this._input,this._hiddenInput);this._titleWrapper.appendChild(n.Tag.render(mi(),this._fieldsSwitch.render(this._mode)));this._innerWrapper=n.Tag.render(Pi(),this._inputContainer);i.inputNode=this._input;i.mapBindElement=l;this._addressFieldsContainer=n.Tag.render(Fi());if(this._fieldsSwitch.state===Za.STATE_ON){this._addressFieldsContainer.classList.add("visible")}i.fieldsContainer=this._addressFieldsContainer;this._innerWrapper.appendChild(this._addressFieldsContainer)}else{this._wrapper.appendChild(this.createTitleNode(a));var r;if(this.hasContentToDisplay()){var d=Ii(this,zi,Ri).call(this,Ii(this,Mi,xi).call(this));r=n.Tag.render(Hi(),d);this._innerWrapper=n.Tag.render(fi(),r);i.mapBindElement=r}else{this._innerWrapper=n.Tag.render(vi(),BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY"));i.mapBindElement=this._innerWrapper}}i.controlWrapper=this._innerWrapper;this._addressWidget.render(i);this._wrapper.appendChild(this._innerWrapper);this._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(s);this._hasLayout=true}},{key:"errorListener",value:function e(t){var s=this;var a=t.getData();var i=a.errors;if(this._inputIcon){this._inputIcon.type=oi.TYPE_CLEAR}if(!n.Type.isArray(i)){return}i.forEach(function(e){var t;if(e.message){t=e.message}else{t=BX.message("LOCATION_WIDGET_AUI_UNKNOWN_ERROR")}if(e.code){t+=" [".concat(e.code,"]")}s.showError(t)})}},{key:"processModelChange",value:function e(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()}}],[{key:"create",value:function e(s,a){var i=new t;i.initialize(s,a);return i}},{key:"registerField",value:function e(){if(typeof BX.UI.EntityEditorControlFactory!=="undefined"){BX.UI.EntityEditorControlFactory.registerFactoryMethod("address",t.registerFieldMethod)}else{BX.addCustomEvent("BX.UI.EntityEditorControlFactory:onInitialize",function(e,s){s.methods.address=t.registerFieldMethod})}}},{key:"registerFieldMethod",value:function e(s,a,i){var l=null;if(s==="address"){l=t.create(a,i)}return l}}]);return t}(BX.UI.EntityEditorField);var Gi=new WeakSet;var Si=new WeakSet;var Ei=new WeakSet;var Ci=new WeakSet;var Wi=new WeakSet;var Ai=new WeakSet;var zi=new WeakSet;var Mi=new WeakSet;var _i=function e(t){return t?oi.TYPE_CLEAR:oi.TYPE_SEARCH};var Bi=function e(){if(this._input.value!==""){this._input.value="";this._addressWidget.address=null;this._inputIcon.type=oi.TYPE_SEARCH}if(this.hasError()){this.clearError()}};var Li=function e(t){var s=t.getData();var a=s.state;if(a===Za.STATE_OFF){Ii(this,Ei,Oi).call(this)}else{Ii(this,Ci,Ni).call(this)}this._addressWidget.resetView()};var Oi=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.remove("visible")}};var Ni=function e(){if(this._addressFieldsContainer){this._addressFieldsContainer.classList.add("visible")}};var Di=function e(t){var s=t.getData();var a=s.state;var i;if(s.state===l.State.DATA_LOADING){i=oi.TYPE_LOADER}else{if(s.state===l.State.DATA_INPUTTING){this.markAsChanged()}i=Ti(ki,ki,_i).call(ki,Ii(this,Mi,xi).call(this))}this._inputIcon.type=i};var Xi=function e(t){var s=t.getData();var a=s.address;if(this._hiddenInput){this._hiddenInput.value=a?a.toJson():"";this.markAsChanged()}if(this._inputIcon){this._inputIcon.type=Ti(ki,ki,_i).call(ki,a)}};var Ri=function e(t){if(!t){return""}return t.toString(this._addressWidget.addressFormat)};var xi=function e(){return this._addressWidget.address};ki.registerField();e.Address=h;e.BaseFeature=o;e.MapFeature=wa;e.AutocompleteFeature=ka;e.FieldsFeature=Ea;e.Factory=Ja;e.State=d;e.UIAddress=ki})(this.BX.Location.Widget=this.BX.Location.Widget||{},BX.Location.Google,BX.Main,BX,BX.Location.Core,BX.Location.Widget,BX.Event,BX);
//# sourceMappingURL=widget.bundle.map.js