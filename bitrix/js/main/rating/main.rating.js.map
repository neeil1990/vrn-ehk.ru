{"version":3,"file":"main.rating.js","sources":["src/listpopup.js","src/render.js","src/manager.js","src/like.js","src/index.js"],"sourcesContent":["import { Type, Dom, Event, ajax } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\n\nimport { RatingManager } from './manager';\nimport { RatingLike } from './like';\nimport { RatingRender } from './render';\n\nexport class ListPopup\n{\n\tstatic popupLikeId = null;\n\n\tstatic removeOnCloseHandler = this.removeOnClose.bind(this);\n\n\tstatic getListPopup(params)\n\t{\n\t\tconst likeId = params.likeId;\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\t\tconst target = params.target;\n\t\tconst reaction = params.reaction;\n\t\tconst nodeId = params.nodeId;\n\n\t\tif (this.popupLikeId === likeId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (likeInstance.popupContentPage != 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.List(likeId, 1, reaction, true);\n\n\t\tlikeInstance.popupTimeoutIdShow = setTimeout(() => {\n\t\t\tthis.getListPopupShow({\n\t\t\t\tlikeId: likeId,\n\t\t\t\treaction: reaction,\n\t\t\t\ttarget: target,\n\t\t\t\tnodeId: nodeId,\n\t\t\t})\n\t\t}, 100);\n\t}\n\n\tstatic getListPopupShow(params)\n\t{\n\t\tconst likeId = params.likeId;\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\t\tconst target = params.target;\n\t\tconst reaction = params.reaction;\n\t\tconst nodeId = params.nodeId;\n\n\t\tlikeInstance.resultPopupAnimation = true;\n\n\t\tsetTimeout(() => {\n\t\t\tthis.getListPopupAnimation({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}, 500);\n\n\t\tif (likeInstance.mouseInShowPopupNode[reaction])\n\t\t{\n\t\t\tthis.OpenWindow(\n\t\t\t\tlikeId,\n\t\t\t\tnull,\n\t\t\t\ttarget,\n\t\t\t\tnodeId\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getListPopupAnimation(params)\n\t{\n\t\tconst likeId = params.likeId;\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tlikeInstance.resultPopupAnimation = false;\n\t}\n\n\tstatic OpenWindow(likeId, clickEvent, target, targetId)\n\t{\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (Number(likeInstance.countText.innerHTML) === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst bindNode = (\n\t\t\tlikeInstance.template === 'standart'\n\t\t\t\t? likeInstance.count\n\t\t\t\t: (\n\t\t\t\t\tlikeInstance.version === 2\n\t\t\t\t\t\t? (\n\t\t\t\t\t\t\tType.isDomNode(target)\n\t\t\t\t\t\t\t\t? target\n\t\t\t\t\t\t\t\t: (\n\t\t\t\t\t\t\t\t\tType.isStringFilled(targetId) && document.getElementById(targetId)\n\t\t\t\t\t\t\t\t\t\t? document.getElementById(targetId)\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t: likeInstance.box\n\t\t\t\t)\n\t\t);\n\n\t\tif (!Type.isDomNode(bindNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (likeInstance.popup == null)\n\t\t{\n\t\t\tconst globalZIndex = this.getGlobalIndex(bindNode);\n\n\t\t\tconst popupClassNameList = [];\n\t\t\tif (likeInstance.topPanel)\n\t\t\t{\n\t\t\t\tpopupClassNameList.push('bx-ilike-wrap-block-react-wrap');\n\t\t\t}\n\t\t\tif (RatingManager.mobile)\n\t\t\t{\n\t\t\t\tpopupClassNameList.push('bx-ilike-mobile-wrap');\n\t\t\t}\n\n\t\t\tlikeInstance.popup = new Popup({\n\t\t\t\tid: `ilike-popup-${likeId}`,\n\t\t\t\tbindElement: bindNode,\n\t\t\t\tlightShadow : true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: (\n\t\t\t\t\t!Type.isUndefined(clickEvent)\n\t\t\t\t\t&& !Type.isNull(clickEvent)\n\t\t\t\t\t&& !Type.isUndefined(clickEvent.offsetX)\n\t\t\t\t\t\t? (clickEvent.offsetX - 100)\n\t\t\t\t\t\t: (likeInstance.version == 2 ? -30 : 5)\n\t\t\t\t),\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tzIndexAbsolute: (globalZIndex > 1000 ? globalZIndex + 1 : 1000),\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tthis.popupLikeId = null;\n\t\t\t\t\t},\n\t\t\t\t\tonPopupDestroy: () => {},\n\t\t\t\t},\n\t\t\t\tcontent : document.getElementById(`bx-ilike-popup-cont-${likeId}`),\n\t\t\t\tclassName: popupClassNameList.join(' '),\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t!likeInstance.topPanel\n\t\t\t\t&& !RatingManager.mobile\n\t\t\t)\n\t\t\t{\n\t\t\t\tlikeInstance.popup.setAngle({});\n\n\t\t\t\tdocument.getElementById(`ilike-popup-${likeId}`).addEventListener('mouseout', () => {\n\t\t\t\t\tclearTimeout(likeInstance.popupTimeout);\n\t\t\t\t\tlikeInstance.popupTimeout = setTimeout(() => {\n\t\t\t\t\t\tlikeInstance.popup.close();\n\t\t\t\t\t}, 1000);\n\t\t\t\t});\n\n\t\t\t\tdocument.getElementById(`ilike-popup-${likeId}`).addEventListener('mouseover', () => {\n\t\t\t\t\tclearTimeout(likeInstance.popupTimeout);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isUndefined(clickEvent)\n\t\t\t\t&& !Type.isNull(clickEvent)\n\t\t\t\t&& !Type.isUndefined(clickEvent.offsetX)\n\t\t\t)\n\t\t\t{\n\t\t\t\tlikeInstance.popup.offsetLeft = (clickEvent.offsetX - 100);\n\t\t\t}\n\n\t\t\tlikeInstance.popup.setBindElement(bindNode);\n\t\t}\n\n\t\tif (this.popupLikeId !== likeId)\n\t\t{\n\t\t\tconst popupLikeInstance = RatingLike.getInstance(this.popupLikeId);\n\t\t\tif (popupLikeInstance)\n\t\t\t{\n\t\t\t\tpopupLikeInstance.popup.close();\n\t\t\t}\n\t\t}\n\n\t\tthis.popupLikeId = likeId;\n\n\t\tlikeInstance.popup.show();\n\n\t\tthis.AdjustWindow(likeId);\n\t}\n\n\tstatic getGlobalIndex(element)\n\t{\n\t\tlet index = 0;\n\t\tlet propertyValue = '';\n\n\t\tdo\n\t\t{\n\t\t\tpropertyValue = Dom.style(element, 'z-index');\n\t\t\tif (propertyValue !== 'auto')\n\t\t\t{\n\t\t\t\tindex = !Number.isNaN(parseInt(propertyValue)) ? index : 0;\n\t\t\t}\n\t\t\telement = element.offsetParent;\n\t\t}\n\t\twhile (\n\t\t\telement\n\t\t\t&& element.tagName !== 'BODY'\n\t\t\t);\n\n\t\treturn index;\n\t}\n\n\tstatic removeOnClose()\n\t{\n\t\tEventEmitter.unsubscribe(BX.SidePanel.Instance.getTopSlider().getWindow(), 'SidePanel.Slider:onClose', this.removeOnCloseHandler);\n\n\t\tconst popupLikeInstance = RatingLike.getInstance(this.popupLikeId);\n\t\tif (popupLikeInstance)\n\t\t{\n\t\t\tpopupLikeInstance.popup.close();\n\t\t}\n\t}\n\n\tstatic AdjustWindow(likeId)\n\t{\n\t\tlet likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (!likeInstance.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlikeInstance.popup.bindOptions.forceBindPosition = true;\n\t\tlikeInstance.popup.adjustPosition();\n\t\tlikeInstance.popup.bindOptions.forceBindPosition = false;\n\t}\n\n\tstatic PopupScroll(likeId)\n\t{\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tlet contentContainerNodeList = likeInstance.popupContent.querySelectorAll('.bx-ilike-popup-content'); // reactions\n\t\tif (contentContainerNodeList.length <= 0)\n\t\t{\n\t\t\tcontentContainerNodeList = [ likeInstance.popupContent ];\n\t\t}\n\n\t\tcontentContainerNodeList.forEach((contentContainerNode) => {\n\t\t\tcontentContainerNode.addEventListener('scroll', (e) => {\n\t\t\t\tif (e.target.scrollTop <= (e.target.scrollHeight - e.target.offsetHeight) / 1.5)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.List(likeId, null, (likeInstance.version == 2 ? RatingRender.popupCurrentReaction : false));\n\t\t\t\tEvent.unbindAll(e.target);\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic List(likeId, page, reaction, clear)\n\t{\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (Number(likeInstance.countText.innerHTML) === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treaction = (Type.isStringFilled(reaction) ? reaction : '');\n\n\t\tif (Type.isNull(page))\n\t\t{\n\t\t\tpage = (\n\t\t\t\tlikeInstance.version === 2\n\t\t\t\t\t? (\n\t\t\t\t\t\t!Type.isUndefined(RatingRender.popupPagesList[reaction])\n\t\t\t\t\t\t\t? RatingRender.popupPagesList[reaction]\n\t\t\t\t\t\t\t: 1\n\t\t\t\t\t)\n\t\t\t\t\t: likeInstance.popupContentPage\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\tclear\n\t\t\t&& Number(page) === 1\n\t\t\t&& likeInstance.version === 2\n\t\t)\n\t\t{\n\t\t\tRatingRender.clearPopupContent({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}\n\n\t\tif (likeInstance.listXHR)\n\t\t{\n\t\t\tlikeInstance.listXHR.abort();\n\t\t}\n\n\t\tajax.runAction('main.rating.list', {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tRATING_VOTE_TYPE_ID: likeInstance.entityTypeId,\n\t\t\t\t\tRATING_VOTE_ENTITY_ID: likeInstance.entityId,\n\t\t\t\t\tRATING_VOTE_LIST_PAGE: page,\n\t\t\t\t\tRATING_VOTE_REACTION: (reaction === 'all' ? '' : reaction),\n\t\t\t\t\tPATH_TO_USER_PROFILE: likeInstance.pathToUserProfile,\n\t\t\t\t},\n\t\t\t},\n\t\t\tonrequeststart: (xhr) => {\n\t\t\t\tlikeInstance.listXHR = xhr;\n\t\t\t},\n\t\t}).then((result) => {\n\t\t\t\tthis.onListSuccess(result.data, {\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\treaction: reaction,\n\t\t\t\t\tpage: page,\n\t\t\t\t\tclear: clear,\n\t\t\t\t});\n\t\t\t},\n\t\t\t() => {}\n\t\t);\n\n\t\treturn false;\n\t}\n\n\tstatic onListSuccess(data, params)\n\t{\n\t\tif (!data)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst likeInstance = RatingLike.getInstance(params.likeId);\n\n\t\tlikeInstance.countText.innerHTML = data.items_all;\n\n\t\tif (Number(data.items_page) === 0)\n\t\t{\n\t\t\tif (Number(data.list_page) === 1)\n\t\t\t{\n\t\t\t\tlikeInstance.popup.close();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tif (likeInstance.version === 2)\n\t\t{\n\t\t\tRatingRender.buildPopupContent({\n\t\t\t\tlikeId: params.likeId,\n\t\t\t\treaction: params.reaction,\n\t\t\t\trating: likeInstance,\n\t\t\t\tpage: params.page,\n\t\t\t\tdata: data,\n\t\t\t\tclear: params.clear,\n\t\t\t});\n\t\t\tlikeInstance.topPanel.setAttribute('data-popup', 'Y');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tRatingRender.buildPopupContentNoReactions({\n\t\t\t\trating: likeInstance,\n\t\t\t\tpage: params.page,\n\t\t\t\tdata: data,\n\t\t\t});\n\t\t}\n\n\t\tthis.AdjustWindow(params.likeId);\n\t\tthis.PopupScroll(params.likeId);\n\t}\n\n\tstatic onResultClick(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : false);\n\t\tconst clickEvent = (!Type.isUndefined(params.event) ? params.event : false);\n\t\tconst reaction = (Type.isStringFilled(params.reaction) ? params.reaction : '');\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (likeInstance.resultPopupAnimation)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tlikeInstance.popup\n\t\t\t&& likeInstance.popup.isShown()\n\t\t)\n\t\t{\n\t\t\tlikeInstance.popup.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(likeInstance.popupTimeoutIdList);\n\t\t\tclearTimeout(likeInstance.popupTimeoutIdShow);\n\n\t\t\tif (\n\t\t\t\tlikeInstance.popupContentPage == 1\n\t\t\t\t&& (\n\t\t\t\t\tlikeInstance.topPanel.getAttribute('data-popup') !== 'Y'\n\t\t\t\t\t|| likeInstance.popupCurrentReaction != reaction\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.List(likeId, 1, reaction, true);\n\t\t\t}\n\n\t\t\tthis.OpenWindow(\n\t\t\t\tlikeId,\n\t\t\t\t(clickEvent.currentTarget === likeInstance.count ? null : clickEvent),\n\t\t\t\tclickEvent.currentTarget,\n\t\t\t\tclickEvent.currentTarget.id\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic onResultMouseEnter(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : false);\n\t\tconst mouseEnterEvent = (!Type.isUndefined(params.event) ? params.event : null);\n\t\tconst reaction = (Type.isStringFilled(params.reaction) ? params.reaction : '');\n\t\tconst nodeId = (\n\t\t\tmouseEnterEvent && Type.isStringFilled(mouseEnterEvent.currentTarget.id)\n\t\t\t\t? mouseEnterEvent.currentTarget.id\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tlikeInstance.mouseInShowPopupNode[reaction] = true;\n\n\t\tclearTimeout(likeInstance.popupTimeoutIdList);\n\t\tclearTimeout(likeInstance.popupTimeoutIdShow);\n\n\t\tlikeInstance.popupTimeoutIdList = setTimeout(() => {\n\t\t\tthis.getListPopup({\n\t\t\t\tlikeId: likeId,\n\t\t\t\ttarget: mouseEnterEvent.currentTarget,\n\t\t\t\treaction: reaction,\n\t\t\t\tnodeId: nodeId,\n\t\t\t});\n\t\t}, 300);\n\t}\n\n\tstatic onResultMouseLeave(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : false);\n\t\tconst reaction = (Type.isStringFilled(params.reaction) ? params.reaction : '');\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tlikeInstance.mouseInShowPopupNode[reaction] = false;\n\t\tlikeInstance.resultPopupAnimation = false;\n\t}\n}\n","import { Type, Loc, Dom, Runtime, pos, GetWindowSize } from 'main.core';\nimport { EventEmitter } from 'main.core.events'\nimport {Lottie} from 'ui.lottie';\n\nimport { RatingManager } from './manager';\nimport { RatingLike } from './like';\nimport { ListPopup } from './listpopup';\nimport likeAnimatedEmojiData from '../animations/em_01.json';\nimport laughAnimatedEmojiData from '../animations/em_02.json';\nimport wonderAnimatedEmojiData from '../animations/em_03.json';\nimport cryAnimatedEmojiData from '../animations/em_04.json';\nimport angryAnimatedEmojiData from '../animations/em_05.json';\nimport facepalmAnimatedEmojiData from '../animations/em_06.json';\nimport kissAnimatedEmojiData from '../animations/em_07.json';\n\nexport class RatingRender\n{\n\tstatic reactionsList = [ 'like', 'kiss', 'laugh', 'wonder', 'cry', 'angry', 'facepalm' ];\n\tstatic reactionsAnimationData = {\n\t\tlike: likeAnimatedEmojiData,\n\t\tkiss: kissAnimatedEmojiData,\n\t\tlaugh: laughAnimatedEmojiData,\n\t\twonder: wonderAnimatedEmojiData,\n\t\tcry: cryAnimatedEmojiData,\n\t\tangry: angryAnimatedEmojiData,\n\t\tfacepalm: facepalmAnimatedEmojiData,\n\t}\n\tstatic popupCurrentReaction = false;\n\tstatic popupPagesList = [];\n\tstatic popupSizeInitialized = false;\n\tstatic blockShowPopup = false;\n\tstatic blockShowPopupTimeout = false;\n\tstatic afterClickBlockShowPopup = false;\n\tstatic afterClickHandler = null;\n\tstatic touchStartPosition = null;\n\tstatic touchCurrentPosition = {\n\t\tx: null,\n\t\ty: null,\n\t};\n\tstatic currentReactionNodeHover = null;\n\n\tstatic touchMoveDeltaY = null;\n\tstatic touchScrollTop = 0;\n\n\tstatic hasMobileTouchMoved = null;\n\tstatic mobileOverlay = null;\n\n\tstatic reactionsPopup = null;\n\tstatic reactionsPopupAnimation = null;\n\tstatic reactionsPopupAnimation2 = null;\n\tstatic reactionsPopupLikeId = null;\n\tstatic reactionsPopupMouseOutHandler = null;\n\tstatic reactionsPopupOpacityState = 0;\n\tstatic reactionsPopupTouchStartIn = null;\n\tstatic reactionsPopupPositionY = null;\n\tstatic blockTouchEndByScroll = false;\n\n\tstatic reactionsPopupMobileTouchEndHandler = this.reactionsPopupMobileTouchEnd.bind(this);\n\tstatic reactionsPopupMobileTouchMoveHandler = this.reactionsPopupMobileTouchMove.bind(this);\n\tstatic reactionsPopupMobileHideHandler = this.reactionsPopupMobileHide.bind(this);\n\n\tstatic getTopUsersText(params)\n\t{\n\t\tconst currentUserId = Number(Loc.getMessage('USER_ID'));\n\t\tconst you = (!Type.isUndefined(params.you) ? !!params.you : false);\n\t\tconst topList = (!Type.isUndefined(params.top) && Type.isArray(params.top) ? params.top : []);\n\t\tconst more = (!Type.isUndefined(params.more) ? Number(params.more) : 0);\n\t\tlet result = '';\n\n\t\tif (\n\t\t\ttopList.length <= 0\n\t\t\t&& !you\n\t\t\t&& (\n\t\t\t\tRatingManager.mobile\n\t\t\t\t|| more <= 0\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn result;\n\t\t}\n\n\t\tif (RatingManager.mobile)\n\t\t{\n\t\t\tif (you)\n\t\t\t{\n\t\t\t\ttopList.push({\n\t\t\t\t\tID: currentUserId,\n\t\t\t\t\tNAME_FORMATTED: Loc.getMessage('RATING_LIKE_TOP_TEXT3_YOU'),\n\t\t\t\t\tWEIGHT: 1,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tresult = Loc.getMessage(`RATING_LIKE_TOP_TEXT3_${(topList.length > 1 ? '2' : '1')}`)\n\t\t\t\t.replace('#OVERFLOW_START#', RatingManager.mobile ? '<span class=\"feed-post-emoji-text-item-overflow\">' : '')\n\t\t\t\t.replace('#OVERFLOW_END#', RatingManager.mobile ? '</span>' : '');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = Loc.getMessage(`RATING_LIKE_TOP_TEXT2_${(you ? 'YOU_' : '')}${(topList.length)}${(more > 0 ? '_MORE' : '')}`)\n\t\t\t\t.replace('#OVERFLOW_START#', RatingManager.mobile ? '<span class=\"feed-post-emoji-text-item-overflow\">' : '')\n\t\t\t\t.replace('#OVERFLOW_END#', RatingManager.mobile ? '</span>' : '')\n\t\t\t\t.replace('#MORE_START#', RatingManager.mobile ? '<span class=\"feed-post-emoji-text-item-more\">' : '&nbsp;')\n\t\t\t\t.replace('#MORE_END#', RatingManager.mobile ? '</span>' : '');\n\t\t}\n\n\t\tif (RatingManager.mobile)\n\t\t{\n\t\t\ttopList.sort((a, b) => {\n\t\t\t\tif (parseInt(a.ID) === currentUserId)\n\t\t\t\t{\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (parseInt(b.ID) === currentUserId)\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tif (parseFloat(a.WEIGHT) === parseFloat(b.WEIGHT))\n\t\t\t\t{\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\treturn (parseFloat(a.WEIGHT) > parseFloat(b.WEIGHT) ? -1 : 1);\n\t\t\t});\n\n\t\t\tconst userNameList = topList.map((item) => {\n\t\t\t\treturn item.NAME_FORMATTED;\n\t\t\t});\n\n\t\t\tlet userNameBegin = '';\n\t\t\tlet userNameEnd = '';\n\n\t\t\tif (userNameList.length === 1)\n\t\t\t{\n\t\t\t\tuserNameBegin = userNameList.pop();\n\t\t\t\tuserNameEnd = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tuserNameBegin = userNameList.slice(0, userNameList.length - 1)\n\t\t\t\t\t.join(Loc.getMessage('RATING_LIKE_TOP_TEXT3_USERLIST_SEPARATOR').replace(/#USERNAME#/g, ''));\n\t\t\t\tuserNameEnd = userNameList[userNameList.length - 1];\n\t\t\t}\n\n\t\t\tresult = result.replace('#USER_LIST_BEGIN#', userNameBegin)\n\t\t\t\t.replace('#USER_LIST_END#', userNameEnd);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttopList.forEach((item, i) => {\n\n\t\t\t\tresult = result.replace(\n\t\t\t\t\t`#USER_${(Number(i) + 1)}#`,\n\t\t\t\t\t`<span class=\"feed-post-emoji-text-item\">${item.NAME_FORMATTED}</span>`\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tresult = result.replace('#USERS_MORE#', '<span class=\"feed-post-emoji-text-item\">' + more + '</span>');\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic getUserReaction(params)\n\t{\n\t\treturn (\n\t\t\tType.isDomNode(params.userReactionNode)\n\t\t\t\t? params.userReactionNode.getAttribute('data-value')\n\t\t\t\t: ''\n\t\t);\n\t}\n\n\tstatic setReaction(params)\n\t{\n\t\tif (\n\t\t\tType.isUndefined(params.rating)\n\t\t\t|| !Type.isStringFilled(params.likeId)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = (Type.isStringFilled(params.action) ? params.action : 'add');\n\t\tif (!['add', 'cancel', 'change'].includes(action))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst likeId = params.likeId;\n\t\tconst rating = params.rating;\n\t\tconst userReaction = (Type.isStringFilled(params.userReaction) ? params.userReaction : Loc.getMessage('RATING_LIKE_REACTION_DEFAULT'));\n\t\tconst userReactionOld = (Type.isStringFilled(params.userReactionOld) ? params.userReactionOld : Loc.getMessage('RATING_LIKE_REACTION_DEFAULT'));\n\t\tif (\n\t\t\taction === 'change'\n\t\t\t&& userReaction === userReactionOld\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst totalCount = (!Type.isUndefined(params.totalCount) ? Number(params.totalCount) : null);\n\t\tconst currentUserId = Number(Loc.getMessage('USER_ID'));\n\t\tconst userId = (!Type.isUndefined(params.userId) ? Number(params.userId) : currentUserId);\n\n\t\tconst userReactionNode = this.getNode(rating.userReactionNode);\n\t\tconst reactionsNode = this.getNode(rating.reactionsNode);\n\t\tconst topPanel = this.getNode(rating.topPanel);\n\t\tconst topPanelContainer = this.getNode(rating.topPanelContainer);\n\t\tconst topUsersText = this.getNode(rating.topUsersText);\n\t\tconst countText = this.getNode(rating.countText);\n\t\tconst buttonText = this.getNode(rating.buttonText);\n\n\t\tif (\n\t\t\tuserId === currentUserId // not pull\n\t\t\t&& userReactionNode\n\t\t)\n\t\t{\n\t\t\tuserReactionNode.setAttribute('data-value', [ 'add', 'change' ].includes(action) ? userReaction : '');\n\t\t}\n\n\t\tlet i = 0;\n\t\tlet elements = [];\n\t\tlet elementsNew = [];\n\n\t\tif (\n\t\t\ttotalCount !== null\n\t\t\t&& topPanel\n\t\t\t&& topUsersText\n\t\t\t&& reactionsNode\n\t\t)\n\t\t{\n\t\t\tif (totalCount > 0)\n\t\t\t{\n\t\t\t\ttopPanelContainer.classList.add('feed-post-emoji-top-panel-container-active');\n\n\t\t\t\tif (!topPanel.classList.contains('feed-post-emoji-container-toggle'))\n\t\t\t\t{\n\t\t\t\t\ttopPanel.classList.add('feed-post-emoji-container-toggle');\n\t\t\t\t\ttopUsersText.classList.add('feed-post-emoji-move-to-right');\n\t\t\t\t\treactionsNode.classList.add('feed-post-emoji-icon-box-show');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (totalCount <= 0)\n\t\t\t{\n\t\t\t\ttopPanelContainer.classList.remove('feed-post-emoji-top-panel-container-active');\n\n\t\t\t\tif (topPanel.classList.contains('feed-post-emoji-container-toggle'))\n\t\t\t\t{\n\t\t\t\t\ttopPanel.classList.remove('feed-post-emoji-container-toggle');\n\t\t\t\t\ttopUsersText.classList.remove('feed-post-emoji-move-to-right');\n\t\t\t\t\treactionsNode.classList.remove('feed-post-emoji-icon-box-show');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\ttotalCount !== null\n\t\t\t&& countText\n\t\t)\n\t\t{\n\t\t\tif (\n\t\t\t\ttotalCount <= 0\n\t\t\t\t&& !countText.classList.contains('feed-post-emoji-text-counter-invisible')\n\t\t\t)\n\t\t\t{\n\t\t\t\tcountText.classList.add('feed-post-emoji-text-counter-invisible');\n\t\t\t}\n\t\t\telse if (\n\t\t\t\ttotalCount > 0\n\t\t\t\t&& countText.classList.contains('feed-post-emoji-text-counter-invisible')\n\t\t\t)\n\t\t\t{\n\t\t\t\tcountText.classList.remove('feed-post-emoji-text-counter-invisible');\n\t\t\t}\n\t\t}\n\n\t\tif (reactionsNode)\n\t\t{\n\t\t\tconst reactionsContainer = reactionsNode.querySelector('.feed-post-emoji-icon-container');\n\t\t\telements = reactionsNode.querySelectorAll('.feed-post-emoji-icon-item');\n\n\t\t\tif (reactionsContainer)\n\t\t\t{\n\t\t\t\tlet found = false;\n\t\t\t\tlet newValue = false;\n\n\t\t\t\telements.forEach((element) => {\n\n\t\t\t\t\tconst reactionValue = element.getAttribute('data-reaction');\n\t\t\t\t\tconst reactionCount = Number(element.getAttribute('data-value'));\n\n\t\t\t\t\tif (reactionValue === userReaction)\n\t\t\t\t\t{\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\tif (action === 'cancel')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewValue = (reactionCount > 0 ? reactionCount - 1 : 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ([ 'add', 'change' ].includes(action))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewValue = reactionCount + 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (newValue > 0 && newValue > reactionCount)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\t\t\treaction: reactionValue,\n\t\t\t\t\t\t\t\tcount: newValue,\n\t\t\t\t\t\t\t\tanimate: {\n\t\t\t\t\t\t\t\t\ttype: 'pop',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (newValue > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\t\t\treaction: reactionValue,\n\t\t\t\t\t\t\t\tcount: reactionCount,\n\t\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (\n\t\t\t\t\t\taction === 'change'\n\t\t\t\t\t\t&& reactionValue === userReactionOld\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewValue = (reactionCount > 0 ? reactionCount - 1 : 0);\n\n\t\t\t\t\t\tif (newValue > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\t\t\treaction: reactionValue,\n\t\t\t\t\t\t\t\tcount: newValue,\n\t\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\t\treaction: reactionValue,\n\t\t\t\t\t\t\tcount: reactionCount,\n\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (\n\t\t\t\t\t['add', 'change'].includes(action)\n\t\t\t\t\t&& !found\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\treaction: userReaction,\n\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\tanimate: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tDom.clean(reactionsContainer);\n\n\t\t\t\tif (topPanel)\n\t\t\t\t{\n\t\t\t\t\tif (elementsNew.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\ttopPanel.classList.add('feed-post-emoji-container-nonempty');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttopPanel.classList.remove('feed-post-emoji-container-nonempty');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (RatingManager.mobile)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst commentNode = topPanel.closest('.post-comment-block');\n\t\t\t\t\t\tif (commentNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (elementsNew.length > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcommentNode.classList.add('comment-block-rating-nonempty');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcommentNode.classList.remove('comment-block-rating-nonempty');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.drawReactions({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\tcontainer: reactionsContainer,\n\t\t\t\t\tdata: elementsNew,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tuserId === currentUserId\n\t\t\t&& buttonText\n\t\t)\n\t\t{\n\t\t\tif ([ 'add', 'change' ].includes(action))\n\t\t\t{\n\t\t\t\tbuttonText.innerHTML = Loc.getMessage(`RATING_LIKE_EMOTION_${userReaction.toUpperCase()}_CALC`);\n\t\t\t\tif (RatingManager.mobile)\n\t\t\t\t{\n\t\t\t\t\tbuttonText.parentElement.className = '';\n\t\t\t\t\tbuttonText.parentElement.classList.add(\n\t\t\t\t\t\t'bx-ilike-left-wrap',\n\t\t\t\t\t\t'bx-you-like-button',\n\t\t\t\t\t\t`bx-you-like-button-${userReaction.toLowerCase()}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tbuttonText.innerHTML = Loc.getMessage('RATING_LIKE_EMOTION_LIKE_CALC');\n\t\t\t\tif (RatingManager.mobile)\n\t\t\t\t{\n\t\t\t\t\tbuttonText.parentElement.className = 'bx-ilike-left-wrap';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic drawReactions(params)\n\t{\n\t\tconst container = (Type.isDomNode(params.container) ? params.container : null);\n\t\tconst data = (Type.isArray(params.data) ? params.data : []);\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '')\n\t\tif (\n\t\t\t!container\n\t\t\t|| !Type.isStringFilled(likeId)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst reactionEvents = (\n\t\t\tRatingManager.mobile\n\t\t\t\t? {}\n\t\t\t\t: {\n\t\t\t\t\tclick: this.resultReactionClick.bind(this),\n\t\t\t\t\tmouseenter: this.resultReactionMouseEnter.bind(this),\n\t\t\t\t\tmouseleave: this.resultReactionMouseLeave.bind(this),\n\t\t\t\t}\n\t\t);\n\n\t\tDom.clean(container);\n\n\t\tconst reactionsData = {};\n\n\t\tdata.forEach((element, i) => {\n\n\t\t\tconst classList = [\n\t\t\t\t'feed-post-emoji-icon-item',\n\t\t\t\t`feed-post-emoji-icon-item-${(i+1)}`,\n\t\t\t];\n\n\t\t\tif (element?.animate)\n\t\t\t{\n\t\t\t\tif (element.animate?.type === 'pop')\n\t\t\t\t{\n\t\t\t\t\tclassList.push('feed-post-emoji-animation-pop');\n\t\t\t\t}\n\t\t\t\telse if (i >= 1)\n\t\t\t\t{\n\t\t\t\t\tclassList.push('feed-post-emoji-icon-animate');\n\t\t\t\t}\n\t\t\t\telse if (data.length == 1)\n\t\t\t\t{\n\t\t\t\t\tclassList.push('feed-post-emoji-animation-pop');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst emojiContainer = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tid: `bx-ilike-result-reaction-${element.reaction}-${likeId}`,\n\t\t\t\t\tclassName: classList.join(' '),\n\t\t\t\t},\n\t\t\t\tattrs: {\n\t\t\t\t\t'data-reaction': element.reaction,\n\t\t\t\t\t'data-value': element.count,\n\t\t\t\t\t'data-like-id': likeId,\n\t\t\t\t\ttitle: Loc.getMessage(`RATING_LIKE_EMOTION_${element.reaction.toUpperCase()}_CALC`),\n\t\t\t\t},\n\t\t\t\tevents: reactionEvents,\n\t\t\t});\n\n\t\t\tconst animation = Lottie.loadAnimation({\n\t\t\t\tanimationData: this.reactionsAnimationData[element.reaction],\n\t\t\t\tcontainer: emojiContainer,\n\t\t\t\tloop: false,\n\t\t\t\tautoplay: false,\n\t\t\t\trenderer: 'svg',\n\t\t\t\trendererSettings: {\n\t\t\t\t\tviewBoxOnly: true,\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (Boolean(element.animate))\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tanimation.play();\n\t\t\t\t}, 200);\n\t\t\t}\n\n\t\t\tcontainer.appendChild(emojiContainer);\n\n\t\t\treactionsData[element.reaction] = element.count;\n\t\t});\n\n\t\tcontainer.setAttribute('data-reactions-data', JSON.stringify(reactionsData));\n\t}\n\n\tstatic showReactionsPopup(params)\n\t{\n\t\tconst bindElement = this.getNode(params.bindElement);\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\n\t\tif (\n\t\t\t!bindElement\n\t\t\t|| !Type.isStringFilled(likeId)\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.reactionsPopupLikeId = likeId;\n\n\t\tif (this.reactionsPopup === null)\n\t\t{\n\t\t\tconst reactionsNodesList = [];\n\n\t\t\tthis.reactionsList.forEach((currentEmotion, index) => {\n\n\t\t\t\tconst emojiItem = Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: `feed-post-emoji-icon-item`,\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t'data-reaction': currentEmotion,\n\t\t\t\t\t\ttitle: Loc.getMessage(`RATING_LIKE_EMOTION_${currentEmotion.toUpperCase()}_CALC`),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tLottie.loadAnimation({\n\t\t\t\t\trenderer: 'svg',\n\t\t\t\t\tcontainer: emojiItem,\n\t\t\t\t\tanimationData: this.reactionsAnimationData[currentEmotion],\n\t\t\t\t});\n\n\t\t\t\treactionsNodesList.push(emojiItem);\n\t\t\t});\n\n\t\t\tthis.reactionsPopup = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: `feed-post-emoji-popup-container ${(RatingManager.mobile ? '--mobile' : '')}`,\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'feed-post-emoji-icon-inner',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: reactionsNodesList,\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tthis.reactionsPopup.addEventListener((RatingManager.mobile ? 'touchend' : 'click'), (e) => {\n\n\t\t\t\tconst reactionNode = (\n\t\t\t\t\t(e.target.classList.contains('feed-post-emoji-icon-item'))\n\t\t\t\t\t\t? e.target\n\t\t\t\t\t\t: e.target.closest('.feed-post-emoji-icon-item')\n\t\t\t\t);\n\n\t\t\t\tif (reactionNode)\n\t\t\t\t{\n\t\t\t\t\tRatingLike.ClickVote(\n\t\t\t\t\t\te,\n\t\t\t\t\t\tthis.reactionsPopupLikeId,\n\t\t\t\t\t\treactionNode.getAttribute('data-reaction'),\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tDom.append(this.reactionsPopup, document.body);\n\t\t}\n\t\telse if (this.reactionsPopup.classList.contains('feed-post-emoji-popup-invisible'))\n\t\t{\n\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-invisible');\n\t\t}\n\t\telse if (\n\t\t\tRatingManager.mobile\n\t\t\t&& this.reactionsPopup.classList.contains('feed-post-emoji-popup-invisible-final-mobile')\n\t\t)\n\t\t{\n\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-invisible-final-mobile');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reactionsPopupMouseOutHandler = this.getReactionsPopupMouseOutHandler(likeId);\n\n\t\tconst bindElementPosition = pos(bindElement);\n\n\t\tif (\n\t\t\tbindElement.closest('.feed-com-informers-bottom')\n\t\t\t&& bindElement.closest('.iframe-comments-cont, .task-iframe-popup')\n\t\t)\n\t\t{\n\t\t\tbindElementPosition.left += 100;\n\t\t}\n\n\t\tconst inverted = ((bindElementPosition.top - GetWindowSize().scrollTop) < 80);\n\t\tconst deltaY = (inverted ? 15 : -45);\n\n\t\tif (inverted)\n\t\t{\n\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-inverted');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-inverted');\n\t\t}\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (RatingManager.mobile)\n\t\t{\n\t\t\tthis.touchMoveDeltaY = (inverted ? 60 : -45);\n\t\t\tDom.adjust(this.reactionsPopup, {\n\t\t\t\tstyle: {\n\t\t\t\t\tleft: '12px',\n\t\t\t\t\ttop: ((inverted ? (bindElementPosition.top - 23) : (bindElementPosition.top - 28)) + deltaY) + 'px',\n\t\t\t\t\twidth: '330px',\n\t\t\t\t\tborderRadius: '61px',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-invisible-final');\n\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-active-final');\n\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-active-final-item');\n\t\t\tlikeInstance.box.classList.add('feed-post-emoji-control-active');\n\t\t\tthis.reactionsPopupMobileDisableScroll();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reactionsPopupAnimation = new BX.easing({\n\t\t\t\tduration: 300,\n\t\t\t\tstart: {\n\t\t\t\t\twidth: 100,\n\t\t\t\t\tleft: (bindElementPosition.left + (bindElementPosition.width / 2) - 50),\n\t\t\t\t\ttop: ((inverted ? bindElementPosition.top - 30 : bindElementPosition.top + 30 ) + deltaY),\n\t\t\t\t\tborderRadius: 0,\n\t\t\t\t\topacity: 0,\n\t\t\t\t},\n\t\t\t\tfinish: {\n\t\t\t\t\twidth: 300,\n\t\t\t\t\tleft: (bindElementPosition.left + (bindElementPosition.width / 2) - 133),\n\t\t\t\t\ttop: (bindElementPosition.top + deltaY - 5),\n\t\t\t\t\tborderRadius: 50,\n\t\t\t\t\topacity: 100,\n\t\t\t\t},\n\t\t\t\ttransition : BX.easing.makeEaseInOut(BX.easing.transitions.cubic),\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tthis.reactionsPopup.style.width = `${state.width}px`;\n\t\t\t\t\tthis.reactionsPopup.style.left = `${state.left}px`;\n\t\t\t\t\tthis.reactionsPopup.style.top = `${state.top}px`;\n\t\t\t\t\tthis.reactionsPopup.style.borderRadius = `${state.borderRadius}px`;\n\t\t\t\t\tthis.reactionsPopup.style.opacity = state.opacity / 100;\n\t\t\t\t\tthis.reactionsPopupOpacityState = state.opacity;\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tthis.reactionsPopup.style.opacity = '';\n\t\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-active-final');\n\t\t\t\t\tlikeInstance.box.classList.add('feed-post-emoji-control-active');\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.reactionsPopupAnimation.animate();\n\n\t\t\tsetTimeout(() => {\n\n\t\t\t\tconst reactions = this.reactionsPopup.querySelectorAll('.feed-post-emoji-icon-item');\n\n\t\t\t\tthis.reactionsPopupAnimation2 = new BX.easing({\n\t\t\t\t\tduration: 140,\n\t\t\t\t\tstart: {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t},\n\t\t\t\t\tfinish: {\n\t\t\t\t\t\topacity: 100\n\t\t\t\t\t},\n\t\t\t\t\ttransition : BX.easing.transitions.cubic,\n\t\t\t\t\tstep: (state) => {\n\t\t\t\t\t\treactions[0].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[1].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[2].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[3].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[4].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[5].style.opacity = state.opacity / 100;\n\t\t\t\t\t\treactions[6].style.opacity = state.opacity / 100;\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-active-final-item');\n\t\t\t\t\t\treactions[0].style.opacity = '';\n\t\t\t\t\t\treactions[1].style.opacity = '';\n\t\t\t\t\t\treactions[2].style.opacity = '';\n\t\t\t\t\t\treactions[3].style.opacity = '';\n\t\t\t\t\t\treactions[4].style.opacity = '';\n\t\t\t\t\t\treactions[5].style.opacity = '';\n\t\t\t\t\t\treactions[6].style.opacity = '';\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.reactionsPopupAnimation2.animate();\n\t\t\t}, 100);\n\t\t}\n\n\t\tif (!this.reactionsPopup.classList.contains('feed-post-emoji-popup-active'))\n\t\t{\n\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-active');\n\t\t}\n\n\t\tif (!RatingManager.mobile)\n\t\t{\n\t\t\tdocument.addEventListener('mousemove', this.reactionsPopupMouseOutHandler);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.touchScrollTop = GetWindowSize().scrollTop;\n\t\t\tthis.hasMobileTouchMoved = null;\n\n\t\t\twindow.addEventListener('touchend', this.reactionsPopupMobileTouchEndHandler);\n\t\t\twindow.addEventListener('touchmove', this.reactionsPopupMobileTouchMoveHandler);\n\t\t}\n\t}\n\n\tstatic reactionsPopupMobileTouchEnd(e)\n\t{\n\t\tconst coords = {\n\t\t\tx: e.changedTouches[0].pageX, // e.touches[0].clientX + window.pageXOffset\n\t\t\ty: e.changedTouches[0].pageY, // e.touches[0].clientY + window.pageYOffset\n\t\t};\n\n\t\tif (this.hasMobileTouchMoved === true)\n\t\t{\n\t\t\tlet userReaction = null;\n\t\t\tconst reactionNode = this.reactionsPopupMobileGetHoverNode(coords.x, coords.y);\n\n\t\t\tif (\n\t\t\t\treactionNode\n\t\t\t\t&& (userReaction = reactionNode.getAttribute('data-reaction'))\n\t\t\t)\n\t\t\t{\n\t\t\t\tRatingLike.ClickVote(\n\t\t\t\t\te,\n\t\t\t\t\tthis.reactionsPopupLikeId,\n\t\t\t\t\tuserReaction,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.reactionsPopupMobileHideHandler();\n\t\t}\n\t\telse // show reactions popup and handle clicks\n\t\t{\n\t\t\twindow.addEventListener('touchend', this.reactionsPopupMobileHideHandler);\n\t\t}\n\n\t\twindow.removeEventListener('touchend', this.reactionsPopupMobileTouchEndHandler);\n\t\twindow.removeEventListener('touchmove', this.reactionsPopupMobileTouchMoveHandler);\n\n\t\tthis.touchStartPosition = null;\n\t\te.preventDefault();\n\t}\n\n\tstatic reactionsPopupMobileTouchMove(e)\n\t{\n\t\tconst coords = {\n\t\t\tx: e.touches[0].pageX, // e.touches[0].clientX + window.pageXOffset\n\t\t\ty: e.touches[0].pageY, // e.touches[0].clientY + window.pageYOffset\n\t\t};\n\n\n\t\tthis.touchCurrentPosition = {\n\t\t\tx: coords.x,\n\t\t\ty: coords.y,\n\t\t};\n\n\t\tif (this.touchStartPosition === null)\n\t\t{\n\t\t\tthis.touchStartPosition = {\n\t\t\t\tx: coords.x,\n\t\t\t\ty: coords.y,\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.hasMobileTouchMoved !== true)\n\t\t\t{\n\t\t\t\tthis.hasMobileTouchMoved = !this.reactionsPopupMobileCheckTouchMove();\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasMobileTouchMoved === true)\n\t\t{\n\t\t\tconst reactionNode = this.reactionsPopupMobileGetHoverNode(coords.x, coords.y);\n\t\t\tif (reactionNode)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.currentReactionNodeHover\n\t\t\t\t\t&& this.currentReactionNodeHover !== reactionNode\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover);\n\t\t\t\t}\n\t\t\t\tthis.reactionsPopupMobileAddHover(reactionNode);\n\t\t\t\tthis.currentReactionNodeHover = reactionNode;\n\t\t\t}\n\t\t\telse if (this.currentReactionNodeHover)\n\t\t\t{\n\t\t\t\tthis.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.currentReactionNodeHover)\n\t\t\t{\n\t\t\t\tthis.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic blockReactionsPopup()\n\t{\n\t\tif (this.blockShowPopupTimeout)\n\t\t{\n\t\t\twindow.clearTimeout(this.blockShowPopupTimeout);\n\t\t}\n\n\t\tthis.blockShowPopup = true;\n\t\tthis.blockShowPopupTimeout = setTimeout(() => {\n\t\t\tthis.blockShowPopup = false;\n\t\t}, 500);\n\t}\n\n\tstatic hideReactionsPopup(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : false);\n\n\t\tif (this.reactionsPopup)\n\t\t{\n\t\t\tif (RatingManager.mobile)\n\t\t\t{\n\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-invisible-final');\n\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-invisible-final-mobile');\n\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active');\n\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active-final');\n\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active-final-item');\n\t\t\t\tthis.reactionsPopupMobileEnableScroll();\n\t\t\t\tDom.remove(this.reactionsPopup);\n\t\t\t\tthis.reactionsPopup = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.reactionsPopupAnimation)\n\t\t\t\t{\n\t\t\t\t\tthis.reactionsPopupAnimation.stop();\n\t\t\t\t}\n\t\t\t\tif (this.reactionsPopupAnimation2)\n\t\t\t\t{\n\t\t\t\t\tthis.reactionsPopupAnimation2.stop();\n\t\t\t\t}\n\n\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-invisible');\n\n\t\t\t\tthis.reactionsPopupAnimation4 = new BX.easing({\n\t\t\t\t\tduration: 500,\n\t\t\t\t\tstart: {\n\t\t\t\t\t\topacity: this.reactionsPopupOpacityState,\n\t\t\t\t\t},\n\t\t\t\t\tfinish: {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t},\n\t\t\t\t\ttransition: BX.easing.transitions.linear,\n\t\t\t\t\tstep: (state) => {\n\t\t\t\t\t\tthis.reactionsPopup.style.opacity = state.opacity / 100;\n\t\t\t\t\t\tthis.reactionsPopupOpacityState = state.opacity;\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\tthis.reactionsPopup.style.opacity = '';\n\t\t\t\t\t\tthis.reactionsPopup.classList.add('feed-post-emoji-popup-invisible-final');\n\t\t\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active');\n\t\t\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active-final');\n\t\t\t\t\t\tthis.reactionsPopup.classList.remove('feed-post-emoji-popup-active-final-item');\n\t\t\t\t\t\tDom.remove(this.reactionsPopup);\n\t\t\t\t\t\tthis.reactionsPopup = null;\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.reactionsPopupAnimation4.animate();\n\t\t\t}\n\n\t\t\tthis.reactionsPopupLikeId = null;\n\n\t\t\tif (likeId)\n\t\t\t{\n\t\t\t\tRatingLike.getInstance(likeId).box.classList.remove('feed-post-emoji-control-active');\n\t\t\t}\n\t\t}\n\n\t\tthis.reactionsPopupMobileRemoveHover(this.currentReactionNodeHover);\n\n\t\tif (likeId)\n\t\t{\n\t\t\tthis.bindReactionsPopup({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic reactionsPopupMobileCheckTouchMove()\n\t{\n\t\tif (this.touchStartPosition === null)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\tMath.abs(this.touchCurrentPosition.x - this.touchStartPosition.x) > 5\n\t\t\t\t|| Math.abs(this.touchCurrentPosition.y - this.touchStartPosition.y) > 5\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstatic reactionsPopupMobileHide(e)\n\t{\n\t\twindow.removeEventListener('touchend', this.reactionsPopupMobileHideHandler);\n\t\tif (this.reactionsPopupLikeId)\n\t\t{\n\t\t\tthis.hideReactionsPopup({\n\t\t\t\tlikeId: this.reactionsPopupLikeId,\n\t\t\t});\n\n\t\t\tif (e)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic reactionsPopupMobileGetHoverNode(x, y)\n\t{\n\t\tconst nodeAboveFinger = document.elementFromPoint(x, (y + this.touchMoveDeltaY - this.touchScrollTop));\n\t\tconst nodeBelowFinger = document.elementFromPoint(x, (y - this.touchScrollTop));\n\n\t\tconst iconNodeAboveFinger = nodeAboveFinger?.closest('[data-reaction]');\n\t\tconst iconNodeBelowFinger = nodeBelowFinger?.closest('[data-reaction]');\n\n\t\tconst reactionNode = iconNodeAboveFinger || iconNodeBelowFinger;\n\n\t\tconst userReaction = reactionNode?.getAttribute('data-reaction');\n\n\t\treturn Type.isStringFilled(userReaction) ? reactionNode : null;\n\t}\n\n\tstatic reactionsPopupMobileAddHover(reactionNode)\n\t{\n\t\tif (!reactionNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treactionNode.classList.add('feed-post-emoji-icon-item-hover');\n\t}\n\n\tstatic reactionsPopupMobileRemoveHover(reactionNode)\n\t{\n\t\tif (!reactionNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treactionNode.classList.remove('feed-post-emoji-icon-item-hover');\n\t}\n\n\tstatic reactionsPopupMobileEnableScroll()\n\t{\n\t\tdocument.removeEventListener('touchmove', this.touchMoveScrollListener, { passive: false });\n\t\tEventEmitter.emit('onPullDownEnable');\n\n\t\tif (this.mobileOverlay !== null)\n\t\t{\n\t\t\tDom.clean(this.mobileOverlay);\n\t\t\tDom.remove(this.mobileOverlay);\n\n\t\t\tthis.mobileOverlay = null;\n\t\t}\n\t}\n\n\tstatic reactionsPopupMobileDisableScroll()\n\t{\n\t\tdocument.addEventListener('touchmove', this.touchMoveScrollListener, { passive: false });\n\t\tif (app)\n\t\t{\n\t\t\tapp.exec('disableTabScrolling');\n\t\t}\n\t\tEventEmitter.emit('onPullDownDisable');\n\n\t\tif (!Type.isNull(this.mobileOverlay))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mobileOverlay = Dom.create('DIV', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'feed-post-emoji-popup-mobile-overlay',\n\t\t\t},\n\t\t});\n\t\tsetTimeout(() => {\n\t\t\tif (Type.isNull(this.mobileOverlay))\n\t\t\t{\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tDom.append(this.mobileOverlay, document.body);\n\t\t}, 1000); // to avoid blink\n\t}\n\n\tstatic bindReactionsPopup(params) {\n\n\t\tif (RatingManager.mobile)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\n\t\tif (!Type.isStringFilled(likeId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\t\tif (!likeInstance)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlikeInstance.mouseOverHandler = Runtime.debounce(this.getMouseOverHandler(likeId), 500);\n\n\t\tlikeInstance.box.addEventListener('mouseenter', likeInstance.mouseOverHandler);\n\t\tlikeInstance.box.addEventListener('mouseleave', this.blockReactionsPopup);\n\t}\n\n\tstatic touchMoveScrollListener(e)\n\t{\n\t\te.preventDefault();\n\t}\n\n\tstatic getReactionsPopupMouseOutHandler(likeId)\n\t{\n\t\treturn (e) => {\n\n\t\t\tconst popupPosition = this.reactionsPopup.getBoundingClientRect();\n\t\t\tconst inverted = this.reactionsPopup.classList.contains('feed-post-emoji-popup-inverted');\n\n\t\t\tif (\n\t\t\t\te.clientX >= popupPosition.left\n\t\t\t\t&& e.clientX <= popupPosition.right\n\t\t\t\t&& e.clientY >= popupPosition.top - (inverted ? 25 : 0)\n\t\t\t\t&& e.clientY <= (popupPosition.bottom + (inverted ? 0 : 25))\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blockReactionsPopup();\n\t\t\tthis.hideReactionsPopup({\n\t\t\t\tlikeId: likeId\n\t\t\t});\n\n\t\t\tdocument.removeEventListener('mousemove', this.reactionsPopupMouseOutHandler)\n\t\t\tthis.reactionsPopupMouseOutHandler = null;\n\t\t};\n\t}\n\n\tstatic getMouseOverHandler(likeId)\n\t{\n\t\treturn () => {\n\n\t\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\t\tif (!this.afterClickBlockShowPopup)\n\t\t\t{\n\t\t\t\tif (this.blockShowPopup)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (RatingManager.mobile)\n\t\t\t\t{\n\t\t\t\t\tapp.exec('callVibration');\n\t\t\t\t}\n\n\t\t\t\tthis.showReactionsPopup({\n\t\t\t\t\tbindElement: likeInstance.box,\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlikeInstance.box.removeEventListener('mouseenter', likeInstance.mouseOverHandler);\n\t\t\tlikeInstance.box.removeEventListener('mouseleave', this.blockReactionsPopup.bind(this));\n\t\t};\n\t}\n\n\tstatic buildPopupContent(params)\n\t{\n\t\tconst clear = (params.clear ? Boolean(params.clear) : false);\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\t\tconst rating = params.rating;\n\t\tconst requestReaction = (Type.isStringFilled(params.reaction) ? params.reaction : '');\n\t\tconst page = (Number(params.page) > 0 ? Number(params.page) : 1);\n\t\tconst data = params.data;\n\t\tconst reaction = false;\n\n\t\tconst reactionsList = [];\n\t\tlet reactionsCount = 0;\n\n\t\tif (\n\t\t\tclear\n\t\t\t&& page === 1\n\t\t)\n\t\t{\n\t\t\tthis.clearPopupContent({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}\n\n\t\tthis.popupCurrentReaction = (Type.isStringFilled(requestReaction) ? requestReaction : 'all');\n\n\t\tif (\n\t\t\trequestReaction.length <= 0\n\t\t\t|| requestReaction == 'all'\n\t\t) // first current tab\n\t\t{\n\t\t\tthis.popupSizeInitialized = false;\n\t\t\tdocument.getElementById(`bx-ilike-popup-cont-${likeId}`).style.height = 'auto';\n\t\t\tdocument.getElementById(`bx-ilike-popup-cont-${likeId}`).style.minWidth = 'auto';\n\t\t}\n\n\t\tif (!Type.isStringFilled(requestReaction))\n\t\t{\n\t\t\tthis.popupPagesList = {};\n\t\t}\n\n\t\tthis.popupPagesList[(requestReaction == '' ? 'all' : requestReaction)] = (page + 1);\n\n\t\tif (Type.isPlainObject(data.reactions))\n\t\t{\n\t\t\tObject.entries(data.reactions).forEach(([ reaction, count ]) => {\n\t\t\t\tif (Number(count) <= 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treactionsList.push({\n\t\t\t\t\treaction: reaction,\n\t\t\t\t\tcount: Number(count)\n\t\t\t\t});\n\t\t\t\treactionsCount++;\n\t\t\t});\n\t\t}\n\n\t\tconst tabsNode = Dom.create('span', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-ilike-popup-head',\n\t\t\t},\n\t\t});\n\n\t\tif (reactionsCount > 1)\n\t\t{\n\t\t\tconst headClassList = [ 'bx-ilike-popup-head-item' ];\n\t\t\tif (!Type.isStringFilled(requestReaction) || requestReaction == 'all')\n\t\t\t{\n\t\t\t\theadClassList.push('bx-ilike-popup-head-item-current');\n\t\t\t}\n\n\t\t\ttabsNode.appendChild(Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: headClassList.join(' '),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-head-icon feed-post-emoji-icon-all',\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-head-text',\n\t\t\t\t\t\t},\n\t\t\t\t\t\thtml: Loc.getMessage('RATING_LIKE_POPUP_ALL').replace('#CNT#', Number(data.items_all)),\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: ((e) => {\n\t\t\t\t\t\tthis.changePopupTab({\n\t\t\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\t\t\trating: rating,\n\t\t\t\t\t\t\treaction: 'all',\n\t\t\t\t\t\t});\n\t\t\t\t\t\te. preventDefault();\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t}));\n\t\t}\n\n\t\tif (reactionsCount === 0)\n\t\t{\n\t\t\treactionsList.push({\n\t\t\t\treaction: Loc.getMessage('RATING_LIKE_REACTION_DEFAULT'),\n\t\t\t\tcount: Number(data.items_all),\n\t\t\t});\n\t\t}\n\n\t\treactionsList.sort((a, b) => {\n\t\t\tconst sample = {\n\t\t\t\tlike: 0,\n\t\t\t\tkiss: 1,\n\t\t\t\tlaugh: 2,\n\t\t\t\twonder: 3,\n\t\t\t\tcry: 4,\n\t\t\t\tangry: 5,\n\t\t\t\tfacepalm: 6,\n\t\t\t};\n\t\t\tif (sample[a.reaction] < sample[b.reaction])\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (sample[a.reaction] > sample[b.reaction])\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\treactionsList.forEach((reactionData) => {\n\n\t\t\tconst headItemClassList = [ 'bx-ilike-popup-head-item' ];\n\t\t\tif (requestReaction === reactionData.reaction)\n\t\t\t{\n\t\t\t\theadItemClassList.push('bx-ilike-popup-head-item-current');\n\t\t\t}\n\n\t\t\ttabsNode.appendChild(Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: headItemClassList.join(' '),\n\t\t\t\t},\n\t\t\t\tattrs: {\n\t\t\t\t\ttitle: Loc.getMessage(`RATING_LIKE_EMOTION_${reactionData.reaction.toUpperCase()}_CALC`),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: [\n\t\t\t\t\t\t\t\t'bx-ilike-popup-head-icon',\n\t\t\t\t\t\t\t\t'feed-post-emoji-icon-item',\n\t\t\t\t\t\t\t\t`feed-post-emoji-icon-${reactionData.reaction}`,\n\t\t\t\t\t\t\t].join(' '),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-head-text',\n\t\t\t\t\t\t},\n\t\t\t\t\t\thtml: reactionData.count,\n\t\t\t\t\t})\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (e) => {\n\n\t\t\t\t\t\tconst popupContent = document.getElementById(`bx-ilike-popup-cont-${likeId}`);\n\t\t\t\t\t\tconst popupContentPosition = popupContent.getBoundingClientRect();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\trequestReaction.length <= 0\n\t\t\t\t\t\t\t|| requestReaction === 'all'\n\t\t\t\t\t\t) // first current tab\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popupSizeInitialized = true;\n\t\t\t\t\t\t\tpopupContent.style.height = `${popupContentPosition.height}px`;\n\t\t\t\t\t\t\tpopupContent.style.minWidth = `${popupContentPosition.width}px`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (popupContentPosition.width > Number(popupContent.style.minWidth))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tpopupContent.style.minWidth = `${popupContentPosition.width}px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.changePopupTab({\n\t\t\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\t\t\trating: rating,\n\t\t\t\t\t\t\treaction: reactionData.reaction,\n\t\t\t\t\t\t});\n\t\t\t\t\t\te. preventDefault();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\n\t\tlet usersNode = rating.popupContent.querySelector('.bx-ilike-popup-content-container');\n\t\tlet usersNodeExists = false;\n\n\t\tif (!usersNode)\n\t\t{\n\t\t\tusersNode = Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-ilike-popup-content-container',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tusersNodeExists = true;\n\t\t}\n\n\t\tusersNode.querySelectorAll('.bx-ilike-popup-content').forEach((contentNode) => {\n\t\t\tcontentNode.classList.add('bx-ilike-popup-content-invisible');\n\t\t});\n\n\t\tlet reactionUsersNode = usersNode.querySelector(`.bx-ilike-popup-content-${this.popupCurrentReaction}`);\n\t\tif (!reactionUsersNode)\n\t\t{\n\t\t\treactionUsersNode = Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: [\n\t\t\t\t\t\t'bx-ilike-popup-content',\n\t\t\t\t\t\t`bx-ilike-popup-content-${this.popupCurrentReaction}`,\n\t\t\t\t\t].join(' '),\n\t\t\t\t}\n\t\t\t});\n\t\t\tusersNode.appendChild(reactionUsersNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treactionUsersNode.classList.remove('bx-ilike-popup-content-invisible');\n\t\t}\n\n\t\tdata.items.forEach((item) => {\n\n\t\t\tconst userItemClassList = [ 'bx-ilike-popup-user-item' ];\n\t\t\tif (Type.isStringFilled(item.USER_TYPE))\n\t\t\t{\n\t\t\t\tuserItemClassList.push(`bx-ilike-popup-user-item-${item.USER_TYPE}`);\n\t\t\t}\n\n\t\t\treactionUsersNode.appendChild(Dom.create('a', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: userItemClassList.join(' '),\n\t\t\t\t},\n\t\t\t\tattrs: {\n\t\t\t\t\thref: item.URL,\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-user-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: (\n\t\t\t\t\t\t\tType.isStringFilled(item.PHOTO_SRC)\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t'background-image': `url(\"${item.PHOTO_SRC}\")`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: {}\n\t\t\t\t\t\t)\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-user-name'\n\t\t\t\t\t\t},\n\t\t\t\t\t\thtml: item.FULL_NAME,\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-user-status',\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}));\n\t\t});\n\n\n\t\tconst waitNode = rating.popupContent.querySelector('.bx-ilike-wait');\n\t\tif (waitNode)\n\t\t{\n\t\t\tDom.clean(waitNode);\n\t\t\tDom.remove(waitNode);\n\t\t}\n\t\tconst tabsNodeOld = rating.popupContent.querySelector('.bx-ilike-popup-head');\n\t\tif (tabsNodeOld)\n\t\t{\n\t\t\ttabsNodeOld.parentNode.insertBefore(tabsNode, tabsNodeOld);\n\t\t\ttabsNodeOld.parentNode.removeChild(tabsNodeOld);\n\t\t}\n\t\telse\n\t\t{\n\t\t\trating.popupContent.appendChild(tabsNode);\n\t\t}\n\n\t\tif (!usersNodeExists)\n\t\t{\n\t\t\trating.popupContent.appendChild(usersNode);\n\t\t}\n\t}\n\n\tstatic clearPopupContent(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\t\tlikeInstance.popupContent.innerHTML = '';\n\t\tdocument.getElementById(`bx-ilike-popup-cont-${likeId}`).style.height = 'auto';\n\t\tdocument.getElementById(`bx-ilike-popup-cont-${likeId}`).style.minWidth = 'auto';\n\t\tlikeInstance.popupContent.appendChild(Dom.create('span', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-ilike-wait',\n\t\t\t},\n\t\t}));\n\t}\n\n\tstatic changePopupTab(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\t\tconst rating = params.rating;\n\t\tconst reaction = (Type.isStringFilled(params.reaction) ? params.reaction : '');\n\n\t\tconst contentContainerNode = rating.popupContent.querySelector('.bx-ilike-popup-content-container');\n\t\tif (!contentContainerNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst reactionUsersNode = contentContainerNode.querySelector('.bx-ilike-popup-content-' + reaction);\n\t\tif (reactionUsersNode)\n\t\t{\n\t\t\tthis.popupCurrentReaction = (Type.isStringFilled(reaction) ? reaction : 'all');\n\n\t\t\trating.popupContent.querySelectorAll('.bx-ilike-popup-head-item').forEach((tabNode) => {\n\t\t\t\ttabNode.classList.remove('bx-ilike-popup-head-item-current');\n\t\t\t\tconst reactionTabNode = tabNode.querySelector(`.feed-post-emoji-icon-${reaction}`);\n\t\t\t\tif (reactionTabNode)\n\t\t\t\t{\n\t\t\t\t\ttabNode.classList.add('bx-ilike-popup-head-item-current');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcontentContainerNode.querySelectorAll('.bx-ilike-popup-content').forEach((contentNode) => {\n\t\t\t\tcontentNode.classList.add('bx-ilike-popup-content-invisible');\n\t\t\t});\n\t\t\treactionUsersNode.classList.remove('bx-ilike-popup-content-invisible');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tListPopup.List(likeId, 1, reaction);\n\t\t}\n\t}\n\n\tstatic buildPopupContentNoReactions(params)\n\t{\n\t\tconst page = (Number(params.page) > 0 ? Number(params.page) : 1);\n\t\tconst likeInstance = (!Type.isUndefined(params.rating) ? params.rating : null);\n\t\tconst data = params.data;\n\n\t\tif (!likeInstance)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (page === 1)\n\t\t{\n\t\t\tlikeInstance.popupContent.innerHTML = '';\n\t\t\tlikeInstance.popupContent.appendChild(Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-ilike-bottom_scroll',\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tlikeInstance.popupContentPage += 1;\n\n\t\tdata.items.forEach((item) => {\n\t\t\tlet avatarNode = null;\n\n\t\t\tif (Type.isStringFilled(item.PHOTO_SRC))\n\t\t\t{\n\t\t\t\tavatarNode = Dom.create('img', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tsrc: item.PHOTO_SRC,\n\t\t\t\t\t},\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-ilike-popup-avatar-img',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tavatarNode = Dom.create('img', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tsrc: '/bitrix/images/main/blank.gif',\n\t\t\t\t\t},\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst imgClassList = [\n\t\t\t\t'bx-ilike-popup-img',\n\t\t\t];\n\t\t\tif (Type.isStringFilled(item.USER_TYPE))\n\t\t\t{\n\t\t\t\timgClassList.push(`bx-ilike-popup-img-${item.USER_TYPE}`);\n\t\t\t}\n\n\t\t\tlikeInstance.popupContent.appendChild(\n\t\t\t\tDom.create('a', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\thref: item.URL,\n\t\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\t},\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: imgClassList.join(' '),\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-avatar-new',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tavatarNode,\n\t\t\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-avatar-status-icon',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-ilike-popup-name-new',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thtml: item.FULL_NAME,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t}\n\n\tstatic afterClick(params)\n\t{\n\t\tconst likeId = (Type.isStringFilled(params.likeId) ? params.likeId : '');\n\n\t\tif (!Type.isStringFilled(likeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.afterClickBlockShowPopup = true;\n\n\t\tthis.afterClickHandler = this.getAfterClickHandler(likeId);\n\n\t\tRatingLike.getInstance(likeId).box.addEventListener('mouseleave', this.afterClickHandler);\n\t}\n\n\tstatic getAfterClickHandler(likeId)\n\t{\n\t\treturn () => {\n\t\t\tthis.afterClickBlockShowPopup = false;\n\n\t\t\tRatingLike.getInstance(likeId).box.removeEventListener('mouseleave', this.afterClickHandler);\n\t\t};\n\t}\n\n\tstatic resultReactionClick(e)\n\t{\n\t\tconst likeId = e.currentTarget.getAttribute('data-like-id');\n\t\tlet reaction = e.currentTarget.getAttribute('data-reaction');\n\n\t\tif (!Type.isSet(reaction))\n\t\t{\n\t\t\treaction = '';\n\t\t}\n\n\t\tListPopup.onResultClick({\n\t\t\tlikeId: likeId,\n\t\t\tevent: e,\n\t\t\treaction: reaction,\n\t\t});\n\n\t\te.stopPropagation();\n\t}\n\n\tstatic resultReactionMouseEnter(e)\n\t{\n\t\tconst likeId = e.currentTarget.getAttribute('data-like-id');\n\t\tconst reaction = e.currentTarget.getAttribute('data-reaction');\n\n\t\tListPopup.onResultMouseEnter({\n\t\t\tlikeId: likeId,\n\t\t\tevent: e,\n\t\t\treaction: reaction,\n\t\t});\n\t}\n\n\tstatic resultReactionMouseLeave(e)\n\t{\n\t\tconst likeId = e.currentTarget.getAttribute('data-like-id');\n\t\tconst reaction = e.currentTarget.getAttribute('data-reaction');\n\n\t\tListPopup.onResultMouseLeave({\n\t\t\tlikeId: likeId,\n\t\t\treaction: reaction,\n\t\t});\n\t}\n\n\tstatic openMobileReactionsPage(params)\n\t{\n\t\tBXMobileApp.PageManager.loadPageBlank({\n\t\t\turl: `${Loc.getMessage('SITE_DIR')}mobile/like/result.php`,\n\t\t\ttitle: Loc.getMessage('RATING_LIKE_RESULTS'),\n\t\t\tbackdrop: {\n\t\t\t\tmediumPositionPercent: 65,\n\t\t\t},\n\t\t\tcache: true,\n\t\t\tdata: {\n\t\t\t\tentityTypeId: params.entityTypeId,\n\t\t\t\tentityId: params.entityId,\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic onRatingLike(eventData)\n\t{\n\t\tRatingLike.repo.forEach((likeInstance, likeId) => {\n\t\t\tif (\n\t\t\t\tlikeInstance.entityTypeId !== eventData.entityTypeId\n\t\t\t\t&& Number(likeInstance.entityId) !== Number(eventData.entityId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet voteAction = (Type.isStringFilled(eventData.voteAction) ? eventData.voteAction.toUpperCase() : 'ADD');\n\t\t\tvoteAction = (voteAction === 'PLUS' ? 'ADD' : voteAction);\n\n\t\t\tif (\n\t\t\t\tNumber(eventData.userId) === Number(Loc.getMessage('USER_ID'))\n\t\t\t\t&& likeInstance.button\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (voteAction === 'CANCEL')\n\t\t\t\t{\n\t\t\t\t\tlikeInstance.button.classList.remove('bx-you-like-button');\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlikeInstance.button.classList.add('bx-you-like-button');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tRatingLike.Draw(likeId, {\n\t\t\t\tTYPE: voteAction,\n\t\t\t\tUSER_ID: eventData.userId,\n\t\t\t\tENTITY_TYPE_ID: eventData.entityTypeId,\n\t\t\t\tENTITY_ID: eventData.entityId,\n\t\t\t\tUSER_DATA: eventData.userData,\n\t\t\t\tREACTION: eventData.voteReaction,\n\t\t\t\tREACTION_OLD: eventData.voteReactionOld,\n\t\t\t\tTOTAL_POSITIVE_VOTES: eventData.itemsAll,\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic onMobileCommentsGet()\n\t{\n\t\tconst ratingEmojiSelectorPopup = document.querySelector('.feed-post-emoji-popup-container');\n\t\tif (ratingEmojiSelectorPopup)\n\t\t{\n\t\t\tratingEmojiSelectorPopup.style.top = 0;\n\t\t\tratingEmojiSelectorPopup.style.left = 0;\n\t\t\tratingEmojiSelectorPopup.classList.remove('feed-post-emoji-popup-active');\n\t\t\tratingEmojiSelectorPopup.classList.remove('feed-post-emoji-popup-active-final');\n\t\t\tratingEmojiSelectorPopup.classList.remove('feed-post-emoji-popup-active-final-item');\n\t\t\tratingEmojiSelectorPopup.classList.add('feed-post-emoji-popup-invisible-final');\n\t\t\tratingEmojiSelectorPopup.classList.add('feed-post-emoji-popup-invisible-final-mobile');\n\t\t}\n\t}\n\n\tstatic getNode(node)\n\t{\n\t\tif (Type.isDomNode(node))\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\telse if (Type.isStringFilled(node))\n\t\t{\n\t\t\treturn document.getElementById(node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t}\n}\n","import { Type, Runtime } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport { RatingRender } from './render';\nimport { ListPopup } from './listpopup';\n\nexport class RatingManager\n{\n\tstatic mobile = false;\n\tstatic initialized = false;\n\tstatic displayHeight = 0;\n\tstatic startScrollTop = 0;\n\tstatic entityList = [];\n\tstatic ratingNodeList = new Map();\n\tstatic delayedList = new Map();\n\n\tstatic init(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (this.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mobile = (!Type.isUndefined(params.mobile) && !!params.mobile);\n\n\t\tthis.initialized = true;\n\n\t\tthis.setDisplayHeight();\n\n\t\tif (!this.mobile)\n\t\t{\n\t\t\twindow.addEventListener('scroll', Runtime.throttle(() => {\n\t\t\t\tthis.getInViewScope();\n\t\t\t}, 80), { passive: true });\n\n\t\t\twindow.addEventListener('resize', this.setDisplayHeight.bind(this));\n\t\t}\n\n\t\tEventEmitter.subscribe('onBeforeMobileLivefeedRefresh', RatingRender.reactionsPopupMobileHide)\n\t\tEventEmitter.subscribe('BX.MobileLF:onCommentsGet', RatingRender.onMobileCommentsGet)\n\n\t\tif (this.mobile)\n\t\t{\n\t\t\t// new one\n\t\t\tBXMobileApp.addCustomEvent('onRatingLike', RatingRender.onRatingLike);\n\t\t}\n\n\t\tif (this.mobile)\n\t\t{\n\t\t\tBXMobileApp.addCustomEvent('onPull-main', (data) => {\n\t\t\t\tif (data.command == 'rating_vote')\n\t\t\t\t{\n\t\t\t\t\tRatingLike.LiveUpdate(data.params);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEventEmitter.subscribe('onPullEvent-main', (event: BaseEvent) => {\n\t\t\t\tconst [ command, params ] = event.getCompatData();\n\n\t\t\t\tif (command === 'rating_vote')\n\t\t\t\t{\n\t\t\t\t\tRatingLike.LiveUpdate(params);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t!Type.isUndefined(window.BX.SidePanel)\n\t\t\t\t&& BX.SidePanel.Instance.getTopSlider()\n\t\t\t)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribe(\n\t\t\t\t\tBX.SidePanel.Instance.getTopSlider().getWindow(),\n\t\t\t\t\t'SidePanel.Slider:onCloseComplete',\n\t\t\t\t\tListPopup.removeOnCloseHandler\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic setDisplayHeight()\n\t{\n\t\tthis.displayHeight = document.documentElement.clientHeight;\n\t}\n\n\tstatic getInViewScope()\n\t{\n\t\tlet ratingNode = null;\n\t\tthis.delayedList.forEach((value, key) => {\n\n\t\t\tratingNode = BX(this.getNode(key));\n\n\t\t\tif (!ratingNode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isNodeVisibleOnScreen(ratingNode))\n\t\t\t{\n\t\t\t\tthis.fireAnimation(key);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic addNode(entityId, node)\n\t{\n\t\tif (\n\t\t\t!Type.isDomNode(node)\n//\t\t\t|| !Type.isUndefined(this.ratingNodeList.get(entityId))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ratingNodeList.set(entityId, node);\n\t}\n\n\n\tstatic getNode(entityId)\n\t{\n\t\tconst node = this.ratingNodeList.get(entityId);\n\t\treturn (!Type.isUndefined(node) ? node : false);\n\t}\n\n\tstatic isNodeVisibleOnScreen(node)\n\t{\n\t\tconst coords = node.getBoundingClientRect();\n\t\tconst visibleAreaTop = Number(this.displayHeight / 10);\n\t\tconst visibleAreaBottom = Number(this.displayHeight * 9 / 10);\n\n\t\treturn (\n\t\t\t(\n\t\t\t\t(\n\t\t\t\t\tcoords.top > 0\n\t\t\t\t\t&& coords.top < visibleAreaBottom\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\tcoords.bottom > visibleAreaTop\n\t\t\t\t\t&& coords.bottom < this.displayHeight\n\t\t\t\t)\n\t\t\t)\n\t\t\t&& (\n\t\t\t\tthis.mobile\n\t\t\t\t|| !(\n\t\t\t\t\t(\n\t\t\t\t\t\tcoords.top < visibleAreaTop\n\t\t\t\t\t\t&& coords.bottom < visibleAreaTop\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\tcoords.top > visibleAreaBottom\n\t\t\t\t\t&& coords.bottom > visibleAreaBottom\n\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t);\n\t}\n\n\tstatic fireAnimation(key)\n\t{\n\t\tthis.delayedList.delete(key);\n\t}\n\n\tstatic addEntity(entityId, ratingObject)\n\t{\n\t\tif (\n\t\t\t!this.entityList.includes(entityId)\n\t\t\t&& ratingObject.topPanelContainer\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.entityList.push(entityId);\n\t\t\t\tthis.addNode(entityId, ratingObject.topPanelContainer);\n\t\t\t}\n\t}\n\n\tstatic live(params)\n\t{\n\t\tif (\n\t\t\tType.isUndefined(params.TYPE)\n\t\t\t|| params.TYPE !== 'ADD'\n\t\t\t|| !Type.isStringFilled(params.ENTITY_TYPE_ID)\n\t\t\t|| Type.isUndefined(params.ENTITY_ID)\n\t\t\t|| Number(params.ENTITY_ID) <= 0\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst key = `${params.ENTITY_TYPE_ID}_${params.ENTITY_ID}`;\n\t\tif (!this.checkEntity(key))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst ratingNode = this.getNode(key);\n\t\tif (!ratingNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isNodeVisibleOnScreen(ratingNode))\n\t\t{\n\t\t\tthis.fireAnimation(key);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addDelayed(params)\n\t\t}\n\t}\n\n\tstatic checkEntity(entityId)\n\t{\n\t\treturn this.entityList.includes(entityId);\n\t}\n\n\tstatic addDelayed(liveParams)\n\t{\n\t\tif (\n\t\t\t!Type.isStringFilled(liveParams.ENTITY_TYPE_ID)\n\t\t\t|| Type.isUndefined(liveParams.ENTITY_ID)\n\t\t\t|| Number(liveParams.ENTITY_ID) <= 0\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst key = `${liveParams.ENTITY_TYPE_ID}_${liveParams.ENTITY_ID}`;\n\n\t\tlet delayedListItem = this.delayedList.get(key);\n\t\tif (Type.isUndefined(delayedListItem))\n\t\t{\n\t\t\tdelayedListItem = [];\n\t\t}\n\n\t\tdelayedListItem.push(liveParams);\n\t\tthis.delayedList.set(key, delayedListItem);\n\t}\n}\n","import { Type, Dom, Loc, ajax } from 'main.core';\n\nimport { RatingManager } from './manager';\nimport { RatingRender } from './render';\nimport { ListPopup } from './listpopup';\n\nimport './css/reaction.css';\nimport './css/mobile.css';\n\nexport class RatingLike\n{\n\tstatic repo = new Map();\n\tstatic lastVoteRepo = new Map();\n\tstatic lastReactionRepo = new Map();\n\tstatic additionalParams = new Map();\n\n\tconstructor(likeId, entityTypeId, entityId, available, userId, localize, template, pathToUserProfile)\n\t{\n\t\tif (Type.isObject(arguments[0]))\n\t\t{\n\t\t\tconst params = arguments[0];\n\n\t\t\tthis.likeId = Type.isStringFilled(params.likeId) ? params.likeId : '';\n\t\t\tthis.entityTypeId = Type.isStringFilled(params.entityTypeId) ? params.entityTypeId : '';\n\t\t\tthis.entityId = !Type.isUndefined(params.entityId) ? Number(params.entityId) : 0;\n\t\t\tthis.available = Type.isStringFilled(params.available) ? params.available === 'Y' : false;\n\t\t\tthis.userId = !Type.isUndefined(params.userId) ? Number(params.userId) : 0;\n\t\t\tthis.localize = Type.isPlainObject(params.localize) ? params.localize : {};\n\t\t\tthis.template = Type.isStringFilled(params.template) ? params.template : '';\n\t\t\tthis.pathToUserProfile = Type.isStringFilled(params.pathToUserProfile) ? params.pathToUserProfile : '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.likeId = Type.isStringFilled(arguments[0]) ? arguments[0] : '';\n\t\t\tthis.entityTypeId = Type.isStringFilled(arguments[1]) ? arguments[1] : '';\n\t\t\tthis.entityId = !Type.isUndefined(arguments[2]) ? Number(arguments[2]) : 0;\n\t\t\tthis.available = Type.isStringFilled(arguments[3]) ? arguments[3] === 'Y' : false;\n\t\t\tthis.userId = !Type.isUndefined(arguments[4]) ? Number(arguments[4]) : 0;\n\t\t\tthis.localize = Type.isPlainObject(arguments[5]) ? arguments[5] : {};\n\t\t\tthis.template = Type.isStringFilled(arguments[6]) ? arguments[6] : '';\n\t\t\tthis.pathToUserProfile = Type.isStringFilled(arguments[7]) ? arguments[7] : '';\n\t\t}\n\n\t\tconst key = `${this.entityTypeId}_${this.entityId}`;\n\n\t\tthis.enabled = true;\n\n\t\tthis.box = document.getElementById(`bx-ilike-button-${this.likeId}`);\n\t\tif (this.box === null)\n\t\t{\n\t\t\tthis.enabled = false;\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.box.setAttribute('data-rating-vote-id', likeId);\n\n\t\tthis.button = this.box.querySelector('.bx-ilike-left-wrap');\n\t\tthis.buttonText = this.button.querySelector('.bx-ilike-text');\n\t\tthis.count = this.box.querySelector('span.bx-ilike-right-wrap');\n\t\tif (!this.count)\n\t\t{\n\t\t\tthis.count = document.getElementById(`bx-ilike-count-${this.likeId}`);\n\t\t}\n\t\tthis.countText = this.count.querySelector('.bx-ilike-right');\n\n\t\tthis.topPanelContainer = document.getElementById(`feed-post-emoji-top-panel-container-${this.likeId}`);\n\t\tthis.topPanel = document.getElementById(`feed-post-emoji-top-panel-${this.likeId}`);\n\t\tthis.topUsersText = document.getElementById(`bx-ilike-top-users-${this.likeId}`);\n\t\tthis.topUsersDataNode = document.getElementById(`bx-ilike-top-users-data-${this.likeId}`);\n\t\tthis.userReactionNode = document.getElementById(`bx-ilike-user-reaction-${this.likeId}`);\n\t\tthis.reactionsNode = document.getElementById(`feed-post-emoji-icons-${this.likeId}`);\n\n\t\tthis.popup = null;\n\t\tthis.popupId = null;\n\t\tthis.popupTimeoutIdShow = null;\n\t\tthis.popupTimeoutIdList = null;\n\n\t\tthis.popupContent = document.getElementById(`bx-ilike-popup-cont-${this.likeId}`).querySelector('span.bx-ilike-popup');\n\t\tthis.popupContentPage = 1;\n\t\tthis.popupTimeout = false;\n\t\tthis.likeTimeout = false;\n\t\tthis.mouseOverHandler = null;\n\t\tthis.version = (Type.isDomNode(this.topPanel) ? 2 : 1);\n\t\tthis.mouseInShowPopupNode = {};\n\t\tthis.listXHR = null;\n\n\t\tif (\n\t\t\tthis.template === 'light'\n\t\t\t&& Type.isDomNode(this.reactionsNode)\n\t\t)\n\t\t{\n\t\t\tconst container = this.reactionsNode.querySelector('.feed-post-emoji-icon-container');\n\t\t\tif (container)\n\t\t\t{\n\t\t\t\tlet reactionsData = container.getAttribute('data-reactions-data');\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\treactionsData = JSON.parse(reactionsData);\n\n\t\t\t\t\tconst elementsNew = [];\n\t\t\t\t\tObject.entries(reactionsData).forEach(([reaction, count]) => {\n\t\t\t\t\t\telementsNew.push({\n\t\t\t\t\t\t\treaction: reaction,\n\t\t\t\t\t\t\tcount: count,\n\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tRatingRender.drawReactions({\n\t\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\t\tcontainer: container,\n\t\t\t\t\t\tdata: elementsNew,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!Type.isUndefined(RatingLike.lastVoteRepo.get(key)))\n\t\t{\n\t\t\tthis.lastVote = RatingLike.lastVoteRepo.get(key);\n\n\t\t\tconst ratingNode = (template === 'standart' ? this.button : this.count);\n\t\t\tif (this.lastVote === 'plus')\n\t\t\t{\n\t\t\t\tratingNode.classList.add('bx-you-like');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tratingNode.classList.remove('bx-you-like');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.lastVote = (\n\t\t\t\t(this.template === 'standart' ? this.button : this.count).classList.contains('bx-you-like')\n\t\t\t\t\t? 'plus'\n\t\t\t\t\t: 'cancel'\n\t\t\t);\n\t\t\tRatingLike.lastVoteRepo.set(key, this.lastVote);\n\t\t}\n\n\t\tif (!Type.isUndefined(RatingLike.lastReactionRepo.get(key)))\n\t\t{\n\t\t\tthis.lastReaction = RatingLike.lastReactionRepo.get(key);\n\t\t\tthis.count.setAttribute('data-myreaction', this.lastReaction);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst lastReaction = this.count.getAttribute('data-myreaction');\n\t\t\tthis.lastReaction = (Type.isStringFilled(lastReaction) ? lastReaction : 'like');\n\t\t\tRatingLike.lastReactionRepo.set(key, this.lastReaction);\n\t\t}\n\n\t\tif (this.topPanelContainer)\n\t\t{\n\t\t\tRatingManager.addEntity(key, this);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tstatic setInstance(likeId: string, likeInstance)\n\t{\n\t\tthis.repo.set(likeId, likeInstance);\n\t\twindow.BXRL[likeId] = likeInstance;\n\t}\n\n\tstatic getInstance(likeId: string)\n\t{\n\t\treturn this.repo.get(likeId);\n\t}\n\n\tstatic ClickVote(e, likeId, userReaction, forceAdd)\n\t{\n\t\tif (Type.isUndefined(userReaction))\n\t\t{\n\t\t\tuserReaction = 'like';\n\t\t}\n\n\t\tconst likeInstance = this.getInstance(likeId);\n\t\tconst container = (likeInstance.template === 'standart' ? e.target : likeInstance.count);\n\n\t\tif (\n\t\t\tlikeInstance.version === 2\n\t\t\t&& likeInstance.userReactionNode\n\t\t)\n\t\t{\n\t\t\tRatingRender.hideReactionsPopup({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t\tRatingRender.blockReactionsPopup();\n\t\t\tdocument.removeEventListener('mousemove', RatingRender.reactionsPopupMouseOutHandler);\n\t\t}\n\n\t\tclearTimeout(likeInstance.likeTimeout);\n\n\t\tconst active = container.classList.contains('bx-you-like');\n\n\t\tforceAdd = !!forceAdd;\n\n\t\tlet change = false;\n\t\tlet userReactionOld = false;\n\n\t\tif (active && !forceAdd)\n\t\t{\n\t\t\tuserReaction = (\n\t\t\t\tlikeInstance.version === 2\n\t\t\t\t\t? RatingRender.getUserReaction({\n\t\t\t\t\t\tuserReactionNode: likeInstance.userReactionNode\n\t\t\t\t\t})\n\t\t\t\t\t: false\n\t\t\t);\n\n\t\t\tlikeInstance.buttonText.innerHTML = likeInstance.localize['LIKE_N'];\n\t\t\tlikeInstance.countText.innerHTML = Number(likeInstance.countText.innerHTML)-1;\n\n\t\t\tcontainer.classList.remove('bx-you-like');\n\t\t\tlikeInstance.button.classList.remove('bx-you-like-button');\n\n\t\t\tif (userReaction)\n\t\t\t{\n\t\t\t\tlikeInstance.button.classList.remove(`bx-you-like-button-${userReaction}`);\n\t\t\t}\n\n\t\t\tlikeInstance.likeTimeout = setTimeout(() => {\n\t\t\t\tif (likeInstance.lastVote != 'cancel')\n\t\t\t\t{\n\t\t\t\t\tthis.Vote(likeId, 'cancel', userReaction);\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t}\n\t\telse if (active && forceAdd)\n\t\t{\n\t\t\tchange = true;\n\t\t\tuserReactionOld = (\n\t\t\t\tlikeInstance.version === 2\n\t\t\t\t\t? RatingRender.getUserReaction({ userReactionNode: likeInstance.userReactionNode })\n\t\t\t\t\t: false\n\t\t\t);\n\n\t\t\tif (userReaction != userReactionOld)\n\t\t\t{\n\t\t\t\tif (userReactionOld)\n\t\t\t\t{\n\t\t\t\t\tlikeInstance.button.classList.remove(`bx-you-like-button-${userReactionOld}`);\n\t\t\t\t}\n\t\t\t\tlikeInstance.button.classList.add(`bx-you-like-button-${userReaction}`);\n\n\t\t\t\tlikeInstance.likeTimeout = setTimeout(() => {\n\t\t\t\t\tthis.Vote(likeId, 'change', userReaction, userReactionOld);\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t}\n\t\telse if (!active)\n\t\t{\n\t\t\tlikeInstance.buttonText.innerHTML = likeInstance.localize['LIKE_Y'];\n\t\t\tlikeInstance.countText.innerHTML = Number(likeInstance.countText.innerHTML) + 1;\n\t\t\tcontainer.classList.add('bx-you-like');\n\n\t\t\tlikeInstance.button.classList.add('bx-you-like-button');\n\t\t\tlikeInstance.button.classList.add(`bx-you-like-button-${userReaction}`);\n\n\t\t\tlikeInstance.likeTimeout = setTimeout(() => {\n\t\t\t\tif (likeInstance.lastVote !== 'plus')\n\t\t\t\t{\n\t\t\t\t\tthis.Vote(likeId, 'plus', userReaction);\n\t\t\t\t}\n\t\t\t\telse if (userReaction !== likeInstance.lastReaction) // http://jabber.bx/view.php?id=99339\n\t\t\t\t{\n\t\t\t\t\tthis.Vote(likeId, 'change', userReaction, likeInstance.lastReaction);\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t}\n\n\t\tif (likeInstance.version === 2)\n\t\t{\n\t\t\tif (change)\n\t\t\t{\n\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\trating: likeInstance,\n\t\t\t\t\taction: 'change',\n\t\t\t\t\tuserReaction: userReaction,\n\t\t\t\t\tuserReactionOld: userReactionOld,\n\t\t\t\t\ttotalCount: Number(likeInstance.countText.innerHTML),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\trating: likeInstance,\n\t\t\t\t\taction: (active ? 'cancel' : 'add'),\n\t\t\t\t\tuserReaction: userReaction,\n\t\t\t\t\ttotalCount: Number(likeInstance.countText.innerHTML),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t!change\n\t\t\t&& likeInstance.version === 2\n\t\t)\n\t\t{\n\t\t\tconst dataUsers = (\n\t\t\t\tlikeInstance.topUsersDataNode\n\t\t\t\t\t? JSON.parse(likeInstance.topUsersDataNode.getAttribute('data-users'))\n\t\t\t\t\t: false\n\t\t\t);\n\n\t\t\tif (dataUsers)\n\t\t\t{\n\t\t\t\tdataUsers.TOP = Object.values(dataUsers.TOP);\n\n\t\t\t\tlikeInstance.topUsersText.innerHTML = RatingRender.getTopUsersText({\n\t\t\t\t\tyou: !active,\n\t\t\t\t\ttop: dataUsers.TOP,\n\t\t\t\t\tmore: dataUsers.MORE,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tlikeInstance.template === 'light'\n\t\t\t&& !likeInstance.userReactionNode\n\t\t)\n\t\t{\n\t\t\tconst cont = likeInstance.box;\n\t\t\tconst likeNode = cont.cloneNode(true);\n\n\t\t\tlikeNode.id = 'like_anim'; // to not dublicate original id\n\n\t\t\tlet type = 'normal';\n\t\t\tif (cont.closest('.feed-com-informers-bottom'))\n\t\t\t{\n\t\t\t\ttype = 'comment';\n\t\t\t}\n\t\t\telse if (cont.closest('.feed-post-informers'))\n\t\t\t{\n\t\t\t\ttype = 'post';\n\t\t\t}\n\n\t\t\tlikeNode.classList.remove('bx-ilike-button-hover')\n\t\t\tlikeNode.classList.add('bx-like-anim')\n\n\t\t\tDom.adjust(cont.parentNode, { style: { position: 'relative' } });\n\n\t\t\tDom.adjust(likeNode, {\n\t\t\t\tstyle: {\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\ttop: (type === 'post' ? '1px' : (type === 'comment' ? '0' : '')),\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDom.adjust(cont, { style: { visibility: 'hidden' } });\n\t\t\tDom.prepend(likeNode, cont.parentNode);\n\n\t\t\tnew BX.easing({\n\t\t\t\tduration: 140,\n\t\t\t\tstart: { scale: 100 },\n\t\t\t\tfinish: { scale: (type === 'comment' ? 110 : 115) },\n\t\t\t\ttransition : BX.easing.transitions.quad,\n\t\t\t\tstep: (state) => {\n\t\t\t\t\tlikeNode.style.transform = `scale(${state.scale / 100})`;\n\t\t\t\t},\n\t\t\t\tcomplete: () => {\n\t\t\t\t\tconst likeThumbNode = Dom.create('SPAN', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: (active ? 'bx-ilike-icon' : 'bx-ilike-icon bx-ilike-icon-orange'),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.adjust(likeThumbNode, {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tDom.prepend(likeThumbNode, cont.parentNode);\n\n\t\t\t\t\tnew BX.easing({\n\t\t\t\t\t\tduration: 140,\n\t\t\t\t\t\tstart: { scale: (type == 'comment' ? 110 : 115) },\n\t\t\t\t\t\tfinish: { scale: 100 },\n\t\t\t\t\t\ttransition : BX.easing.transitions.quad,\n\t\t\t\t\t\tstep: (state) => {\n\t\t\t\t\t\t\tlikeNode.style.transform = `scale(${state.scale / 100})`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: () => {}\n\t\t\t\t\t}).animate();\n\n\t\t\t\t\tconst propsStart = {\n\t\t\t\t\t\topacity: 100,\n\t\t\t\t\t\tscale: (type === 'comment' ? 110 : 115),\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t};\n\t\t\t\t\tconst propsFinish = {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\tscale: 200,\n\t\t\t\t\t\ttop: (type === 'comment' ? -3 : -2),\n\t\t\t\t\t};\n\n\t\t\t\t\tif (type !== 'comment')\n\t\t\t\t\t{\n\t\t\t\t\t\tpropsStart.left = -5;\n\t\t\t\t\t\tpropsFinish.left = -13;\n\t\t\t\t\t}\n\n\t\t\t\t\tnew BX.easing({\n\t\t\t\t\t\tduration: 200,\n\t\t\t\t\t\tstart: propsStart,\n\t\t\t\t\t\tfinish: propsFinish,\n\t\t\t\t\t\ttransition : BX.easing.transitions.linear,\n\t\t\t\t\t\tstep: (state) => {\n\t\t\t\t\t\t\tlikeThumbNode.style.transform = `scale(${state.scale / 100})`;\n\t\t\t\t\t\t\tlikeThumbNode.style.opacity = state.opacity / 100;\n\t\t\t\t\t\t\tif (type !== 'comment')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlikeThumbNode.style.left = `${state.left}px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlikeThumbNode.style.top = `${state.top}px`;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\t\tlikeNode.parentNode.removeChild(likeNode);\n\t\t\t\t\t\t\tlikeThumbNode.parentNode.removeChild(likeThumbNode);\n\n\t\t\t\t\t\t\tDom.adjust(cont.parentNode, { style: { position: 'static' } });\n\t\t\t\t\t\t\tDom.adjust(cont, { style: { visibility: 'visible' } });\n\t\t\t\t\t\t}\n\t\t\t\t\t}).animate();\n\n\t\t\t\t}\n\t\t\t}).animate();\n\t\t}\n\n\t\tlikeInstance.box.classList.remove('bx-ilike-button-hover');\n\t}\n\n\tstatic Draw(likeId, params)\n\t{\n\t\tconst likeInstance = this.getInstance(likeId);\n\t\tlikeInstance.countText.innerHTML = Number(params.TOTAL_POSITIVE_VOTES);\n\n\t\tif (\n\t\t\t!Type.isUndefined(params.TYPE)\n\t\t\t&& !Type.isUndefined(params.USER_ID)\n\t\t\t&& Number(params.USER_ID) > 0\n\t\t\t&& !Type.isUndefined(params.USER_DATA)\n\t\t\t&& !Type.isUndefined(params.USER_DATA.WEIGHT)\n\t\t)\n\t\t{\n\t\t\tconst userWeight = parseFloat(params.USER_DATA.WEIGHT);\n\n\t\t\tconst usersData = (\n\t\t\t\tlikeInstance.topUsersDataNode\n\t\t\t\t\t? JSON.parse(likeInstance.topUsersDataNode.getAttribute('data-users'))\n\t\t\t\t\t: false\n\t\t\t);\n\n\t\t\tif (\n\t\t\t\tparams.TYPE != 'CHANGE'\n\t\t\t\t&& Type.isPlainObject(usersData)\n\t\t\t)\n\t\t\t{\n\t\t\t\tusersData.TOP = Object.values(usersData.TOP);\n\t\t\t\tlet recalcNeeded = (usersData.TOP.length < 2);\n\n\t\t\t\tObject.values(usersData.TOP).forEach((item) => {\n\t\t\t\t\tif (recalcNeeded)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tparams.TYPE === 'ADD'\n\t\t\t\t\t\t\t&& userWeight > item.WEIGHT\n\t\t\t\t\t\t)\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tparams.TYPE === 'CANCEL'\n\t\t\t\t\t\t\t&& params.USER_ID === item.ID\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\trecalcNeeded = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t\t\tif (recalcNeeded)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tparams.TYPE === 'ADD'\n\t\t\t\t\t\t&& Number(params.USER_ID) !== Number(Loc.getMessage('USER_ID'))\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!usersData.TOP.find((a) => {\n\t\t\t\t\t\t\treturn Number(a.ID) === Number(params.USER_ID)\n\t\t\t\t\t\t}))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tusersData.TOP.push({\n\t\t\t\t\t\t\t\tID: Number(params.USER_ID),\n\t\t\t\t\t\t\t\tNAME_FORMATTED: params.USER_DATA.NAME_FORMATTED,\n\t\t\t\t\t\t\t\tWEIGHT: parseFloat(params.USER_DATA.WEIGHT),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.TYPE === 'CANCEL')\n\t\t\t\t\t{\n\t\t\t\t\t\tusersData.TOP = usersData.TOP.filter((a) => {\n\t\t\t\t\t\t\treturn Number(a.ID) !== Number(params.USER_ID);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tusersData.TOP.sort((a, b) => {\n\t\t\t\t\t\tif (parseFloat(a.WEIGHT) === parseFloat(b.WEIGHT))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn (parseFloat(a.WEIGHT) > parseFloat(b.WEIGHT)) ? -1 : 1;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tusersData.TOP.length > 2\n\t\t\t\t\t\t&& params.TYPE === 'ADD'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tusersData.TOP.pop();\n\t\t\t\t\t\tusersData.MORE++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (params.TYPE === 'ADD')\n\t\t\t\t\t{\n\t\t\t\t\t\tusersData.MORE = (\n\t\t\t\t\t\t\t!Type.isUndefined(usersData.MORE)\n\t\t\t\t\t\t\t\t? Number(usersData.MORE) + 1\n\t\t\t\t\t\t\t\t: 1\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\telse if (params.TYPE === 'CANCEL')\n\t\t\t\t\t{\n\t\t\t\t\t\tusersData.MORE = (\n\t\t\t\t\t\t\t!Type.isUndefined(usersData.MORE)\n\t\t\t\t\t\t\t&& Number(usersData.MORE) > 0\n\t\t\t\t\t\t\t\t? Number(usersData.MORE) - 1\n\t\t\t\t\t\t\t\t: 0\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlikeInstance.topUsersDataNode.setAttribute('data-users', JSON.stringify(usersData));\n\n\t\t\t\tif (likeInstance.topUsersText)\n\t\t\t\t{\n\t\t\t\t\tlikeInstance.topUsersText.innerHTML = RatingRender.getTopUsersText({\n\t\t\t\t\t\tyou: (\n\t\t\t\t\t\t\tNumber(params.USER_ID) === Number(Loc.getMessage('USER_ID'))\n\t\t\t\t\t\t\t\t? params.TYPE !== 'CANCEL'\n\t\t\t\t\t\t\t\t: likeInstance.count.classList.contains('bx-you-like')\n\t\t\t\t\t\t),\n\t\t\t\t\t\ttop: usersData.TOP,\n\t\t\t\t\t\tmore: usersData.MORE,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tType.isStringFilled(params.REACTION)\n\t\t\t\t&& Type.isStringFilled(params.REACTION_OLD)\n\t\t\t\t&& params.TYPE === 'CHANGE'\n\t\t\t)\n\t\t\t{\n\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\trating: likeInstance,\n\t\t\t\t\taction: 'change',\n\t\t\t\t\tuserReaction: params.REACTION,\n\t\t\t\t\tuserReactionOld: params.REACTION_OLD,\n\t\t\t\t\ttotalCount: params.TOTAL_POSITIVE_VOTES,\n\t\t\t\t\tuserId: params.USER_ID,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tType.isStringFilled(params.REACTION)\n\t\t\t\t&& [ 'ADD', 'CANCEL' ].includes(params.TYPE)\n\t\t\t)\n\t\t\t{\n\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\trating: likeInstance,\n\t\t\t\t\tuserReaction: params.REACTION,\n\t\t\t\t\taction: (params.TYPE === 'ADD' ? 'add' : 'cancel'),\n\t\t\t\t\ttotalCount: params.TOTAL_POSITIVE_VOTES,\n\t\t\t\t\tuserId: params.USER_ID,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (likeInstance.topPanel)\n\t\t{\n\t\t\tlikeInstance.topPanel.setAttribute('data-popup', 'N');\n\t\t}\n\n\t\tif (!likeInstance.userReactionNode)\n\t\t{\n\t\t\tlikeInstance.count.insertBefore(\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-ilike-plus-one',\n\t\t\t\t\t},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth: `${(element.countText.clientWidth - 8)}px`,\n\t\t\t\t\t\theight: `${(element.countText.clientHeight - 8)}px`,\n\t\t\t\t\t},\n\t\t\t\t\thtml: (params.TYPE === 'ADD'? '+1': '-1'),\n\t\t\t\t}),\n\t\t\t\telement.count.firstChild\n\t\t\t);\n\t\t}\n\n\t\tif (likeInstance.popup)\n\t\t{\n\t\t\tlikeInstance.popup.close();\n\t\t\tlikeInstance.popupContentPage = 1;\n\t\t}\n\t}\n\n\tstatic Vote(likeId, voteAction, voteReaction, voteReactionOld)\n\t{\n\t\tif (!Type.isStringFilled(voteReaction))\n\t\t{\n\t\t\tvoteReaction = 'like';\n\t\t}\n\n\t\tconst ajaxInstance = (RatingManager.mobile ? new MobileAjaxWrapper : ajax);\n\t\tconst likeInstance = this.getInstance(likeId);\n\n\t\tconst successCallback = (response) => {\n\n\t\t\tconst data = response.data;\n\n\t\t\tlikeInstance.lastVote = data.action;\n\t\t\tlikeInstance.lastReaction = voteReaction;\n\n\t\t\tconst key = `${likeInstance.entityTypeId}_${likeInstance.entityId}`;\n\n\t\t\tthis.lastVoteRepo.set(key, data.action);\n\t\t\tthis.lastReactionRepo.set(key, data.voteReaction);\n\n\t\t\tlikeInstance.countText.innerHTML = data.items_all;\n\t\t\tlikeInstance.popupContentPage = 1;\n\t\t\tlikeInstance.popupContent.innerHTML = '';\n\t\t\tlikeInstance.popupContent.appendChild(Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-ilike-wait',\n\t\t\t\t},\n\t\t\t}));\n\n\t\t\tif (likeInstance.topPanel)\n\t\t\t{\n\t\t\t\tlikeInstance.topPanel.setAttribute('data-popup', 'N');\n\t\t\t}\n\n\t\t\tListPopup.AdjustWindow(likeId);\n\n\t\t\tconst popup = document.getElementById(`ilike-popup-${likeId}`)\n\t\t\tif (\n\t\t\t\tpopup\n\t\t\t\t&& popup.style.display === 'block'\n\t\t\t)\n\t\t\t{\n\t\t\t\tListPopup.List(likeId, null, '', true);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tlikeInstance.version >= 2\n\t\t\t\t&& RatingManager.mobile\n\t\t\t)\n\t\t\t{\n\t\t\t\tBXMobileApp.onCustomEvent('onRatingLike', {\n\t\t\t\t\taction: data.action,\n\t\t\t\t\tratingId: likeId,\n\t\t\t\t\tentityTypeId : likeInstance.entityTypeId,\n\t\t\t\t\tentityId: likeInstance.entityId,\n\t\t\t\t\tvoteAction: voteAction,\n\t\t\t\t\tvoteReaction: voteReaction,\n\t\t\t\t\tvoteReactionOld: voteReactionOld,\n\t\t\t\t\tuserId: Loc.getMessage('USER_ID'),\n\t\t\t\t\tuserData: (!Type.isUndefined(data.user_data) ? data.user_data : null),\n\t\t\t\t\titemsAll: data.items_all,\n\t\t\t\t}, true);\n\t\t\t}\n\t\t};\n\n\t\tconst failureCallback = () => {\n\n\t\t\tconst dataUsers = ((likeInstance.topUsersDataNode)\n\t\t\t\t? JSON.parse(likeInstance.topUsersDataNode.getAttribute('data-users'))\n\t\t\t\t: false\n\t\t\t);\n\n\t\t\tif (likeInstance.version == 2)\n\t\t\t{\n\t\t\t\tif (voteAction === 'change')\n\t\t\t\t{\n\t\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\t\trating: likeInstance,\n\t\t\t\t\t\taction: voteAction,\n\t\t\t\t\t\tuserReaction: voteReaction,\n\t\t\t\t\t\tuserReactionOld: voteReactionOld,\n\t\t\t\t\t\ttotalCount: Number(likeInstance.countText.innerHTML),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tRatingRender.setReaction({\n\t\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\t\trating: likeInstance,\n\t\t\t\t\t\taction: (voteAction === 'cancel' ? 'add' : 'cancel'),\n\t\t\t\t\t\tuserReaction: voteReaction,\n\t\t\t\t\t\ttotalCount: (\n\t\t\t\t\t\t\tvoteAction == 'cancel'\n\t\t\t\t\t\t\t\t? Number(likeInstance.countText.innerHTML) + 1\n\t\t\t\t\t\t\t\t: Number(likeInstance.countText.innerHTML) - 1\n\t\t\t\t\t\t)\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (likeInstance.buttonText)\n\t\t\t\t{\n\t\t\t\t\tif (voteAction === 'add')\n\t\t\t\t\t{\n\t\t\t\t\t\tlikeInstance.buttonText.innerHTML = Loc.getMessage('RATING_LIKE_EMOTION_LIKE_CALC');\n\t\t\t\t\t}\n\t\t\t\t\telse if (voteAction === 'change')\n\t\t\t\t\t{\n\t\t\t\t\t\tlikeInstance.buttonText.innerHTML = Loc.getMessage(`RATING_LIKE_EMOTION_${voteReactionOld.toUpperCase()}_CALC`);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tlikeInstance.buttonText.innerHTML = Loc.getMessage(`RATING_LIKE_EMOTION_${voteReaction.toUpperCase()}_CALC`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tdataUsers\n\t\t\t\t&& voteAction !== 'change'\n\t\t\t\t&& likeInstance.version == 2\n\t\t\t)\n\t\t\t{\n\t\t\t\tlikeInstance.topUsersText.innerHTML = RatingRender.getTopUsersText({\n\t\t\t\t\tyou: (voteAction === 'cancel'), // negative\n\t\t\t\t\ttop: Object.values(dataUsers.TOP),\n\t\t\t\t\tmore: dataUsers.MORE\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tconst analyticsLabel ={\n\t\t\tb24statAction: 'addLike',\n\t\t}\n\n\t\tif (\n\t\t\tlikeInstance.version >= 2\n\t\t\t&& RatingManager.mobile\n\t\t)\n\t\t{\n\t\t\tanalyticsLabel.b24statContext = 'mobile';\n\t\t}\n\n\t\tajaxInstance.runAction('main.rating.vote', {\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tRATING_VOTE_TYPE_ID: likeInstance.entityTypeId,\n\t\t\t\t\tRATING_VOTE_ENTITY_ID: likeInstance.entityId,\n\t\t\t\t\tRATING_VOTE_ACTION: voteAction,\n\t\t\t\t\tRATING_VOTE_REACTION: voteReaction,\n\t\t\t\t},\n\t\t\t},\n\t\t\tanalyticsLabel: analyticsLabel,\n\t\t}).then(\n\t\t\tsuccessCallback,\n\t\t\tfailureCallback\n\t\t);\n\n\t\treturn false;\n\t}\n\n\tstatic LiveUpdate(params)\n\t{\n\t\tif (Number(params.USER_ID) === Number(Loc.getMessage('USER_ID')))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.repo.forEach((likeInstance, likeId) => {\n\t\t\tif (\n\t\t\t\tlikeInstance.entityTypeId !== params.ENTITY_TYPE_ID\n\t\t\t\t|| Number(likeInstance.entityId) !== Number(params.ENTITY_ID)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.Draw(likeId, params);\n\t\t});\n\n\n\t\tRatingManager.live(params);\n\t}\n\n\tstatic Set(likeId, entityTypeId, entityId, available, userId, localize, template, pathToUserProfile, pathToAjax, mobile)\n\t{\n\t\tmobile = !!mobile;\n\n\t\tif (template === undefined)\n\t\t{\n\t\t\ttemplate = 'standart';\n\t\t}\n\n\t\tif (this.additionalParams.get('pathToUserProfile'))\n\t\t{\n\t\t\tpathToUserProfile = this.additionalParams.get('pathToUserProfile');\n\t\t}\n\n\t\tlet likeInstance = this.getInstance(likeId);\n\n\t\tif (likeInstance && likeInstance.tryToSet > 5)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tryToSend = likeInstance && likeInstance.tryToSet ? likeInstance.tryToSet : 1;\n\n\t\tlikeInstance = new RatingLike(likeId, entityTypeId, entityId, available, userId, localize, template, pathToUserProfile);\n\t\tthis.setInstance(\n\t\t\tlikeId,\n\t\t\tlikeInstance\n\t\t);\n\n\t\tif (likeInstance.enabled)\n\t\t{\n\t\t\tthis.Init(likeId, {\n\t\t\t\tmobile: mobile,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tlikeInstance.tryToSet = tryToSend + 1;\n\t\t\t\tthis.Set(likeId, entityTypeId, entityId, available, userId, localize, template, pathToUserProfile, pathToAjax, mobile);\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\tstatic setParams(params)\n\t{\n\t\tif (!Type.isUndefined(params.pathToUserProfile))\n\t\t{\n\t\t\tthis.additionalParams.set('pathToUserProfile', params.pathToUserProfile);\n\t\t}\n\t}\n\n\tstatic Init(likeId, params)\n\t{\n\t\tparams = (!Type.isUndefined(params) ? params : {});\n\n\t\tRatingManager.init(params);\n\n\t\tconst likeInstance = this.getInstance(likeId);\n\n\t\t// like/unlike button\n\t\tif (likeInstance.available)\n\t\t{\n\t\t\tlet eventNode = (\n\t\t\t\tlikeInstance.template === 'standart'\n\t\t\t\t\t? likeInstance.button\n\t\t\t\t\t: likeInstance.buttonText\n\t\t\t);\n\n\t\t\tif (!RatingManager.mobile)\n\t\t\t{\n\t\t\t\tconst eventNodeNew = eventNode.closest('.feed-new-like');\n\t\t\t\tif (eventNodeNew)\n\t\t\t\t{\n\t\t\t\t\teventNode = eventNodeNew;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tlikeInstance.version >= 2\n\t\t\t\t&& RatingManager.mobile\n\t\t\t)\n\t\t\t{\n\t\t\t\teventNode.removeEventListener('touchstart', this.mobileTouchStartHandler);\n\t\t\t\teventNode.addEventListener('touchstart', this.mobileTouchStartHandler);\n\t\t\t}\n\n\t\t\tconst eventName = (RatingManager.mobile ? 'touchend' : 'click');\n\t\t\teventNode.removeEventListener(eventName, this.buttonClickHandler);\n\t\t\teventNode.addEventListener(eventName, this.buttonClickHandler);\n\n\t\t\tif (!RatingManager.mobile)\n\t\t\t{\n\t\t\t\t// Hover/unHover like-button\n\t\t\t\tlikeInstance.box.addEventListener('mouseover', () => {\n\t\t\t\t\tlikeInstance.box.classList.add('bx-ilike-button-hover');\n\t\t\t\t});\n\t\t\t\tlikeInstance.box.addEventListener('mouseout', () => {\n\t\t\t\t\tlikeInstance.box.classList.remove('bx-ilike-button-hover');\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlikeInstance.topPanel.removeEventListener('click', this.mobileTopPanelClickHandler);\n\t\t\t\tlikeInstance.topPanel.addEventListener('click', this.mobileTopPanelClickHandler);\n\t\t\t}\n\t\t}\n\t\telse if (Type.isDomNode(likeInstance.buttonText))\n\t\t{\n\t\t\tlikeInstance.buttonText.innerHTML = likeInstance.localize['LIKE_D'];\n\t\t\tlikeInstance.buttonText.classList.add('bx-ilike-text-unavailable');\n\t\t}\n\t\t// get like-user-list\n\t\tconst clickShowPopupNode = (likeInstance.topUsersText ? likeInstance.topUsersText : likeInstance.count);\n\n\t\tif (!RatingManager.mobile)\n\t\t{\n\t\t\tclickShowPopupNode.addEventListener('mouseenter', (e) => {\n\t\t\t\tListPopup.onResultMouseEnter({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\tevent: e,\n\t\t\t\t\tnodeId: e.currentTarget.id,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tclickShowPopupNode.addEventListener('mouseleave', (e) => {\n\t\t\t\tListPopup.onResultMouseLeave({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t});\n\t\t\t})\n\n\t\t\tclickShowPopupNode.addEventListener('click', (e) => {\n\t\t\t\tListPopup.onResultClick({\n\t\t\t\t\tlikeId: likeId,\n\t\t\t\t\tevent: e,\n\t\t\t\t\tnodeId: e.currentTarget.id,\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\n\t\tif (\n\t\t\tlikeInstance.version === 2\n\t\t\t&& likeInstance.available\n\t\t\t&& likeInstance.userReactionNode\n\t\t)\n\t\t{\n\t\t\tRatingRender.bindReactionsPopup({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic mobileTouchStartHandler()\n\t{\n\t\tRatingManager.startScrollTop = (\n\t\t\t(\n\t\t\t\tdocument.documentElement\n\t\t\t\t&& document.documentElement.scrollTop\n\t\t\t)\n\t\t\t|| document.body.scrollTop\n\t\t);\n\t}\n\n\tstatic buttonClickHandler(e)\n\t{\n\t\tconst likeInstanceNode = e.currentTarget.closest('[data-rating-vote-id]');\n\t\tif (!Type.isDomNode(likeInstanceNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst likeId = likeInstanceNode.getAttribute('data-rating-vote-id');\n\t\tif (!Type.isStringFilled(likeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tif (\n\t\t\tlikeInstance.version >= 2\n\t\t\t&& RatingManager.mobile\n\t\t\t&& RatingRender.blockTouchEndByScroll\n\t\t)\n\t\t{\n\t\t\tRatingRender.blockTouchEndByScroll = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tlikeInstance.version < 2\n\t\t\t|| !RatingManager.mobile\n\t\t\t|| !RatingRender.reactionsPopupLikeId\n\t\t)\n\t\t{\n\t\t\tif (\n\t\t\t\tlikeInstance.version >= 2\n\t\t\t\t&& RatingManager.mobile\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst currentScrollTop = (\n\t\t\t\t\t(\n\t\t\t\t\t\tdocument.documentElement\n\t\t\t\t\t\t&& document.documentElement.scrollTop\n\t\t\t\t\t)\n\t\t\t\t\t|| document.body.scrollTop\n\t\t\t\t);\n\n\t\t\t\tif (Math.abs(currentScrollTop - RatingManager.startScrollTop) > 2)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tRatingLike.ClickVote(e, likeId);\n\t\t}\n\n\t\tif (likeInstance.version == 2)\n\t\t{\n\t\t\tRatingRender.afterClick({\n\t\t\t\tlikeId: likeId,\n\t\t\t});\n\t\t}\n\n\t\te.preventDefault();\n\t}\n\n\tstatic mobileTopPanelClickHandler(e)\n\t{\n\t\tconst likeInstanceNode = e.currentTarget.querySelector('[data-like-id]');\n\t\tif (!Type.isDomNode(likeInstanceNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst likeId = likeInstanceNode.getAttribute('data-like-id');\n\t\tif (!Type.isStringFilled(likeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst likeInstance = RatingLike.getInstance(likeId);\n\n\t\tRatingRender.openMobileReactionsPage({\n\t\t\tentityTypeId: likeInstance.entityTypeId,\n\t\t\tentityId: likeInstance.entityId,\n\t\t});\n\t\te.stopPropagation();\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { RatingLike } from './like.js';\nimport { RatingManager } from './manager.js';\nimport { RatingRender } from './render.js';\n\nimport likeAnimatedEmojiData from '../animations/em_01.json';\nimport laughAnimatedEmojiData from '../animations/em_02.json';\nimport wonderAnimatedEmojiData from '../animations/em_03.json';\nimport cryAnimatedEmojiData from '../animations/em_04.json';\nimport angryAnimatedEmojiData from '../animations/em_05.json';\nimport facepalmAnimatedEmojiData from '../animations/em_06.json';\nimport admireAnimatedEmojiData from '../animations/em_07.json';\n\nexport const lottieAnimations = Object.freeze({\n\tlike: likeAnimatedEmojiData,\n\tlaugh: laughAnimatedEmojiData,\n\twonder: wonderAnimatedEmojiData,\n\tcry: cryAnimatedEmojiData,\n\tangry: angryAnimatedEmojiData,\n\tfacepalm: facepalmAnimatedEmojiData,\n\tadmire: admireAnimatedEmojiData,\n});\n\n\nif (Type.isUndefined(window.BXRL))\n{\n\twindow.BXRL = {};\n}\nwindow.BXRL.manager = RatingManager;\nwindow.BXRL.render = RatingRender;\n\nwindow.RatingLike = RatingLike;\n"],"names":["ListPopup","params","likeId","likeInstance","RatingLike","getInstance","target","reaction","nodeId","popupLikeId","popupContentPage","List","popupTimeoutIdShow","setTimeout","getListPopupShow","resultPopupAnimation","getListPopupAnimation","mouseInShowPopupNode","OpenWindow","clickEvent","targetId","Number","countText","innerHTML","bindNode","template","count","version","Type","isDomNode","isStringFilled","document","getElementById","box","popup","globalZIndex","getGlobalIndex","popupClassNameList","topPanel","push","RatingManager","mobile","Popup","id","bindElement","lightShadow","offsetTop","offsetLeft","isUndefined","isNull","offsetX","autoHide","closeByEsc","zIndexAbsolute","bindOptions","position","animation","events","onPopupClose","onPopupDestroy","content","className","join","setAngle","addEventListener","clearTimeout","popupTimeout","close","setBindElement","popupLikeInstance","show","AdjustWindow","element","index","propertyValue","Dom","style","isNaN","parseInt","offsetParent","tagName","EventEmitter","unsubscribe","BX","SidePanel","Instance","getTopSlider","getWindow","removeOnCloseHandler","forceBindPosition","adjustPosition","contentContainerNodeList","popupContent","querySelectorAll","length","forEach","contentContainerNode","e","scrollTop","scrollHeight","offsetHeight","RatingRender","popupCurrentReaction","Event","unbindAll","page","clear","popupPagesList","clearPopupContent","listXHR","abort","ajax","runAction","data","RATING_VOTE_TYPE_ID","entityTypeId","RATING_VOTE_ENTITY_ID","entityId","RATING_VOTE_LIST_PAGE","RATING_VOTE_REACTION","PATH_TO_USER_PROFILE","pathToUserProfile","onrequeststart","xhr","then","result","onListSuccess","items_all","items_page","list_page","buildPopupContent","rating","setAttribute","buildPopupContentNoReactions","PopupScroll","event","isShown","popupTimeoutIdList","getAttribute","currentTarget","mouseEnterEvent","getListPopup","removeOnClose","bind","currentUserId","Loc","getMessage","you","topList","top","isArray","more","ID","NAME_FORMATTED","WEIGHT","replace","sort","a","b","parseFloat","userNameList","map","item","userNameBegin","userNameEnd","pop","slice","i","userReactionNode","action","includes","userReaction","userReactionOld","totalCount","userId","getNode","reactionsNode","topPanelContainer","topUsersText","buttonText","elements","elementsNew","classList","add","contains","remove","reactionsContainer","querySelector","found","newValue","reactionValue","reactionCount","animate","type","clean","commentNode","closest","drawReactions","container","toUpperCase","parentElement","toLowerCase","reactionEvents","click","resultReactionClick","mouseenter","resultReactionMouseEnter","mouseleave","resultReactionMouseLeave","reactionsData","emojiContainer","create","props","attrs","title","Lottie","loadAnimation","animationData","reactionsAnimationData","loop","autoplay","renderer","rendererSettings","viewBoxOnly","Boolean","play","appendChild","JSON","stringify","reactionsPopupLikeId","reactionsPopup","reactionsNodesList","reactionsList","currentEmotion","emojiItem","children","reactionNode","ClickVote","preventDefault","append","body","reactionsPopupMouseOutHandler","getReactionsPopupMouseOutHandler","bindElementPosition","pos","left","inverted","GetWindowSize","deltaY","touchMoveDeltaY","adjust","width","borderRadius","reactionsPopupMobileDisableScroll","reactionsPopupAnimation","easing","duration","start","opacity","finish","transition","makeEaseInOut","transitions","cubic","step","state","reactionsPopupOpacityState","complete","reactions","reactionsPopupAnimation2","touchScrollTop","hasMobileTouchMoved","window","reactionsPopupMobileTouchEndHandler","reactionsPopupMobileTouchMoveHandler","coords","x","changedTouches","pageX","y","pageY","reactionsPopupMobileGetHoverNode","reactionsPopupMobileHideHandler","removeEventListener","touchStartPosition","touches","touchCurrentPosition","reactionsPopupMobileCheckTouchMove","currentReactionNodeHover","reactionsPopupMobileRemoveHover","reactionsPopupMobileAddHover","blockShowPopupTimeout","blockShowPopup","reactionsPopupMobileEnableScroll","stop","reactionsPopupAnimation4","linear","bindReactionsPopup","Math","abs","hideReactionsPopup","nodeAboveFinger","elementFromPoint","nodeBelowFinger","iconNodeAboveFinger","iconNodeBelowFinger","touchMoveScrollListener","passive","emit","mobileOverlay","app","exec","mouseOverHandler","Runtime","debounce","getMouseOverHandler","blockReactionsPopup","popupPosition","getBoundingClientRect","clientX","right","clientY","bottom","afterClickBlockShowPopup","showReactionsPopup","requestReaction","reactionsCount","popupSizeInitialized","height","minWidth","isPlainObject","Object","entries","tabsNode","headClassList","html","changePopupTab","sample","like","kiss","laugh","wonder","cry","angry","facepalm","reactionData","headItemClassList","popupContentPosition","usersNode","usersNodeExists","contentNode","reactionUsersNode","items","userItemClassList","USER_TYPE","href","URL","PHOTO_SRC","FULL_NAME","waitNode","tabsNodeOld","parentNode","insertBefore","removeChild","tabNode","reactionTabNode","avatarNode","src","imgClassList","afterClickHandler","getAfterClickHandler","isSet","onResultClick","stopPropagation","onResultMouseEnter","onResultMouseLeave","BXMobileApp","PageManager","loadPageBlank","url","backdrop","mediumPositionPercent","cache","eventData","repo","voteAction","button","Draw","TYPE","USER_ID","ENTITY_TYPE_ID","ENTITY_ID","USER_DATA","userData","REACTION","voteReaction","REACTION_OLD","voteReactionOld","TOTAL_POSITIVE_VOTES","itemsAll","ratingEmojiSelectorPopup","node","likeAnimatedEmojiData","kissAnimatedEmojiData","laughAnimatedEmojiData","wonderAnimatedEmojiData","cryAnimatedEmojiData","angryAnimatedEmojiData","facepalmAnimatedEmojiData","reactionsPopupMobileTouchEnd","reactionsPopupMobileTouchMove","reactionsPopupMobileHide","initialized","setDisplayHeight","throttle","getInViewScope","subscribe","onMobileCommentsGet","addCustomEvent","onRatingLike","command","LiveUpdate","getCompatData","displayHeight","documentElement","clientHeight","ratingNode","delayedList","value","key","isNodeVisibleOnScreen","fireAnimation","ratingNodeList","set","get","visibleAreaTop","visibleAreaBottom","ratingObject","entityList","addNode","checkEntity","addDelayed","liveParams","delayedListItem","Map","available","localize","isObject","arguments","enabled","topUsersDataNode","popupId","likeTimeout","parse","lastVoteRepo","lastVote","lastReactionRepo","lastReaction","addEntity","BXRL","forceAdd","active","change","getUserReaction","Vote","setReaction","dataUsers","TOP","values","getTopUsersText","MORE","cont","likeNode","cloneNode","whiteSpace","visibility","prepend","scale","quad","transform","likeThumbNode","propsStart","propsFinish","userWeight","usersData","recalcNeeded","find","filter","clientWidth","firstChild","ajaxInstance","MobileAjaxWrapper","successCallback","response","display","onCustomEvent","ratingId","user_data","failureCallback","analyticsLabel","b24statAction","b24statContext","RATING_VOTE_ACTION","live","pathToAjax","undefined","additionalParams","tryToSet","tryToSend","setInstance","Init","Set","init","eventNode","eventNodeNew","mobileTouchStartHandler","eventName","buttonClickHandler","mobileTopPanelClickHandler","clickShowPopupNode","startScrollTop","likeInstanceNode","blockTouchEndByScroll","currentScrollTop","afterClick","openMobileReactionsPage","lottieAnimations","freeze","admire","admireAnimatedEmojiData","manager","render"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}