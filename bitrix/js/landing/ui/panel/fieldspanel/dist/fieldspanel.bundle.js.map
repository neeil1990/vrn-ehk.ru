{"version":3,"file":"fieldspanel.bundle.js","sources":["../src/fieldspanel.js"],"sourcesContent":["import {Cache, Dom, Tag, Type} from 'main.core';\nimport {Content} from 'landing.ui.panel.content';\nimport {Loader} from 'main.loader';\nimport {Backend} from 'landing.backend';\nimport {PageObject} from 'landing.pageobject';\nimport {SidebarButton} from 'landing.ui.button.sidebarbutton';\nimport {Loc} from 'landing.loc';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {BaseButton} from 'landing.ui.button.basebutton';\nimport {Text} from 'landing.ui.field.textfield';\nimport {FormSettingsPanel} from 'landing.ui.panel.formsettingspanel';\nimport {FormClient} from 'crm.form.client';\nimport {ZIndexManager} from 'main.core.z-index-manager';\nimport 'ui.userfieldfactory';\nimport 'landing.master';\n\nimport 'ui.fonts.opensans';\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldsList = {\n\t[categoryId: string]: {\n\t\tCAPTION: string,\n\t\tFIELDS: Array<CrmField>\n\t},\n};\n\n/**\n * @memberOf BX.Landing.UI.Panel\n */\nexport class FieldsPanel extends Content\n{\n\tstatic staticCache = new Cache.MemoryCache();\n\n\tstatic isEditorContext(): boolean\n\t{\n\t\treturn FieldsPanel.staticCache.remember('isEditorContext', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst viewContainer = rootWindow.document.body.querySelector('.landing-ui-view');\n\t\t\treturn Type.isDomNode(viewContainer);\n\t\t});\n\t}\n\n\tstatic getRootWindow(): Window\n\t{\n\t\treturn FieldsPanel.staticCache.remember('rootWindow', () => {\n\t\t\tif (FieldsPanel.isEditorContext())\n\t\t\t{\n\t\t\t\treturn PageObject.getRootWindow();\n\t\t\t}\n\n\t\t\treturn window;\n\t\t});\n\t}\n\n\tstatic getInstance(options): FieldsPanel\n\t{\n\t\tconst rootWindow = FieldsPanel.getRootWindow();\n\t\tconst rootWindowPanel = rootWindow.BX.Landing.UI.Panel.FieldsPanel;\n\t\tif (!rootWindowPanel.instance && !FieldsPanel.instance)\n\t\t{\n\t\t\trootWindowPanel.instance = new FieldsPanel(options);\n\t\t}\n\n\t\tconst instance = (rootWindowPanel.instance || FieldsPanel.instance);\n\t\tinstance.options = options;\n\n\t\treturn instance;\n\t}\n\n\tadjustActionsPanels = false;\n\n\tconstructor(options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FieldsPanel');\n\t\tthis.setLayoutClass('landing-ui-panel-fields');\n\t\tthis.setOverlayClass('landing-ui-panel-fields-overlay');\n\t\tthis.setTitle(Loc.getMessage('LANDING_FIELDS_PANEL_TITLE'));\n\n\t\tthis.onSaveClick = this.onSaveClick.bind(this);\n\t\tthis.onCancelClick = this.onCancelClick.bind(this);\n\n\t\tthis.options = options;\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tDom.append(this.layout, this.getViewContainer());\n\t\tDom.append(this.overlay, this.getViewContainer());\n\t\tDom.insertAfter(this.getSearchContainer(), this.header);\n\t\tDom.append(this.getCreateFieldLayout(), this.body);\n\n\t\tthis.appendFooterButton(\n\t\t\tnew BaseButton('save_settings', {\n\t\t\t\ttext: Loc.getMessage('LANDING_FIELDS_PANEL_ADD_SELECTED_BUTTON'),\n\t\t\t\tonClick: this.onSaveClick,\n\t\t\t\tclassName: 'landing-ui-button-content-save',\n\t\t\t\tattrs: {title: Loc.getMessage('LANDING_TITLE_OF_SLIDER_SAVE')},\n\t\t\t}),\n\t\t);\n\n\t\tthis.appendFooterButton(\n\t\t\tnew BaseButton('cancel_settings', {\n\t\t\t\ttext: Loc.getMessage('BLOCK_CANCEL'),\n\t\t\t\tonClick: this.onCancelClick,\n\t\t\t\tclassName: 'landing-ui-button-content-cancel',\n\t\t\t\tattrs: {title: Loc.getMessage('LANDING_TITLE_OF_SLIDER_CANCEL')},\n\t\t\t}),\n\t\t);\n\t}\n\n\tisMultiple(): boolean\n\t{\n\t\treturn this.cache.get('multiple', true);\n\t}\n\n\tsetMultiple(mode: boolean)\n\t{\n\t\tthis.cache.set('multiple', mode);\n\t}\n\n\tsetAllowedTypes(types: Array<string>)\n\t{\n\t\tthis.cache.set('allowedTypes', types);\n\t}\n\n\tgetAllowedTypes(): Array<string>\n\t{\n\t\treturn this.cache.get('allowedTypes', []);\n\t}\n\n\tsetDisabledFields(fields: Array<string>)\n\t{\n\t\tthis.cache.set('disabledFields', fields);\n\t}\n\n\tgetDisabledFields(): Array<string>\n\t{\n\t\treturn this.cache.get('disabledFields', []);\n\t}\n\n\tsetAllowedCategories(categories: Array<string>)\n\t{\n\t\tthis.cache.set('allowedCategories', categories);\n\t}\n\n\tgetAllowedCategories(): Array<string>\n\t{\n\t\treturn this.cache.get('allowedCategories', []);\n\t}\n\n\tsetDisabledCategories(categories: Array<string>)\n\t{\n\t\tthis.cache.set('disabledCategories', categories);\n\t}\n\n\tgetDisabledCategories(): Array<string>\n\t{\n\t\treturn this.cache.get('disabledCategories', []);\n\t}\n\n\tresetFactoriesCache()\n\t{\n\t\tthis.cache.keys().forEach((key) => {\n\t\t\tif (key.startsWith('userFieldFactory_'))\n\t\t\t{\n\t\t\t\tthis.cache.delete(key);\n\t\t\t}\n\t\t});\n\t}\n\n\t#setShowLock(value: boolean)\n\t{\n\t\tthis.cache.set('showLock', value);\n\t}\n\n\t#getShowLock(): boolean\n\t{\n\t\treturn this.cache.get('showLock', false);\n\t}\n\n\tshow(options = {}): Promise<any>\n\t{\n\t\tif (this.#getShowLock())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#setShowLock(true);\n\n\t\tthis.getSearchField().input.textContent = '';\n\n\t\tthis.setMultiple(true);\n\t\tthis.setAllowedTypes([]);\n\t\tthis.setDisabledFields([]);\n\t\tthis.setAllowedCategories([]);\n\t\tthis.setDisabledCategories([]);\n\t\tthis.resetFactoriesCache();\n\n\t\tif (Type.isArrayFilled(options.disabledFields))\n\t\t{\n\t\t\tthis.setDisabledFields(options.disabledFields);\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.allowedCategories))\n\t\t{\n\t\t\tthis.setAllowedCategories(options.allowedCategories);\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.disabledCategories))\n\t\t{\n\t\t\tthis.setDisabledCategories(options.disabledCategories);\n\t\t}\n\n\t\tif (Type.isArrayFilled(options.allowedTypes))\n\t\t{\n\t\t\tthis.setAllowedTypes(options.allowedTypes);\n\t\t}\n\n\t\tif (Type.isBoolean(options.multiple))\n\t\t{\n\t\t\tthis.setMultiple(options.multiple);\n\t\t}\n\n\t\tDom.style(this.layout, 'position', options.position ?? null);\n\n\t\tconst allowedLoadOptions = ['hideVirtual', 'hideRequisites', 'hideSmartDocument', 'hideDocument'];\n\t\tconst loadOptions = Object.entries(options).reduce((acc, [key, value]) => {\n\t\t\tif (allowedLoadOptions.includes(key))\n\t\t\t{\n\t\t\t\tacc[key] = value;\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {});\n\n\t\tthis.showLoader();\n\t\tthis.load(loadOptions)\n\t\t\t.then(() => {\n\t\t\t\tthis.hideLoader();\n\t\t\t\tthis.clearSidebar();\n\n\t\t\t\tObject.entries(this.getCrmFields())\n\t\t\t\t\t.forEach(([categoryId, category]) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcategoryId !== 'CATALOG'\n\t\t\t\t\t\t\t&& categoryId !== 'ACTIVITY'\n\t\t\t\t\t\t\t&& categoryId !== 'INVOICE'\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tType.isPlainObject(this.options)\n\t\t\t\t\t\t\t\t&& Type.isBoolean(this.options.isLeadEnabled)\n\t\t\t\t\t\t\t\t&& !this.options.isLeadEnabled\n\t\t\t\t\t\t\t\t&& categoryId === 'LEAD'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst button = new SidebarButton({\n\t\t\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\t\t\ttext: category.CAPTION,\n\t\t\t\t\t\t\t\tchild: true,\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\tthis.onSidebarButtonClick(button);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst filteredFieldsTree = this.getFilteredFieldsTree();\n\t\t\t\tconst categories = Object.keys(filteredFieldsTree);\n\n\t\t\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\t\t\tbutton.deactivate();\n\n\t\t\t\t\tif (categories.includes(button.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.show(button.getLayout());\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.hide(button.getLayout());\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.sidebarButtons.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.resetState();\n\n\t\t\t\t\tconst firstShowedButton = this.sidebarButtons.find((button) => {\n\t\t\t\t\t\treturn button.getLayout().hidden !== true;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (firstShowedButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfirstShowedButton.getLayout().click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\tDom.append(this.overlay, this.layout.parentElement);\n\n\t\tsuper.show(options).then(() => {\n\t\t\tthis.#setShowLock(false);\n\t\t\tthis.getSearchField().enableEdit();\n\t\t\tthis.getSearchField().input.focus();\n\t\t});\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.promiseResolver = resolve;\n\t\t});\n\t}\n\n\t#setHideLock(value: boolean)\n\t{\n\t\tthis.cache.set('hideLock', value);\n\t}\n\n\t#getHideLock(): boolean\n\t{\n\t\treturn this.cache.get('hideLock', false);\n\t}\n\n\thide()\n\t{\n\t\tthis.setCrmFields(this.getOriginalCrmFields());\n\t\treturn super.hide();\n\t}\n\n\tonSaveClick()\n\t{\n\t\tconst selectedFields = Object.values(this.getState())\n\t\t\t.reduce((acc, fields) => {\n\t\t\t\treturn [...acc, ...fields];\n\t\t\t}, []);\n\n\t\tthis.promiseResolver(selectedFields);\n\t\tvoid this.hide();\n\t\tthis.resetState();\n\t}\n\n\tonCancelClick()\n\t{\n\t\tvoid this.hide();\n\t\tthis.resetState();\n\t}\n\n\tgetViewContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('viewContainer', () => {\n\t\t\tif (FieldsPanel.isEditorContext())\n\t\t\t{\n\t\t\t\tconst rootWindow = FieldsPanel.getRootWindow();\n\t\t\t\treturn rootWindow.document.querySelector('.landing-ui-view-container');\n\t\t\t}\n\n\t\t\treturn document.body;\n\t\t});\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.body,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tthis.hideCreateFieldButton();\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.showCreateFieldButton();\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetHideVirtual(value: ?boolean)\n\t{\n\t\tthis.cache.set('hideVirtual', value);\n\t}\n\n\tgetHideVirtual(): ?boolean\n\t{\n\t\treturn this.cache.get('hideVirtual', null);\n\t}\n\n\tsetHideRequisites(value: ?boolean)\n\t{\n\t\tthis.cache.set('hideRequisites', value);\n\t}\n\n\tgetHideRequisites(): ?boolean\n\t{\n\t\treturn this.cache.get('hideRequisites', null);\n\t}\n\n\tsetHideSmartDocuments(value: ?boolean)\n\t{\n\t\tthis.cache.set('hideSmartDocument', value);\n\t}\n\n\tgetHideSmartDocuments(): boolean\n\t{\n\t\treturn this.cache.get('hideSmartDocument', true);\n\t}\n\n\tload(options = {}): Promise<any>\n\t{\n\t\treturn Backend.getInstance()\n\t\t\t.action('Form::getCrmFields', {options})\n\t\t\t.then((result) => {\n\t\t\t\tthis.setOriginalCrmFields(result);\n\t\t\t\tthis.setCrmFields(result);\n\n\t\t\t\tif (FieldsPanel.isEditorContext())\n\t\t\t\t{\n\t\t\t\t\tObject.assign(FormSettingsPanel.getInstance().getCrmFields(), result);\n\t\t\t\t}\n\n\t\t\t\treturn FormClient\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.getDictionary()\n\t\t\t\t\t.then((dictionary) => {\n\t\t\t\t\t\tthis.setFormDictionary(dictionary);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsetFormDictionary(dictionary)\n\t{\n\t\tthis.cache.set('formDictionary', dictionary);\n\t}\n\n\tgetFormDictionary(): {[key: string]: any}\n\t{\n\t\treturn this.cache.get('formDictionary', {});\n\t}\n\n\tsetOriginalCrmFields(fields)\n\t{\n\t\tthis.cache.set('originalFields', fields);\n\t}\n\n\tgetOriginalCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('originalFields') || {};\n\t}\n\n\tsetCrmFields(fields)\n\t{\n\t\tthis.cache.set('fields', fields);\n\t}\n\n\tgetCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('fields') || {};\n\t}\n\n\tsetState(state: {[categoryId: string]: Array<string>})\n\t{\n\t\tthis.cache.set('state', state);\n\t}\n\n\tgetState(): {[categoryId: string]: Array<string>}\n\t{\n\t\treturn this.cache.get('state') || {};\n\t}\n\n\tresetState()\n\t{\n\t\tthis.cache.delete('state');\n\t}\n\n\tonSidebarButtonClick(button: SidebarButton)\n\t{\n\t\tconst activeButton = this.sidebarButtons.getActive();\n\t\tif (activeButton)\n\t\t{\n\t\t\tactiveButton.deactivate();\n\t\t}\n\n\t\tbutton.activate();\n\n\t\tconst hideCreateButton = this.getAllowedTypes().every((type) => {\n\t\t\treturn Type.isPlainObject(type);\n\t\t});\n\t\tif (Type.isArrayFilled(this.getAllowedTypes()) && hideCreateButton)\n\t\t{\n\t\t\tthis.hideCreateFieldButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showCreateFieldButton();\n\t\t}\n\n\t\tconst crmFields = this.getCrmFields();\n\t\tif (Reflect.has(crmFields, button.id))\n\t\t{\n\t\t\tthis.clearContent();\n\n\t\t\tconst form = this.createFieldsListForm(button.id);\n\t\t\tthis.appendForm(form);\n\t\t}\n\t}\n\n\tgetFilteredFieldsTree(): {[key: string]: any}\n\t{\n\t\tconst searchString = String(this.getSearchField().getValue()).toLowerCase().trim();\n\t\tconst allowedCategories = this.getAllowedCategories();\n\t\tconst disabledCategories = this.getDisabledCategories();\n\t\tconst allowedTypes = this.getAllowedTypes();\n\n\t\treturn Object\n\t\t\t.entries(this.getCrmFields())\n\t\t\t.reduce((acc, [categoryId, category]) => {\n\t\t\t\tif (\n\t\t\t\t\t(\n\t\t\t\t\t\tcategoryId !== 'CATALOG'\n\t\t\t\t\t\t&& categoryId !== 'ACTIVITY'\n\t\t\t\t\t\t&& categoryId !== 'INVOICE'\n\t\t\t\t\t)\n\t\t\t\t\t&& (\n\t\t\t\t\t\t!Type.isArrayFilled(allowedCategories)\n\t\t\t\t\t\t|| allowedCategories.includes(categoryId)\n\t\t\t\t\t)\n\t\t\t\t\t&& !disabledCategories.includes(categoryId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst filteredFields = category.FIELDS\n\t\t\t\t\t\t.filter((field) => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tfield.name === 'CONTACT_ORIGIN_VERSION'\n\t\t\t\t\t\t\t\t|| field.name === 'CONTACT_LINK'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst fieldCaption = String(field.caption).toLowerCase().trim();\n\t\t\t\t\t\t\tif (Type.isArrayFilled(allowedTypes))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst isTypeAllowed = allowedTypes.some(allowedType => {\n\t\t\t\t\t\t\t\t\tif (!Type.isPlainObject(allowedType))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tallowedType = {type: allowedType};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tallowedType.entityFieldName\n\t\t\t\t\t\t\t\t\t\t&& allowedType.entityFieldName !== field.entity_field_name\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tType.isBoolean(allowedType.multiple)\n\t\t\t\t\t\t\t\t\t\t&& allowedType.multiple !== field.multiple\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn field.type === allowedType.type;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (!isTypeAllowed)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t!Type.isStringFilled(searchString)\n\t\t\t\t\t\t\t\t|| fieldCaption.includes(searchString)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (Type.isArrayFilled(filteredFields))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[categoryId] = {\n\t\t\t\t\t\t\t...category,\n\t\t\t\t\t\t\tFIELDS: filteredFields,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t}\n\n\tcreateFieldsListForm(category: string): FormSettingsForm\n\t{\n\t\tconst fieldsListTree = this.getFilteredFieldsTree();\n\t\tconst disabledFields = this.getDisabledFields();\n\t\tconst fieldOptions = {\n\t\t\titems: fieldsListTree[category].FIELDS.map((field) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: field.caption,\n\t\t\t\t\tvalue: field.name,\n\t\t\t\t\tdisabled: (\n\t\t\t\t\t\tType.isArrayFilled(disabledFields)\n\t\t\t\t\t\t&& disabledFields.includes(field.name)\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}),\n\t\t\tvalue: this.getState()[category] || [],\n\t\t\tonValueChange: (checkbox) => {\n\t\t\t\tconst state = {...this.getState()};\n\t\t\t\tstate[category] = checkbox.getValue();\n\t\t\t\tthis.setState(state);\n\t\t\t},\n\t\t};\n\n\t\treturn new FormSettingsForm({\n\t\t\tfields: [\n\t\t\t\tthis.isMultiple()\n\t\t\t\t\t? new BX.Landing.UI.Field.Checkbox(fieldOptions)\n\t\t\t\t\t: new BX.Landing.UI.Field.Radio(fieldOptions)\n\t\t\t\t,\n\t\t\t],\n\t\t});\n\t}\n\n\tonSearchChange()\n\t{\n\t\tconst filteredFieldsTree = this.getFilteredFieldsTree();\n\t\tconst categories = Object.keys(filteredFieldsTree);\n\n\t\tthis.sidebarButtons.forEach((button) => {\n\t\t\tbutton.deactivate();\n\n\t\t\tif (categories.includes(button.id))\n\t\t\t{\n\t\t\t\tDom.show(button.getLayout());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.hide(button.getLayout());\n\t\t\t}\n\t\t});\n\n\t\tthis.clearContent();\n\n\t\tconst [firstCategory] = categories;\n\t\tif (firstCategory)\n\t\t{\n\t\t\tconst firstCategoryButton = this.sidebarButtons.get(firstCategory);\n\t\t\tif (firstCategoryButton)\n\t\t\t{\n\t\t\t\tfirstCategoryButton.activate();\n\t\t\t}\n\n\t\t\tconst form = this.createFieldsListForm(firstCategory);\n\n\t\t\tthis.showCreateFieldButton();\n\t\t\tthis.appendForm(form);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideCreateFieldButton();\n\t\t}\n\t}\n\n\tgetSearchField(): Text\n\t{\n\t\treturn this.cache.remember('searchField', () => {\n\t\t\tconst rootWindow = FieldsPanel.getRootWindow();\n\t\t\treturn new rootWindow.BX.Landing.UI.Field.Text({\n\t\t\t\tselector: 'search',\n\t\t\t\ttextOnly: true,\n\t\t\t\tplaceholder: Loc.getMessage('LANDING_FIELDS_PANEL_SEARCH'),\n\t\t\t\tonChange: this.onSearchChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSearchContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('searchLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-panel-content-element landing-ui-panel-content-search\">\n\t\t\t\t\t${this.getSearchField().getLayout()}\n\t\t\t\t\t<div class=\"landing-ui-panel-content-search-icon\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetUserFieldFactory(entityId: string)\n\t{\n\t\tconst factory = this.cache.remember(`userFieldFactory_${entityId}`, () => {\n\t\t\tconst rootWindow = window.top;\n\t\t\tconst preparedEntityId = (() => {\n\t\t\t\tif (entityId.startsWith('DYNAMIC_'))\n\t\t\t\t{\n\t\t\t\t\treturn this.getCrmFields()[entityId].DYNAMIC_ID;\n\t\t\t\t}\n\n\t\t\t\treturn `CRM_${entityId}`;\n\t\t\t})();\n\n\t\t\tconst Factory = (() => {\n\t\t\t\tif (rootWindow.BX.UI.UserFieldFactory)\n\t\t\t\t{\n\t\t\t\t\treturn rootWindow.BX.UI.UserFieldFactory.Factory\n\t\t\t\t}\n\n\t\t\t\treturn BX.UI.UserFieldFactory.Factory;\n\t\t\t})();\n\n\t\t\treturn new Factory(\n\t\t\t\tpreparedEntityId,\n\t\t\t\t{\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tbindElement: this.getCreateFieldButton(),\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\n\t\tif (Type.isArrayFilled(this.getAllowedTypes()))\n\t\t{\n\t\t\tfactory.types = factory.types.filter((type) => {\n\t\t\t\treturn this.getAllowedTypes().includes(type.name);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfactory.types = factory.types.filter((type) => {\n\t\t\t\treturn type.name !== 'employee';\n\t\t\t});\n\t\t}\n\n\t\treturn factory;\n\t}\n\n\tonCreateFieldClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst dictionary = this.getFormDictionary();\n\n\t\tif (\n\t\t\tType.isPlainObject(dictionary.permissions)\n\t\t\t&& Type.isPlainObject(dictionary.permissions.userField)\n\t\t\t&& dictionary.permissions.userField.add === false\n\t\t)\n\t\t{\n\t\t\tconst rootWindow = FieldsPanel.getRootWindow();\n\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(Loc.getMessage('LANDING_FORM_ADD_USER_FIELD_PERMISSION_DENIED'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeButton = this.sidebarButtons.getActive();\n\t\tconst currentCategoryId = activeButton.id;\n\n\t\tconst factory = this.getUserFieldFactory(currentCategoryId);\n\t\tconst menu = factory.getMenu();\n\n\t\tmenu.open((type) => {\n\t\t\tconst configurator = factory.getConfigurator({\n\t\t\t\tuserField: factory.createUserField(type),\n\t\t\t\tonSave: (userField) => {\n\t\t\t\t\tuserField\n\t\t\t\t\t\t.save()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\treturn this.load();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.getSearchField()\n\t\t\t\t\t\t\t\t.setValue(userField.getData().editFormLabel[Loc.getMessage('LANGUAGE_ID')]);\n\t\t\t\t\t\t\tthis.showCreateFieldButton();\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.showCreateFieldButton();\n\t\t\t\t\tthis.sidebarButtons.getActive().getLayout().click();\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.clearContent();\n\t\t\tDom.append(configurator.render(), this.content);\n\t\t\tthis.hideCreateFieldButton();\n\t\t});\n\n\t\tDom.style(menu.getPopup().getPopupContainer(), 'z-index', 9999);\n\t}\n\n\tgetCreateFieldButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('getCreateFieldButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"landing-ui-panel-content-create-field-button\"\n\t\t\t\t\tonclick=\"${this.onCreateFieldClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('LANDING_FIELDS_PANEL_CREATE_FIELD')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCreateFieldLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('createFieldLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-panel-content-create-field\">\n\t\t\t\t\t${this.getCreateFieldButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisUserFieldEditorShowed(): boolean\n\t{\n\t\treturn Type.isDomNode(this.content.querySelector('.ui-userfieldfactory-configurator'));\n\t}\n\n\tshowCreateFieldButton()\n\t{\n\t\tDom.append(this.getCreateFieldLayout(), this.body);\n\t}\n\n\thideCreateFieldButton()\n\t{\n\t\tDom.remove(this.getCreateFieldLayout(), this.body);\n\t}\n}"],"names":["FieldsPanel","staticCache","remember","rootWindow","PageObject","getRootWindow","viewContainer","document","body","querySelector","Type","isDomNode","isEditorContext","window","options","rootWindowPanel","BX","Landing","UI","Panel","instance","setEventNamespace","setLayoutClass","setOverlayClass","setTitle","Loc","getMessage","onSaveClick","bind","onCancelClick","cache","Cache","MemoryCache","Dom","append","layout","getViewContainer","overlay","insertAfter","getSearchContainer","header","getCreateFieldLayout","appendFooterButton","BaseButton","text","onClick","className","attrs","title","get","mode","set","types","fields","categories","keys","forEach","key","startsWith","Promise","resolve","getSearchField","input","textContent","setMultiple","setAllowedTypes","setDisabledFields","setAllowedCategories","setDisabledCategories","resetFactoriesCache","isArrayFilled","disabledFields","allowedCategories","disabledCategories","allowedTypes","isBoolean","multiple","style","position","allowedLoadOptions","loadOptions","Object","entries","reduce","acc","value","includes","showLoader","load","then","hideLoader","clearSidebar","getCrmFields","categoryId","category","isPlainObject","isLeadEnabled","button","SidebarButton","id","CAPTION","child","onSidebarButtonClick","appendSidebarButton","filteredFieldsTree","getFilteredFieldsTree","sidebarButtons","deactivate","show","getLayout","hide","length","resetState","firstShowedButton","find","hidden","click","parentElement","enableEdit","focus","promiseResolver","setCrmFields","getOriginalCrmFields","selectedFields","values","getState","Loader","target","hideCreateFieldButton","getLoader","showCreateFieldButton","Backend","getInstance","action","result","setOriginalCrmFields","assign","FormSettingsPanel","FormClient","getDictionary","dictionary","setFormDictionary","state","activeButton","getActive","activate","hideCreateButton","getAllowedTypes","every","type","crmFields","Reflect","has","clearContent","form","createFieldsListForm","appendForm","searchString","String","getValue","toLowerCase","trim","getAllowedCategories","getDisabledCategories","filteredFields","FIELDS","filter","field","name","fieldCaption","caption","isTypeAllowed","some","allowedType","entityFieldName","entity_field_name","isStringFilled","fieldsListTree","getDisabledFields","fieldOptions","items","map","disabled","onValueChange","checkbox","setState","FormSettingsForm","isMultiple","Field","Checkbox","Radio","firstCategory","firstCategoryButton","Text","selector","textOnly","placeholder","onChange","onSearchChange","Tag","render","entityId","factory","top","preparedEntityId","DYNAMIC_ID","Factory","UserFieldFactory","moduleId","bindElement","getCreateFieldButton","event","preventDefault","getFormDictionary","permissions","userField","add","Dialogs","MessageBox","alert","currentCategoryId","getUserFieldFactory","menu","getMenu","open","configurator","getConfigurator","createUserField","onSave","save","setValue","getData","editFormLabel","onCancel","content","getPopup","getPopupContainer","onCreateFieldClick","remove","Content"],"mappings":"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"}