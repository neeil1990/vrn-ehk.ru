{"version":3,"file":"crm.bundle.js","sources":["../src/internal/stagefield/stagefield.js","../src/crm.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {Dom, Tag, Type} from 'main.core';\n\nimport './css/style.css';\n\nconst fetchId = (item) => {\n\treturn !Type.isNil(item.ID) ? item.ID : item.id;\n};\n\nconst fetchName = (item) => {\n\treturn !Type.isNil(item.NAME) ? item.NAME : item.name;\n};\n\nexport default class StageField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.replace(this.input, this.getInner());\n\t}\n\n\tgetInner()\n\t{\n\t\treturn this.cache.remember('inner', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-stages\">\n\t\t\t\t\t${this.getCategoriesDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCategoriesDropdown(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('categoriesDropdown', () => {\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\ttitle: this.options.listTitle || Loc.getMessage('LANDING_FORM_SETTINGS_CATEGORIES_FIELD_TITLE'),\n\t\t\t\tcontent: this.options.value.category,\n\t\t\t\titems: this.options.categories.map((category) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: fetchName(category),\n\t\t\t\t\t\tvalue: fetchId(category),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tonChange: this.onCategoryChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentCategory()\n\t{\n\t\tconst currentCategoryId = this.getCategoriesDropdown().getValue();\n\n\t\treturn this.options.categories.find((category) => {\n\t\t\treturn String(fetchId(category)) === String(currentCategoryId);\n\t\t});\n\t}\n\n\tonCategoryChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tgetValue()\n\t{\n\t\treturn {\n\t\t\tcategory: this.getCategoriesDropdown().getValue(),\n\t\t\tstage: '',\n\t\t};\n\t}\n\n\tsetValue(value, preventEvent = false)\n\t{\n\t\tthis.getCategoriesDropdown().setValue(value.category);\n\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n}","import {Loc} from 'landing.loc';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {BaseEvent} from 'main.core.events';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {Text, Type} from 'main.core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport StageField from './internal/stagefield/stagefield';\nimport { SchemeManager } from 'landing.ui.panel.formsettingspanel.content.crm.schememanager';\n\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\nexport default class CrmContent extends ContentWrapper\n{\n\t#schemeManager: SchemeManager;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.CrmContent');\n\n\t\tthis.#schemeManager = new SchemeManager([ ...options.dictionary.document.schemes ]);\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t}\n\n\t\tthis.addItem(this.getExpertSettingsForm());\n\t\tthis.addItem(this.getOrderSettingsForm());\n\n\t\tthis.setLastScheme(this.options.formOptions.document.scheme);\n\t\tthis.setLastDealCategory(this.options.formOptions.document.deal.category);\n\t}\n\n\tisDynamicAvailable(): boolean\n\t{\n\t\treturn Type.isArrayFilled(this.options.dictionary.document.dynamic);\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesField(): BX.Landing.UI.Field.Radio\n\t{\n\t\treturn this.cache.remember('duplicatesField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Radio({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_FIELD_TITLE'),\n\t\t\t\tselector: 'duplicateMode',\n\t\t\t\tvalue: [this.options.formOptions.document.duplicateMode ? this.options.formOptions.document.duplicateMode : 'ALLOW'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_ALLOW'),\n\t\t\t\t\t\tvalue: 'ALLOW',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_REPLACE'),\n\t\t\t\t\t\tvalue: 'REPLACE',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_MERGE'),\n\t\t\t\t\t\tvalue: 'MERGE',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetOrderSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('formSettingsForm', () => {\n\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\tconst isOpened = (() => {\n\t\t\t\tif (scheme && scheme.dynamic === true)\n\t\t\t\t{\n\t\t\t\t\treturn String(scheme.id).endsWith('1');\n\t\t\t\t}\n\n\t\t\t\treturn Text.toNumber(this.options.formOptions.document.scheme) > 4;\n\t\t\t})();\n\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_ORDER_HEADER'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: isOpened,\n\t\t\t\tfields: [],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType1Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type1header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType2Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type2header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType3Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type3header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType4Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type4header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType6Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type6header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_6').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicHeader(headerText: string): HeaderCard\n\t{\n\t\tconst header = this.cache.remember('dynamicHeader', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: '',\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\n\t\tif (Type.isString(headerText))\n\t\t{\n\t\t\theader.setTitle(headerText);\n\t\t}\n\n\t\treturn header;\n\t}\n\n\tgetDynamicEntitiesField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('dynamicEntitiesField', () => {\n\t\t\tconst currentScheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\tselector: 'dynamicScheme',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_SMART_ENTITY_LIST'),\n\t\t\t\titems: this.options.dictionary.document.dynamic.map((scheme) => {\n\t\t\t\t\treturn {name: scheme.name, value: scheme.id};\n\t\t\t\t}),\n\t\t\t\tcontent: currentScheme.mainEntity,\n\t\t\t\tonChange: () => {\n\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\tid: this.getSelectedSchemeId(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicEntitySettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('dynamicEntitySettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\topened: true,\n\t\t\t\thidden: true,\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getDynamicEntitiesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetExpertSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('expertSettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_EXPERT_MODE'),\n\t\t\t\ttoggleable: true,\n\t\t\t\ttoggleableType: FormSettingsForm.ToggleableType.Link,\n\t\t\t\topened: false,\n\t\t\t\tfields: [\n\t\t\t\t\tnew HeaderCard({\n\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\t\t\tlevel: 2,\n\t\t\t\t\t}),\n\t\t\t\t\tthis.getDuplicatesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTypesField(): RadioButtonField\n\t{\n\t\treturn this.cache.remember('typesField', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.onTypeChange(\n\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\tid: this.options.formOptions.document.scheme,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tconst items = [\n\t\t\t\t{\n\t\t\t\t\tid: '2',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type2',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '3',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type3',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '4',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type4',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '310',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_310'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type310',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tif (this.isDynamicAvailable())\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: 'smart',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_5'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type5',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.options.isLeadEnabled)\n\t\t\t{\n\t\t\t\titems.unshift({\n\t\t\t\t\tid: '1',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type1',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new RadioButtonField({\n\t\t\t\tselector: 'scheme',\n\t\t\t\tvalue: (() => {\n\t\t\t\t\tconst schemeId = Text.toNumber(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (this.#schemeManager.isDefaultScheme(schemeId) && this.#schemeManager.isInvoice(schemeId))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.#schemeManager.getSpecularSchemeId(schemeId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (String(this.options.formOptions.document.scheme) === '310')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 310;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (Type.isPlainObject(scheme) && scheme.dynamic === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 'smart';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn String(schemeId);\n\t\t\t\t})(),\n\t\t\t\titems,\n\t\t\t\tonChange: this.onTypeChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryField()\n\t{\n\t\treturn this.cache.remember('dealCategoryField', () => {\n\t\t\treturn new StageField({\n\t\t\t\tcategories: this.options.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.deal.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicCategoriesField(schemeId: string | number)\n\t{\n\t\treturn this.cache.remember(`dynamicCategories#${schemeId}`, () => {\n\t\t\tconst scheme = this.getDynamicSchemeById(schemeId);\n\t\t\treturn new StageField({\n\t\t\t\tlistTitle: Loc.getMessage('LANDING_FORM_SETTINGS_SMART_STAGES_FIELD_TITLE'),\n\t\t\t\tcategories: scheme.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.dynamic.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesEnabledField()\n\t{\n\t\treturn this.cache.remember('duplicatesEnabledField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'duplicatesEnabled',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [this.options.formOptions.document.deal.duplicatesEnabled || 'Y'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_DUPLICATES_ENABLED'),\n\t\t\t\t\t\tvalue: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSchemeById(id: number)\n\t{\n\t\treturn this.options.dictionary.document.schemes.find((scheme) => {\n\t\t\treturn (\n\t\t\t\t(String(scheme.id) === String(id))\n\t\t\t\t|| (\n\t\t\t\t\tid === 'smart'\n\t\t\t\t\t&& scheme.dynamic\n\t\t\t\t\t&& String(scheme.id) === String(this.getSelectedSchemeId())\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tgetDynamicSchemeById(id: number)\n\t{\n\t\tconst {mainEntity} = this.getSchemeById(id);\n\t\treturn this.options.dictionary.document.dynamic.find((scheme) => {\n\t\t\treturn String(scheme.id) === String(mainEntity);\n\t\t});\n\t}\n\n\tsetLastScheme(schemeId: number)\n\t{\n\t\tthis.cache.set('lastScheme', schemeId);\n\t}\n\n\tgetLastScheme(): number\n\t{\n\t\treturn this.cache.get('lastScheme');\n\t}\n\n\tsetLastDealCategory(categoryId: number)\n\t{\n\t\tthis.cache.set('lastDealCategory', categoryId);\n\t}\n\n\tgetLastDealCategory(): ?number\n\t{\n\t\treturn this.cache.get('lastDealCategory', null);\n\t}\n\n\tonTypeChange(event: BaseEvent)\n\t{\n\t\tconst {item} = event.getData();\n\t\tconst scheme = this.getSchemeById(item.id);\n\n\t\tthis.clear();\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t\tthis.getDynamicEntitySettingsForm().hide();\n\t\t}\n\n\t\tconst expertSettingsForm = this.getExpertSettingsForm();\n\t\texpertSettingsForm.clear();\n\n\t\tif (String(item.id) === '1' || String(item.id) === '8')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType1Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '2' || String(item.id) === '5')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType2Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '3' || String(item.id) === '6')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType3Header());\n\t\t\texpertSettingsForm.addField(this.getDealCategoryField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesEnabledField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '4' || String(item.id) === '7')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType4Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\t\tif (String(item.id) === '310')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType6Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (\n\t\t\t(\n\t\t\t\tText.toNumber(item.id) > 4\n\t\t\t\t&& Type.isPlainObject(scheme)\n\t\t\t\t&& scheme.dynamic !== true && String(item.id)  !== '9'\n\t\t\t)\n\t\t\t|| this.getOrderSettingsForm().isOpened()\n\t\t)\n\t\t{\n\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t}\n\n\t\tif (\n\t\t\tType.isPlainObject(scheme)\n\t\t\t&& (String(item.id) === 'smart' || scheme.dynamic === true)\n\t\t\t&& this.isDynamicAvailable()\n\t\t)\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getDynamicHeader(scheme.name));\n\t\t\tif (scheme.categories)\n\t\t\t{\n\t\t\t\texpertSettingsForm.addField(this.getDynamicCategoriesField(scheme.id));\n\t\t\t}\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\n\t\t\tif (String(scheme.id).endsWith('1'))\n\t\t\t{\n\t\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t\t}\n\n\t\t\tthis.getDynamicEntitySettingsForm().show();\n\t\t}\n\n\t\tthis.addItem(expertSettingsForm);\n\t\tif (String(item.id) !== '310')\n\t\t{\n\t\t\tthis.addItem(this.getOrderSettingsForm());\n\t\t}\n\t}\n\n\tsetAdditionalValue(value: {[key: string]: any})\n\t{\n\t\tthis.cache.set('additionalValue', value);\n\t}\n\n\tgetAdditionalValue(): {[key: string]: any}\n\t{\n\t\treturn this.cache.get('additionalValue', {});\n\t}\n\n\tgetEntityChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('entityChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('dealCategoryChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCreateOrderChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('createOrderChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tconst value = this.getValue();\n\t\tconst scheme = this.getSchemeById(value.document.scheme);\n\n\t\tif (Type.isPlainObject(scheme))\n\t\t{\n\t\t\tconst allowedEntities = scheme.entities;\n\t\t\tconst removedFields = this.options.formOptions.presetFields\n\t\t\t\t.filter((presetField) => {\n\t\t\t\t\treturn !allowedEntities.includes(presetField.entityName);\n\t\t\t\t})\n\t\t\t\t.map((presetField) => {\n\t\t\t\t\treturn this.getCrmFieldById(\n\t\t\t\t\t\t`${presetField.entityName}_${presetField.fieldName}`,\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(removedFields))\n\t\t\t{\n\t\t\t\tconst itemTemplate = Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE');\n\t\t\t\tconst entityName = Text.encode(itemTemplate.replace('{text}', scheme.name));\n\n\t\t\t\tconst messageText = (() => {\n\t\t\t\t\tconst fields = removedFields.map((field) => {\n\t\t\t\t\t\treturn itemTemplate.replace('{text}', Text.encode(field.caption));\n\t\t\t\t\t});\n\n\t\t\t\t\tif (removedFields.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst lastField = fields.pop();\n\n\t\t\t\t\t\treturn Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldsList}', fields.join(', '))\n\t\t\t\t\t\t\t.replace('{lastField}', Text.encode(lastField))\n\t\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc\n\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT_1')\n\t\t\t\t\t\t.replace('{fieldName}', fields.join(', '))\n\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t})();\n\n\t\t\t\tconst entityChangeConfirm = this.getEntityChangeConfirm();\n\n\t\t\t\tentityChangeConfirm.setOkCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst filteredFields = this.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\treturn allowedEntities.includes(presetField.entityName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setLastScheme(scheme.id);\n\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\n\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setCancelCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst lastScheme = this.getSchemeById(this.getLastScheme());\n\n\t\t\t\t\t\tif (lastScheme.dynamic)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue('smart', true);\n\t\t\t\t\t\t\tthis.getDynamicEntitiesField().setValue(lastScheme.mainEntity, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue(lastScheme.id);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\t\tid: lastScheme.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setMessage(messageText);\n\n\t\t\t\tentityChangeConfirm.show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tString(scheme.id) === '3'\n\t\t\t\t|| String(scheme.id) === '6'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst lastDealCategory = this.getLastDealCategory();\n\t\t\t\tif (Text.toNumber(value.document.deal.category) !== Text.toNumber(lastDealCategory))\n\t\t\t\t{\n\t\t\t\t\tconst dealStageField = this.options.formOptions.presetFields.find((presetField) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tpresetField.entityName === 'DEAL'\n\t\t\t\t\t\t\t&& presetField.fieldName === 'STAGE_ID'\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (dealStageField)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst crmField = this.getCrmFieldById('DEAL_STAGE_ID');\n\t\t\t\t\t\tconst dealCategoryChangeConfirm = this.getDealCategoryChangeConfirm();\n\n\t\t\t\t\t\tconst fieldName = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE')\n\t\t\t\t\t\t\t.replace('{text}', Text.encode(crmField.caption));\n\t\t\t\t\t\tconst messageText = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CATEGORY_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldName}', fieldName);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.setMessage(messageText);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setOkCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tconst filteredFields = (\n\t\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\t\t\t\treturn presetField !== dealStageField;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\t\t\tthis.setLastDealCategory(value.document.deal.category);\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setCancelCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tthis.getDealCategoryField().setValue({\n\t\t\t\t\t\t\t\t\tcategory: this.getLastDealCategory(),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.show();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!this.#schemeManager.isInvoice(scheme.id) && value.document.payment.use)\n\t\t{\n\t\t\tconst createOrderMessageBox = this.getCreateOrderChangeConfirm();\n\t\t\tcreateOrderMessageBox.setMessage(\n\t\t\t\tLoc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CREATE_ORDER_MESSAGE_BOX_TITLE')\n\t\t\t);\n\n\t\t\tcreateOrderMessageBox.setOkCallback((messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tmessageBox.getOkButton().setDisabled(false);\n\n\t\t\t\tthis.options.formOptions.payment.use = false;\n\n\t\t\t\tthis.onChange(event);\n\t\t\t})\n\t\t\tcreateOrderMessageBox.setCancelCallback((messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tmessageBox.getCancelButton().setDisabled(false);\n\n\t\t\t\tconst orderSettingsSwitch = this.getOrderSettingsForm().getSwitch();\n\t\t\t\torderSettingsSwitch.setValue(true);\n\t\t\t\torderSettingsSwitch.onChange();\n\n\t\t\t\tthis.onChange(event);\n\t\t\t})\n\t\t\tcreateOrderMessageBox.show();\n\t\t}\n\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetSelectedSchemeId(): number\n\t{\n\t\tconst typeId = this.getTypesField().getValue();\n\t\tif (String(typeId) === 'smart')\n\t\t{\n\t\t\tconst entityId = this.getDynamicEntitiesField().getValue();\n\t\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t\t{\n\t\t\t\treturn `${entityId}1`;\n\t\t\t}\n\n\t\t\treturn `${entityId}0`;\n\t\t}\n\n\t\treturn typeId;\n\t}\n\n\tvalueReducer(value: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\tconst duplicateMode = this.getDuplicatesField().getValue()[0];\n\t\tconst reducedValue = {\n\t\t\tduplicateMode: duplicateMode === 'ALLOW' ? '' : duplicateMode,\n\t\t\tscheme: this.getSelectedSchemeId(),\n\t\t\tdeal: {\n\t\t\t\tduplicatesEnabled: Text.toBoolean(this.getDuplicatesEnabledField().getValue()[0]),\n\t\t\t},\n\t\t\tpayment: {\n\t\t\t\tuse: this.options.formOptions.payment.use,\n\t\t\t\tpayer: this.options.formOptions.payment.payer,\n\t\t\t\tdisabledSystems: this.options.formOptions.payment.disabledSystems,\n\t\t\t},\n\t\t\tdynamic: {\n\t\t\t\tcategory: null,\n\t\t\t},\n\t\t};\n\n\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t{\n\t\t\tif (String(reducedValue.scheme) === '1')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '8';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '2')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '5';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '3')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '6';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '4')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '7';\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tString(reducedValue.scheme) === '3'\n\t\t\t|| String(reducedValue.scheme) === '6'\n\t\t)\n\t\t{\n\t\t\treducedValue.deal.category = this.getDealCategoryField().getValue().category;\n\t\t}\n\n\t\tconst scheme = this.getSchemeById(reducedValue.scheme);\n\t\tif (Type.isPlainObject(scheme) && scheme.dynamic && scheme.categories)\n\t\t{\n\t\t\treducedValue.dynamic.category = this.getDynamicCategoriesField(scheme.id).getValue().category;\n\t\t}\n\n\t\treturn {\n\t\t\tdocument: reducedValue,\n\t\t\t...this.getAdditionalValue(),\n\t\t};\n\t}\n}"],"names":["fetchId","item","Type","isNil","ID","id","fetchName","NAME","name","StageField","options","Dom","replace","input","getInner","cache","remember","Tag","render","getCategoriesDropdown","getLayout","BX","Landing","UI","Field","Dropdown","title","listTitle","Loc","getMessage","content","value","category","items","categories","map","onChange","onCategoryChange","bind","currentCategoryId","getValue","find","String","emit","stage","preventEvent","setValue","BaseField","CrmContent","setEventNamespace","SchemeManager","dictionary","document","schemes","addItem","getHeader","getTypesField","isDynamicAvailable","getDynamicEntitySettingsForm","getExpertSettingsForm","getOrderSettingsForm","setLastScheme","formOptions","scheme","setLastDealCategory","deal","isArrayFilled","dynamic","HeaderCard","Radio","selector","duplicateMode","getSchemeById","isOpened","endsWith","Text","toNumber","FormSettingsForm","toggleable","opened","fields","level","headerText","header","isString","setTitle","currentScheme","mainEntity","onTypeChange","BaseEvent","data","getSelectedSchemeId","hidden","getDynamicEntitiesField","toggleableType","ToggleableType","Link","getDuplicatesField","setTimeout","icon","push","isLeadEnabled","unshift","RadioButtonField","schemeId","isDefaultScheme","isInvoice","getSpecularSchemeId","isPlainObject","getDynamicSchemeById","Checkbox","compact","duplicatesEnabled","set","get","categoryId","event","getData","clear","hide","expertSettingsForm","addField","getType1Header","getType2Header","getType3Header","getDealCategoryField","getDuplicatesEnabledField","getType4Header","getType6Header","onSwitchChange","getDynamicHeader","getDynamicCategoriesField","show","MessageBox","buttons","MessageBoxButtons","OK_CANCEL","allowedEntities","entities","removedFields","presetFields","filter","presetField","includes","entityName","getCrmFieldById","fieldName","itemTemplate","encode","messageText","field","caption","length","lastField","pop","join","replaceAll","entityChangeConfirm","getEntityChangeConfirm","setOkCallback","close","getOkButton","setDisabled","getCancelButton","filteredFields","setAdditionalValue","skipPrepare","setCancelCallback","lastScheme","getLastScheme","setMessage","lastDealCategory","getLastDealCategory","dealStageField","crmField","dealCategoryChangeConfirm","getDealCategoryChangeConfirm","payment","use","createOrderMessageBox","getCreateOrderChangeConfirm","messageBox","orderSettingsSwitch","getSwitch","Object","values","crmFields","reduce","acc","FIELDS","currentField","typeId","entityId","reducedValue","toBoolean","payer","disabledSystems","getAdditionalValue","ContentWrapper"],"mappings":"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"}