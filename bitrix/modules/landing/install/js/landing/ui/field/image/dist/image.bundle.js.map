{"version":3,"file":"image.bundle.js","sources":["../src/image.js"],"sourcesContent":["import {Dom, Type, Runtime} from 'main.core';\nimport {Loc} from 'landing.loc';\nimport {Main} from 'landing.main'\nimport {TextField} from 'landing.ui.field.textfield';\nimport {ImageUploader} from 'landing.imageuploader';\nimport {BaseButton} from 'landing.ui.button.basebutton';\nimport {ImageEditor} from 'landing.imageeditor';\n\nimport 'ui.fonts.opensans';\nimport './css/style.css';\n\nexport class Image extends TextField\n{\n\tconstructor(data)\n\t{\n\t\tsuper(data);\n\n\t\tthis.dimensions = typeof data.dimensions === \"object\" ? data.dimensions : null;\n\t\tthis.create2xByDefault = data.create2xByDefault !== false;\n\t\tthis.uploadParams = typeof data.uploadParams === \"object\" ? data.uploadParams : {};\n\t\tthis.onValueChangeHandler = data.onValueChange ? data.onValueChange : (() => {});\n\t\tthis.type = this.content.type || \"image\";\n\t\tthis.allowClear = data.allowClear;\n\t\tthis.input.innerText = this.content.src;\n\t\tthis.input.hidden = true;\n\t\tthis.input2x = this.createInput();\n\t\tthis.input2x.innerText = this.content.src2x;\n\t\tthis.input2x.hidden = true;\n\n\t\tthis.layout.classList.add(\"landing-ui-field-image\");\n\t\tif (data.compactMode === true)\n\t\t{\n\t\t\tthis.layout.classList.add(\"landing-ui-field-image--compact\");\n\t\t}\n\n\t\tthis.disableAltField = typeof data.disableAltField === \"boolean\" ? data.disableAltField : false;\n\n\t\tthis.fileInput = Image.createFileInput(this.selector);\n\t\tthis.fileInput.addEventListener(\"change\", this.onFileInputChange.bind(this));\n\n\t\tthis.linkInput = Image.createLinkInput();\n\t\tthis.linkInput.onInputHandler = Runtime.debounce(this.onLinkInput.bind(this), 777);\n\n\t\tthis.dropzone = Image.createDropzone(this.selector);\n\t\tthis.dropzone.hidden = true;\n\t\tthis.dropzone.insertBefore(this.fileInput, this.dropzone.firstElementChild);\n\n\t\tthis.onDragOver = this.onDragOver.bind(this);\n\t\tthis.onDragLeave = this.onDragLeave.bind(this);\n\t\tthis.onDrop = this.onDrop.bind(this);\n\n\t\tthis.dropzone.addEventListener(\"dragover\", this.onDragOver);\n\t\tthis.dropzone.addEventListener(\"dragleave\", this.onDragLeave);\n\t\tthis.dropzone.addEventListener(\"drop\", this.onDrop);\n\n\t\tthis.clearButton = Image.createClearButton();\n\t\tthis.clearButton.on(\"click\", this.onClearClick.bind(this));\n\n\t\tthis.preview = Image.createImagePreview();\n\t\tthis.preview.appendChild(this.clearButton.layout);\n\t\tthis.preview.style.backgroundImage = \"url(\" + this.input.innerText.trim() + \")\";\n\n\t\tthis.onImageDragEnter = this.onImageDragEnter.bind(this);\n\t\tthis.preview.addEventListener(\"dragenter\", this.onImageDragEnter);\n\n\t\tthis.loader = new BX.Loader({target: this.preview});\n\n\t\tthis.icon = Image.createIcon();\n\n\t\tthis.image = Image.createImageLayout();\n\t\tthis.image.appendChild(this.preview);\n\t\tthis.image.appendChild(this.icon);\n\t\tthis.image.dataset.fileid = this.content.id;\n\t\tthis.image.dataset.fileid2x = this.content.id2x;\n\n\t\tthis.hiddenImage = Dom.create(\"img\", {\n\t\t\tprops: {className: \"landing-ui-field-image-hidden\"},\n\t\t});\n\n\t\tif (Type.isPlainObject(this.content) && \"src\" in this.content)\n\t\t{\n\t\t\tthis.hiddenImage.src = this.content.src;\n\t\t}\n\n\t\tthis.altField = Image.createAltField();\n\t\tthis.altField.setValue(this.content.alt);\n\n\t\tthis.left = Image.createLeftLayout();\n\t\tthis.left.appendChild(this.dropzone);\n\t\tthis.left.appendChild(this.image);\n\t\tthis.left.appendChild(this.hiddenImage);\n\n\t\tif (this.description)\n\t\t{\n\t\t\tthis.left.appendChild(this.description);\n\t\t}\n\n\t\tthis.left.appendChild(this.altField.layout);\n\t\tthis.left.appendChild(this.linkInput.layout);\n\n\t\tthis.uploadButton = Image.createUploadButton();\n\t\tthis.uploadButton.on(\"click\", this.onUploadClick.bind(this));\n\n\t\tthis.editButton = Image.createEditButton();\n\t\tthis.editButton.on(\"click\", this.onEditClick.bind(this));\n\n\t\tthis.right = Image.createRightLayout();\n\t\tthis.right.appendChild(this.uploadButton.layout);\n\t\tthis.right.appendChild(this.editButton.layout);\n\n\t\tthis.form = Image.createForm();\n\t\tthis.form.appendChild(this.left);\n\t\tthis.form.appendChild(this.right);\n\n\t\tthis.layout.appendChild(this.form);\n\n\t\tthis.enableTextOnly();\n\n\t\tif (!this.input.innerText.trim() || this.input.innerText.trim() === window.location.toString())\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t}\n\n\t\tif (this.disableAltField)\n\t\t{\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.layout.style.display = \"none\";\n\t\t\tthis.altField.layout.classList.add(\"landing-ui-hide\");\n\t\t}\n\n\t\tif (this.content.type === \"icon\")\n\t\t{\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.classList = this.content.classList;\n\t\t\tthis.showPreview();\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tDom.addClass(this.layout, 'landing-ui-field-image-icon');\n\t\t}\n\n\t\tthis.makeAsLinkWrapper = Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-wrapper\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-make-as-link-button\"},\n\t\t\t\t\tchildren: [],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.url = new BX.Landing.UI.Field.Link({\n\t\t\tcontent: this.content.url || {\n\t\t\t\ttext: '',\n\t\t\t\thref: '',\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tsiteId: Main.getInstance().options.site_id,\n\t\t\t\tlandingId: Main.getInstance().id,\n\t\t\t},\n\t\t\tcontentRoot: this.contentRoot,\n\t\t});\n\n\t\tthis.urlCheckbox = Dom.create(\"input\", {\n\t\t\tprops: {type: \"checkbox\"},\n\t\t\tattrs: {style: \"margin-left: 4px;\"},\n\t\t});\n\n\t\tfunction onCheckboxChange(checkbox, layout)\n\t\t{\n\t\t\tif (checkbox.checked)\n\t\t\t{\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-right\").classList.remove(\"landing-ui-disabled\");\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-url-grid\").classList.remove(\"landing-ui-disabled\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-right\").classList.add(\"landing-ui-disabled\");\n\t\t\t\tlayout.querySelector(\".landing-ui-field-link-url-grid\").classList.add(\"landing-ui-disabled\");\n\t\t\t}\n\t\t}\n\n\t\tthis.urlCheckbox.addEventListener('change', function ()\n\t\t{\n\t\t\tonCheckboxChange(this.urlCheckbox, this.url.layout);\n\t\t}.bind(this));\n\n\t\tthis.urlCheckbox.checked = this.content.url && this.content.url.enabled;\n\n\t\tonCheckboxChange(this.urlCheckbox, this.url.layout);\n\n\t\tthis.url.hrefInput.header.appendChild(this.urlCheckbox);\n\t\tthis.url.left.hidden = true;\n\n\t\tthis.makeAsLinkWrapper.appendChild(this.url.layout);\n\n\t\tif (!data.disableLink)\n\t\t{\n\t\t\tthis.layout.appendChild(this.makeAsLinkWrapper);\n\t\t}\n\n\t\tthis.content = this.getValue();\n\t\tBX.DOM.write(function ()\n\t\t{\n\t\t\tthis.adjustPreviewBackgroundSize();\n\t\t}.bind(this));\n\n\t\tif (this.getValue().type === \"background\" || this.allowClear)\n\t\t{\n\t\t\tthis.clearButton.layout.classList.add(\"landing-ui-show\");\n\t\t}\n\n\t\tthis.uploader = new ImageUploader({\n\t\t\tuploadParams: this.uploadParams,\n\t\t\tadditionalParams: {context: 'imageeditor'},\n\t\t\tdimensions: this.dimensions,\n\t\t\tsizes: ['1x', '2x'],\n\t\t});\n\n\t\tthis.adjustEditButtonState();\n\t}\n\n\t/**\n\t * Creates file input\n\t * @return {Element}\n\t */\n\tstatic createFileInput(id)\n\t{\n\t\treturn Dom.create(\"input\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone-input\"},\n\t\t\tattrs: {accept: \"image/*\", type: \"file\", id: \"file_\" + id, name: \"picture\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates link input field\n\t * @return {TextField}\n\t */\n\tstatic createLinkInput(): TextField\n\t{\n\t\tvar field = new TextField({\n\t\t\tid: \"path_to_image\",\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK_LABEL\"),\n\t\t});\n\t\tfield.enableTextOnly();\n\t\tfield.layout.hidden = true;\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates dropzone\n\t * @param {string} id\n\t * @return {Element}\n\t */\n\tstatic createDropzone(id)\n\t{\n\t\treturn Dom.create(\"label\", {\n\t\t\tprops: {className: \"landing-ui-field-image-dropzone\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"landing-ui-field-image-dropzone-text\"},\n\t\t\t\t\thtml: (\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-title\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_TITLE\") + \"</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"landing-ui-field-image-dropzone-subtitle\\\">\" + Loc.getMessage(\n\t\t\t\t\t\t\t\"LANDING_IMAGE_DROPZONE_SUBTITLE\") + \"</div>\"\n\t\t\t\t\t),\n\t\t\t\t}),\n\t\t\t],\n\t\t\tattrs: {\"for\": \"file_\" + id},\n\t\t});\n\t}\n\n\t/**\n\t * Creates clear button\n\t * @return {BaseButton}\n\t */\n\tstatic createClearButton()\n\t{\n\t\treturn new BaseButton(\"clear\", {\n\t\t\tclassName: \"landing-ui-field-image-action-button-clear\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates image preview\n\t * @return {Element}\n\t */\n\tstatic createImagePreview()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-inner\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates icon layout\n\t * @return {Element}\n\t */\n\tstatic createIcon()\n\t{\n\t\treturn Dom.create(\"span\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview-icon\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates image layout\n\t * @return {Element}\n\t */\n\tstatic createImageLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-preview\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates alt field\n\t * @return {TextField}\n\t */\n\tstatic createAltField()\n\t{\n\t\tvar field = new TextField({\n\t\t\tplaceholder: Loc.getMessage(\"LANDING_FIELD_IMAGE_ALT_PLACEHOLDER\"),\n\t\t\tclassName: \"landing-ui-field-image-alt\",\n\t\t\ttextOnly: true,\n\t\t});\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates left layout\n\t * @return {Element}\n\t */\n\tstatic createLeftLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-left\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates upload button\n\t * @return {BaseButton}\n\t */\n\tstatic createUploadButton()\n\t{\n\t\treturn new BaseButton(\"upload\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_UPLOAD_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\t}\n\n\t/**\n\t * Creates edit button\n\t * @return {BaseButton}\n\t */\n\tstatic createEditButton()\n\t{\n\t\tvar field = new BaseButton(\"edit\", {\n\t\t\ttext: Loc.getMessage(\"LANDING_FIELD_IMAGE_EDIT_BUTTON\"),\n\t\t\tclassName: \"landing-ui-field-image-action-button\",\n\t\t});\n\n\t\treturn field;\n\t}\n\n\t/**\n\t * Creates right layout\n\t * @return {Element}\n\t */\n\tstatic createRightLayout()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"landing-ui-field-image-right\"},\n\t\t});\n\t}\n\n\t/**\n\t * Creates form\n\t * @return {Element}\n\t */\n\tstatic createForm()\n\t{\n\t\treturn Dom.create(\"form\", {\n\t\t\tprops: {className: \"landing-ui-field-image-container\"},\n\t\t\tattrs: {method: \"post\", enctype: \"multipart/form-data\"},\n\t\t\tevents: {\n\t\t\t\tsubmit: function (event)\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tonInputInput()\n\t{\n\t\tthis.preview.src = this.input.innerText.trim();\n\t}\n\n\tonImageDragEnter(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif (!this.imageHidden)\n\t\t{\n\t\t\tthis.showDropzone();\n\t\t\tthis.imageHidden = true;\n\t\t}\n\t}\n\n\tonDragOver(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.add(\"landing-ui-active\");\n\t}\n\n\tonDragLeave(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\n\t\tif (this.imageHidden)\n\t\t{\n\t\t\tthis.imageHidden = false;\n\t\t\tthis.showPreview();\n\t\t}\n\t}\n\n\tonDrop(event)\n\t{\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tthis.dropzone.classList.remove(\"landing-ui-active\");\n\t\tthis.onFileChange(event.dataTransfer.files[0]);\n\t\tthis.imageHidden = false;\n\t}\n\n\tonFileChange(file)\n\t{\n\t\tthis.showLoader();\n\n\t\tthis.upload(file)\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonFileInputChange(event)\n\t{\n\t\tthis.onFileChange(event.currentTarget.files[0]);\n\t}\n\n\tonUploadClick(event)\n\t{\n\t\tthis.bindElement = event.currentTarget;\n\n\t\tevent.preventDefault();\n\n\t\tif (!this.uploadMenu)\n\t\t{\n\t\t\tthis.uploadMenu = BX.Main.MenuManager.create({\n\t\t\t\tid: \"upload_\" + this.selector + (+new Date()),\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UNSPLASH\"),\n\t\t\t\t\t\tonclick: this.onUnsplashShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_GOOGLE\"),\n\t\t\t\t\t\tonclick: this.onGoogleShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t// {\n\t\t\t\t\t// \ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_PARTNER\"),\n\t\t\t\t\t// \tclassName: \"landing-ui-disabled\"\n\t\t\t\t\t// },\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_UPLOAD\"),\n\t\t\t\t\t\tonclick: this.onUploadShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage(\"LANDING_IMAGE_UPLOAD_MENU_LINK\"),\n\t\t\t\t\t\tonclick: this.onLinkShow.bind(this),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.bindElement.classList.remove(\"landing-ui-active\");\n\n\t\t\t\t\t\tif (this.uploadMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.uploadMenu.destroy();\n\t\t\t\t\t\t\tthis.uploadMenu = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this),\n\t\t\t\t},\n\t\t\t\ttargetContainer: this.contentRoot,\n\t\t\t});\n\t\t\tif (!this.contentRoot)\n\t\t\t{\n\t\t\t\tthis.bindElement.parentNode.appendChild(this.uploadMenu.popupWindow.popupContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindElement.classList.add(\"landing-ui-active\");\n\t\tthis.uploadMenu.toggle();\n\n\t\tif (!this.contentRoot && this.uploadMenu)\n\t\t{\n\t\t\tvar rect = BX.pos(this.bindElement, this.bindElement.parentNode);\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.top = rect.bottom + \"px\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.left = \"auto\";\n\t\t\tthis.uploadMenu.popupWindow.popupContainer.style.right = \"5px\";\n\t\t}\n\t}\n\n\tonUnsplashShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"unsplash\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonGoogleShow()\n\t{\n\t\tthis.uploadMenu.close();\n\n\t\tBX.Landing.UI.Panel.Image.getInstance()\n\t\t\t.show(\"google\", this.dimensions, this.loader, this.uploadParams)\n\t\t\t.then(this.upload.bind(this))\n\t\t\t.then(this.setValue.bind(this))\n\t\t\t.then(this.hideLoader.bind(this))\n\t\t\t.catch(function (err)\n\t\t\t{\n\t\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\taction: 'BAD_IMAGE',\n\t\t\t\t\thideSupportLink: true,\n\t\t\t\t});\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis.hideLoader();\n\t\t\t}.bind(this));\n\t}\n\n\tonUploadShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.fileInput.click();\n\t}\n\n\tonLinkShow()\n\t{\n\t\tthis.uploadMenu.close();\n\t\tthis.showLinkField();\n\t\tthis.linkInput.setValue(\"\");\n\t}\n\n\tonEditClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.edit({src: this.hiddenImage.src});\n\t}\n\n\tonClearClick(event)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.setValue({src: \"\"});\n\t\tthis.fileInput.value = \"\";\n\t\tthis.showDropzone();\n\t}\n\n\tshowDropzone()\n\t{\n\t\tthis.dropzone.hidden = false;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowPreview()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = false;\n\t\tthis.altField.layout.hidden = false;\n\t\tthis.linkInput.layout.hidden = true;\n\t}\n\n\tshowLinkField()\n\t{\n\t\tthis.dropzone.hidden = true;\n\t\tthis.image.hidden = true;\n\t\tthis.altField.layout.hidden = true;\n\t\tthis.linkInput.layout.hidden = false;\n\t}\n\n\tonLinkInput(value)\n\t{\n\t\tconst tmpImage = Dom.create(\"img\");\n\t\ttmpImage.src = value;\n\t\ttmpImage.onload = () => {\n\t\t\tthis.showPreview();\n\t\t\tthis.setValue({src: value, src2x: value});\n\t\t};\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (this.dropzone && !this.dropzone.hidden)\n\t\t{\n\t\t\tthis.loader.show(this.dropzone);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loader.show(this.preview);\n\t}\n\n\thideLoader()\n\t{\n\t\tthis.loader.hide();\n\t}\n\n\t/**\n\t * Handles click event on input field\n\t * @param {MouseEvent} event\n\t */\n\tonInputClick(event)\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t * @return {boolean}\n\t */\n\tisChanged()\n\t{\n\t\tvar lastValue = BX.Landing.Utils.clone(this.content);\n\t\tvar currentValue = BX.Landing.Utils.clone(this.getValue());\n\n\t\tif (lastValue.url && Type.isString(lastValue.url))\n\t\t{\n\t\t\tlastValue.url = BX.Landing.Utils.decodeDataValue(lastValue.url);\n\t\t}\n\n\t\tif (currentValue.url && Type.isString(currentValue.url))\n\t\t{\n\t\t\tcurrentValue.url = BX.Landing.Utils.decodeDataValue(currentValue.url);\n\t\t}\n\n\t\treturn JSON.stringify(lastValue) !== JSON.stringify(currentValue);\n\t}\n\n\t/**\n\t * Adjusts preview background image size\n\t */\n\tadjustPreviewBackgroundSize()\n\t{\n\t\tvar img = Dom.create(\"img\", {attrs: {src: this.getValue().src}});\n\n\t\timg.onload = function ()\n\t\t{\n\t\t\tvar preview = this.preview.getBoundingClientRect();\n\t\t\tvar position = \"cover\";\n\n\t\t\tif (img.width > preview.width || img.height > preview.height)\n\t\t\t{\n\t\t\t\tposition = \"contain\";\n\t\t\t}\n\n\t\t\tif (img.width < preview.width && img.height < preview.height)\n\t\t\t{\n\t\t\t\tposition = \"auto\";\n\t\t\t}\n\n\t\t\tBX.DOM.write(function ()\n\t\t\t{\n\t\t\t\tthis.preview.style.backgroundSize = position;\n\t\t\t}.bind(this));\n\t\t}.bind(this);\n\t}\n\n\t/**\n\t * @param {object} value\n\t * @param {boolean} [preventEvent = false]\n\t */\n\tsetValue(value, preventEvent)\n\t{\n\t\tif (value.type !== \"icon\")\n\t\t{\n\t\t\tif (!value || !value.src)\n\t\t\t{\n\t\t\t\tthis.input.innerText = \"\";\n\t\t\t\tthis.input2x.innerText = \"\";\n\t\t\t\tthis.preview.removeAttribute(\"style\");\n\t\t\t\tthis.input.dataset.ext = \"\";\n\t\t\t\tthis.showDropzone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.input.innerText = value.src;\n\t\t\t\tthis.input2x.innerText = value.src2x || '';\n\t\t\t\tthis.preview.style.backgroundImage = \"url(\\\"\" + (value.src2x || value.src) + \"\\\")\";\n\t\t\t\tthis.preview.id = BX.util.getRandomString();\n\t\t\t\tthis.hiddenImage.src = value.src2x || value.src;\n\t\t\t\tthis.showPreview();\n\t\t\t}\n\n\t\t\tthis.image.dataset.fileid = value && value.id ? value.id : -1;\n\t\t\tthis.image.dataset.fileid2x = value && value.id2x ? value.id2x : -1;\n\n\t\t\tthis.classList = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.preview.style.backgroundImage = null;\n\t\t\tthis.classList = value.classList;\n\t\t\tthis.icon.innerHTML = \"<span class=\\\"\" + value.classList.join(\" \") + \"\\\"></span>\";\n\t\t\tthis.showPreview();\n\t\t\tthis.type = \"icon\";\n\t\t\tthis.altField.layout.hidden = true;\n\t\t\tthis.altField.setValue(\"\");\n\t\t\tthis.input.innerText = \"\";\n\t\t}\n\n\t\tif (value.url)\n\t\t{\n\t\t\tthis.url.setValue(value.url);\n\t\t}\n\n\t\tthis.adjustPreviewBackgroundSize();\n\t\tthis.adjustEditButtonState();\n\t\tthis.hideLoader();\n\n\t\tthis.onValueChangeHandler(this);\n\t\tBX.fireEvent(this.layout, \"input\");\n\n\t\tvar event = new BX.Event.BaseEvent({\n\t\t\tdata: {value: this.getValue()},\n\t\t\tcompatData: [this.getValue()],\n\t\t});\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('change', event);\n\t\t}\n\t}\n\n\tadjustEditButtonState()\n\t{\n\t\tvar value = this.getValue();\n\t\tif (BX.Type.isStringFilled(value.src))\n\t\t{\n\t\t\tthis.editButton.enable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.editButton.disable();\n\t\t}\n\t}\n\n\treset()\n\t{\n\t\tthis.setValue({\n\t\t\ttype: this.getValue().type,\n\t\t\tid: -1,\n\t\t\tsrc: \"\",\n\t\t\talt: \"\",\n\t\t});\n\t}\n\n\t/**\n\t * Gets field value\n\t * @return {{src, [alt]: string, [title]: string, [url]: string, [type]: string}}\n\t */\n\tgetValue()\n\t{\n\t\tvar fileId = parseInt(this.image.dataset.fileid);\n\t\tvar fileId2x = parseInt(this.image.dataset.fileid2x);\n\t\tfileId = fileId === fileId ? fileId : -1;\n\t\tfileId2x = fileId2x === fileId2x ? fileId2x : -1;\n\n\t\tvar value = {type: \"\", src: \"\", id: fileId, id2x: fileId2x, src2x: \"\", alt: \"\", url: \"\"};\n\n\t\tif (this.type === \"background\")\n\t\t{\n\t\t\tvalue.type = \"background\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t}\n\n\t\tif (this.type === \"image\")\n\t\t{\n\t\t\tvalue.type = \"image\";\n\t\t\tvalue.src = this.input.innerText.trim();\n\t\t\tvalue.src2x = this.input2x.innerText.trim();\n\t\t\tvalue.id = fileId;\n\t\t\tvalue.id2x = fileId2x;\n\t\t\tvalue.alt = this.altField.getValue();\n\t\t}\n\n\t\tif (this.type === \"icon\")\n\t\t{\n\t\t\tvalue.type = \"icon\";\n\t\t\tvalue.classList = this.classList;\n\t\t}\n\n\t\tvalue.url = Object.assign({}, this.url.getValue(), {enabled: this.urlCheckbox.checked});\n\n\t\treturn value;\n\t}\n\n\tedit(data)\n\t{\n\t\tImageEditor\n\t\t\t.edit({\n\t\t\t\timage: data.src,\n\t\t\t\tdimensions: this.dimensions,\n\t\t\t})\n\t\t\t.then(function (file)\n\t\t\t{\n\t\t\t\treturn this.upload(file, {context: \"imageEditor\"});\n\t\t\t}.bind(this))\n\t\t\t.then(function (result)\n\t\t\t{\n\t\t\t\tthis.setValue(result);\n\t\t\t}.bind(this));\n\n\t\t// Analytics hack\n\t\tconst tmpImage = document.createElement('img');\n\t\tlet imageSrc = \"/bitrix/images/landing/close.svg\";\n\n\t\timageSrc = BX.util.add_url_param(imageSrc, {\n\t\t\taction: \"openImageEditor\",\n\t\t});\n\n\t\ttmpImage.src = imageSrc + \"?\" + (+new Date());\n\t}\n\n\t/**\n\t * @param {File|Blob} file\n\t * @param {object} [additionalParams]\n\t */\n\tupload(file, additionalParams)\n\t{\n\t\tif (file.type && (file.type.includes('text') || file.type.includes('html')))\n\t\t{\n\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\n\t\t\treturn Promise.reject({\n\t\t\t\ttype: \"error\",\n\t\t\t\taction: \"BAD_IMAGE\",\n\t\t\t});\n\t\t}\n\n\t\tthis.showLoader();\n\n\t\tconst isPng = (\n\t\t\tType.isStringFilled(file.type)\n\t\t\t&& file.type.includes('png')\n\t\t);\n\n\t\tconst checkSize = new Promise(function (resolve)\n\t\t{\n\t\t\tlet sizes = isPng ? ['2x'] : ['1x', '2x'];\n\n\t\t\tif (this.create2xByDefault === false)\n\t\t\t{\n\t\t\t\tconst image = document.createElement('img');\n\t\t\t\tconst objectUrl = URL.createObjectURL(file);\n\t\t\t\tconst dimensions = this.dimensions;\n\t\t\t\timage.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tURL.revokeObjectURL(objectUrl);\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tthis.width >= dimensions.width\n\t\t\t\t\t\t\t|| this.height >= dimensions.height\n\t\t\t\t\t\t\t|| this.width >= dimensions.maxWidth\n\t\t\t\t\t\t\t|| this.height >= dimensions.maxHeight\n\t\t\t\t\t\t) === false\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tsizes = isPng ? ['2x'] : ['1x'];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(sizes);\n\t\t\t\t};\n\t\t\t\timage.src = objectUrl;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve(sizes);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn checkSize\n\t\t\t.then(function (allowedSizes)\n\t\t\t{\n\t\t\t\tvar sizes = (function ()\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.create2xByDefault === false\n\t\t\t\t\t\t&& BX.Type.isArrayFilled(allowedSizes)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn allowedSizes;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn isPng ? ['2x'] : ['1x', '2x'];\n\t\t\t\t}.bind(this))();\n\n\t\t\t\treturn this.uploader\n\t\t\t\t\t.setSizes(sizes)\n\t\t\t\t\t.upload(file, additionalParams)\n\t\t\t\t\t.then(function (result)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideLoader();\n\n\t\t\t\t\t\tif (sizes.length === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn result[0];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Object.assign({}, result[0], {\n\t\t\t\t\t\t\tsrc2x: result[1].src,\n\t\t\t\t\t\t\tid2x: result[1].id,\n\t\t\t\t\t\t});\n\t\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t}\n}"],"names":["Image","data","dimensions","create2xByDefault","uploadParams","onValueChangeHandler","onValueChange","type","content","allowClear","input","innerText","src","hidden","input2x","createInput","src2x","layout","classList","add","compactMode","disableAltField","fileInput","createFileInput","selector","addEventListener","onFileInputChange","bind","linkInput","createLinkInput","onInputHandler","Runtime","debounce","onLinkInput","dropzone","createDropzone","insertBefore","firstElementChild","onDragOver","onDragLeave","onDrop","clearButton","createClearButton","on","onClearClick","preview","createImagePreview","appendChild","style","backgroundImage","trim","onImageDragEnter","loader","BX","Loader","target","icon","createIcon","image","createImageLayout","dataset","fileid","id","fileid2x","id2x","hiddenImage","Dom","create","props","className","Type","isPlainObject","altField","createAltField","setValue","alt","left","createLeftLayout","description","uploadButton","createUploadButton","onUploadClick","editButton","createEditButton","onEditClick","right","createRightLayout","form","createForm","enableTextOnly","window","location","toString","showDropzone","display","showPreview","addClass","makeAsLinkWrapper","children","url","Landing","UI","Field","Link","text","href","options","siteId","Main","getInstance","site_id","landingId","contentRoot","urlCheckbox","attrs","onCheckboxChange","checkbox","checked","querySelector","remove","enabled","hrefInput","header","disableLink","getValue","DOM","write","adjustPreviewBackgroundSize","uploader","ImageUploader","additionalParams","context","sizes","adjustEditButtonState","event","preventDefault","stopPropagation","imageHidden","onFileChange","dataTransfer","files","file","showLoader","upload","then","hideLoader","err","console","error","currentTarget","bindElement","uploadMenu","MenuManager","Date","bindOptions","forceBindPosition","items","Loc","getMessage","onclick","onUnsplashShow","onGoogleShow","onUploadShow","onLinkShow","events","onPopupClose","destroy","targetContainer","parentNode","popupWindow","popupContainer","toggle","rect","pos","top","bottom","close","Panel","show","ErrorManager","action","hideSupportLink","click","showLinkField","edit","value","tmpImage","onload","hide","lastValue","Utils","clone","currentValue","isString","decodeDataValue","JSON","stringify","img","getBoundingClientRect","position","width","height","backgroundSize","preventEvent","removeAttribute","ext","util","getRandomString","innerHTML","join","fireEvent","Event","BaseEvent","compatData","emit","isStringFilled","enable","disable","fileId","parseInt","fileId2x","Object","assign","ImageEditor","result","document","createElement","imageSrc","add_url_param","includes","Promise","reject","isPng","checkSize","resolve","objectUrl","URL","createObjectURL","revokeObjectURL","maxWidth","maxHeight","allowedSizes","isArrayFilled","setSizes","length","accept","name","field","TextField","placeholder","html","BaseButton","textOnly","method","enctype","submit"],"mappings":"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"}